/*! For license information please see dashboard.945e07b692fd3e9c12f8.js.LICENSE.txt */
(()=>{var e={38:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function s(t,o,a,i){var s=o&&o.prototype instanceof l?o:l,d=Object.create(s.prototype);return n(d,"_invoke",function(t,n,o){var a,i,s,l=0,d=o||[],u=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,i=0,s=e,p.n=n,c}};function m(t,n){for(i=t,s=n,r=0;!u&&l&&!o&&r<d.length;r++){var o,a=d[r],m=p.p,v=a[2];t>3?(o=v===n)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=t<2&&m<a[1])?(i=0,p.v=n,p.n=a[1]):m<v&&(o=t<3||a[0]>n||n>v)&&(a[4]=t,a[5]=n,p.n=v,i=0))}if(o||t>1)return c;throw u=!0,n}return function(o,d,v){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,v),i=d,s=v;(r=i<2?e:s)||!u;){a||(i?i<3?(i>1&&(p.n=-1),m(i,s)):p.n=s:p.v=s);try{if(l=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(u=p.n<0)?s:t.call(n,p))!==c)break}catch(t){a=e,i=1,s=t}finally{l=1}}return{value:r,done:u}}}(t,a,i),!0),d}var c={};function l(){}function d(){}function u(){}r=Object.getPrototypeOf;var p=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),m=u.prototype=l.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,n(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return d.prototype=u,n(m,"constructor",u),n(u,"constructor",d),d.displayName="GeneratorFunction",n(u,i,"GeneratorFunction"),n(m),n(m,i,"Generator"),n(m,a,function(){return this}),n(m,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m:v}})()}function n(e,t,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}n=function(e,t,r,o){function i(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},n(e,t,r,o)}function r(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var i=e.apply(t,n);function s(e){r(i,o,a,s,c,"next",e)}function c(e){r(i,o,a,s,c,"throw",e)}s(void 0)})}}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var s=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.properties=[],this.init()},n=[{key:"init",value:function(){this.setupEventListeners(),this.loadProperties()}},{key:"setupEventListeners",value:function(){var e=this,t=document.getElementById("addPropertyBtn");t&&t.addEventListener("click",function(){e.showAddPropertyModal()});var n=document.getElementById("propertyForm");n&&n.addEventListener("submit",function(t){t.preventDefault(),e.handlePropertySubmit(t)});var r=document.getElementById("moveInDate");r&&!r.value&&(r.value=(new Date).toISOString().split("T")[0]);var o=document.getElementById("propertySearchInput");o&&o.addEventListener("input",function(t){e.filterProperties(t.target.value)})}},{key:"loadProperties",value:(d=o(t().m(function e(){var n,r,o;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.PROPERTIES);case 1:return n=e.v,e.n=2,n.json();case 2:(r=e.v).success?(this.properties=r.properties,this.renderPropertiesTable(),window.updateSidebarBadges&&window.updateSidebarBadges()):(console.error("Failed to load properties:",r.error),this.showEmptyState()),e.n=4;break;case 3:e.p=3,o=e.v,console.error("Error loading properties:",o),this.showEmptyState("Error loading properties. Please try again.");case 4:return e.a(2)}},e,this,[[0,3]])})),function(){return d.apply(this,arguments)})},{key:"renderPropertiesTable",value:function(){var e=this,t=document.getElementById("propertiesTableBody"),n=document.getElementById("mobilePropertyList");if(t){if(0===this.properties.length)return this.showEmptyState(),void this.showMobileEmptyState();var r="";if(this.properties.forEach(function(t){r+="\n                <tr>\n                    <td>".concat(e.escapeHtml(t.propertyId),"</td>\n                    <td>").concat(e.escapeHtml(t.address),"</td>\n                    <td>").concat(e.escapeHtml(t.unit),"</td>\n                    <td>").concat(t.maxPax,"</td>\n                    <td>$").concat((t.rent||0).toLocaleString(),'</td>\n                    <td>\n                        <button class="btn btn-sm btn-outline-primary me-1" onclick="propertyManager.editProperty(\'').concat(t.propertyId,'\')">\n                            <i class="bi bi-pencil"></i> Edit\n                        </button>\n                        <button class="btn btn-sm btn-outline-danger" onclick="propertyManager.deleteProperty(\'').concat(t.propertyId,'\')">\n                            <i class="bi bi-trash"></i> Delete\n                        </button>\n                    </td>\n                </tr>\n            ')}),t.innerHTML=r,n){var o="";this.properties.forEach(function(t){o+='\n                  <div class="mobile-property-card">\n                      <div class="mobile-property-header">\n                          <div class="mobile-property-info">\n                              <div class="mobile-property-id">'.concat(e.escapeHtml(t.propertyId),'</div>\n                              <div class="mobile-property-address">').concat(e.escapeHtml(t.address),'</div>\n                          </div>\n                      </div>\n                      <div class="mobile-property-details">\n                          <div><strong>Unit:</strong> ').concat(e.escapeHtml(t.unit),"</div>\n                          <div><strong>Rent:</strong> $").concat((t.rent||0).toLocaleString(),'</div>\n                      </div>\n                      <div class="mobile-property-actions">\n                          <button class="btn btn-outline-primary btn-sm" onclick="propertyManager.editProperty(\'').concat(t.propertyId,'\')">\n                              <i class="bi bi-pencil"></i> Edit\n                          </button>\n                          <button class="btn btn-outline-danger btn-sm" onclick="propertyManager.deleteProperty(\'').concat(t.propertyId,'\')">\n                              <i class="bi bi-trash"></i> Delete\n                          </button>\n                      </div>\n                  </div>\n              ')}),n.innerHTML=o}}}},{key:"showEmptyState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"No properties found",t=document.getElementById("propertiesTableBody");t&&(t.innerHTML='\n            <tr>\n                <td colspan="6" class="text-center text-muted py-4">\n                    <i class="bi bi-building fs-1"></i>\n                    <p class="mt-2">'.concat(e,"</p>\n                </td>\n            </tr>\n        "))}},{key:"showMobileEmptyState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"No properties found",t=document.getElementById("mobilePropertyList");t&&(t.innerHTML='\n            <div class="text-center text-muted py-4">\n                <i class="bi bi-building fs-1"></i>\n                <p class="mt-2">'.concat(e,"</p>\n            </div>\n        "))}},{key:"filterProperties",value:function(e){var t=this;if(e.trim()){var n=this.properties.filter(function(t){return t.propertyId.toLowerCase().includes(e.toLowerCase())||t.address.toLowerCase().includes(e.toLowerCase())||t.unit.toLowerCase().includes(e.toLowerCase())}),r=document.getElementById("propertiesTableBody"),o=document.getElementById("mobilePropertyList");if(r){if(0===n.length)return this.showEmptyState('No properties match "'.concat(e,'"')),void this.showMobileEmptyState('No properties match "'.concat(e,'"'));var a="";if(n.forEach(function(e){a+="\n                <tr>\n                    <td>".concat(t.escapeHtml(e.propertyId),"</td>\n                    <td>").concat(t.escapeHtml(e.address),"</td>\n                    <td>").concat(t.escapeHtml(e.unit),"</td>\n                    <td>").concat(e.maxPax,"</td>\n                    <td>$").concat((e.rent||0).toLocaleString(),'</td>\n                    <td>\n                        <button class="btn btn-sm btn-outline-primary me-1" onclick="propertyManager.editProperty(\'').concat(e.propertyId,'\')">\n                            <i class="bi bi-pencil"></i> Edit\n                        </button>\n                        <button class="btn btn-sm btn-outline-danger" onclick="propertyManager.deleteProperty(\'').concat(e.propertyId,'\')">\n                            <i class="bi bi-trash"></i> Delete\n                        </button>\n                    </td>\n                </tr>\n            ')}),r.innerHTML=a,o){var i="";n.forEach(function(e){i+='\n                  <div class="mobile-property-card">\n                      <div class="mobile-property-header">\n                          <div class="mobile-property-info">\n                              <div class="mobile-property-id">'.concat(t.escapeHtml(e.propertyId),'</div>\n                              <div class="mobile-property-address">').concat(t.escapeHtml(e.address),'</div>\n                          </div>\n                      </div>\n                      <div class="mobile-property-details">\n                          <div><strong>Unit:</strong> ').concat(t.escapeHtml(e.unit),"</div>\n                          <div><strong>Rent:</strong> $").concat((e.rent||0).toLocaleString(),'</div>\n                      </div>\n                      <div class="mobile-property-actions">\n                          <button class="btn btn-outline-primary btn-sm" onclick="propertyManager.editProperty(\'').concat(e.propertyId,'\')">\n                              <i class="bi bi-pencil"></i> Edit\n                          </button>\n                          <button class="btn btn-outline-danger btn-sm" onclick="propertyManager.deleteProperty(\'').concat(e.propertyId,'\')">\n                              <i class="bi bi-trash"></i> Delete\n                          </button>\n                      </div>\n                  </div>\n              ')}),o.innerHTML=i}}}else this.renderPropertiesTable()}},{key:"showAddPropertyModal",value:function(){this.showPropertyModal()}},{key:"showPropertyModal",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=!!t;document.getElementById("propertyModalTitle").textContent=n?"Edit Property":"Add New Property",document.getElementById("propertySubmitBtn").innerHTML=n?'<i class="bi bi-pencil-square me-1"></i><span id="propertySubmitText">Update Property</span>':'<i class="bi bi-plus-circle me-1"></i><span id="propertySubmitText">Add Property</span>';var r=document.getElementById("propertyForm");if(r)if(r.reset(),r.setAttribute("data-property-id",(null==t?void 0:t.propertyId)||""),r.setAttribute("data-mode",n?"edit":"add"),n&&t){if(document.getElementById("propertyId").value=t.propertyId||"",document.getElementById("address").value=t.address||"",document.getElementById("unit").value=t.unit||"",document.getElementById("maxPax").value=t.maxPax||1,t.moveInDate){var o=new Date(t.moveInDate);document.getElementById("moveInDate").value=o.toISOString().split("T")[0]}else document.getElementById("moveInDate").value=(new Date).toISOString().split("T")[0];document.getElementById("rentPaymentDate").value=t.rentPaymentDate||1,document.getElementById("rent").value=t.rent||0,document.getElementById("agentName").value=t.agentName||"",document.getElementById("agentPhone").value=t.agentPhone||"",document.getElementById("landlordBankAccount").value=t.landlordBankAccount||"",document.getElementById("landlordBankName").value=t.landlordBankName||"",document.getElementById("landlordAccountName").value=t.landlordAccountName||"",document.getElementById("telegramBotToken").value=t.telegramBotToken||"",document.getElementById("telegramChannelId").value=t.telegramChannelId||"",document.getElementById("propertyId").readOnly=!0,document.getElementById("propertyId").classList.add("bg-light")}else{var a=document.getElementById("moveInDate");a&&(a.value=(new Date).toISOString().split("T")[0]),document.getElementById("maxPax").value="1",document.getElementById("rentPaymentDate").value="1",document.getElementById("rent").value="0",document.getElementById("propertyId").readOnly=!1,document.getElementById("propertyId").classList.remove("bg-light")}var i=document.getElementById("propertyModal"),s=new bootstrap.Modal(i);i.addEventListener("hidden.bs.modal",function(){e.cleanupModal()},{once:!0}),s.show()}},{key:"cleanupModal",value:function(){document.querySelectorAll(".modal-backdrop").forEach(function(e){return e.remove()}),document.body.classList.remove("modal-open"),document.body.style.paddingRight="",document.body.style.overflow=""}},{key:"getPropertyDataFromUser",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=prompt("Property ID:",(null==e?void 0:e.propertyId)||"");if(!t)return null;var n=prompt("Address:",(null==e?void 0:e.address)||"");if(!n)return null;var r=prompt("Unit:",(null==e?void 0:e.unit)||"");if(!r)return null;var o=parseInt(prompt("Max Occupants:",(null==e?void 0:e.maxPax)||"1"));if(isNaN(o)||o<1)return null;var a=parseFloat(prompt("Monthly Rent:",(null==e?void 0:e.rent)||"0"));return isNaN(a)||a<0?null:{propertyId:t,address:n,unit:r,maxPax:o,rent:a,agentName:(null==e?void 0:e.agentName)||"",agentPhone:(null==e?void 0:e.agentPhone)||"",landlordBankAccount:(null==e?void 0:e.landlordBankAccount)||"",landlordBankName:(null==e?void 0:e.landlordBankName)||"",landlordAccountName:(null==e?void 0:e.landlordAccountName)||""}}},{key:"handlePropertySubmit",value:(l=o(t().m(function e(n){var r,o,a,i,s,c,l,d,u,p,m,v,f,h,y,b,g,I,w;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,d=n.target,u=new FormData(d),p="edit"===d.getAttribute("data-mode"),m=d.getAttribute("data-property-id"),(v={propertyId:u.get("propertyId").trim().toUpperCase(),address:u.get("address").trim(),unit:u.get("unit").trim(),maxPax:parseInt(u.get("maxPax"))||1,moveInDate:u.get("moveInDate")||(new Date).toISOString().split("T")[0],rentPaymentDate:parseInt(u.get("rentPaymentDate"))||1,rent:parseFloat(u.get("rent"))||0,agentName:(null===(r=u.get("agentName"))||void 0===r?void 0:r.trim())||"",agentPhone:(null===(o=u.get("agentPhone"))||void 0===o?void 0:o.trim())||"",landlordBankAccount:(null===(a=u.get("landlordBankAccount"))||void 0===a?void 0:a.trim())||"",landlordBankName:(null===(i=u.get("landlordBankName"))||void 0===i?void 0:i.trim())||"",landlordAccountName:(null===(s=u.get("landlordAccountName"))||void 0===s?void 0:s.trim())||"",telegramBotToken:(null===(c=u.get("telegramBotToken"))||void 0===c?void 0:c.trim())||"",telegramChannelId:(null===(l=u.get("telegramChannelId"))||void 0===l?void 0:l.trim())||""}).propertyId&&v.address&&v.unit){e.n=1;break}return alert("Please fill in all required fields (Property ID, Address, Unit)"),e.a(2);case 1:if(!(v.maxPax<1||v.maxPax>20)){e.n=2;break}return alert("Maximum occupancy must be between 1 and 20"),e.a(2);case 2:if(!(v.rentPaymentDate<1||v.rentPaymentDate>31)){e.n=3;break}return alert("Rent payment date must be between 1 and 31"),e.a(2);case 3:if(!(v.rent<0)){e.n=4;break}return alert("Rent cannot be negative"),e.a(2);case 4:if(f=n.target.querySelector('button[type="submit"]'),h=f.innerHTML,f.disabled=!0,f.innerHTML=p?'<i class="bi bi-hourglass-split me-1"></i>Updating Property...':'<i class="bi bi-hourglass-split me-1"></i>Adding Property...',!p){e.n=6;break}return e.n=5,this.updateProperty(m,v);case 5:e.n=7;break;case 6:return e.n=7,this.addProperty(v);case 7:(y=bootstrap.Modal.getInstance(document.getElementById("propertyModal")))&&y.hide(),setTimeout(function(){var e=document.querySelector(".modal-backdrop");e&&e.remove(),document.body.classList.remove("modal-open"),document.body.style.paddingRight=""},300),f.disabled=!1,f.innerHTML=h,e.n=9;break;case 8:e.p=8,w=e.v,console.error("Error in handlePropertySubmit:",w),b="edit"===n.target.getAttribute("data-mode"),alert("An error occurred while ".concat(b?"updating":"adding"," the property. Please try again.")),(g=n.target.querySelector('button[type="submit"]'))&&(g.disabled=!1,I="edit"===n.target.getAttribute("data-mode"),g.innerHTML=I?'<i class="bi bi-pencil-square me-1"></i>Update Property':'<i class="bi bi-plus-circle me-1"></i>Add Property');case 9:return e.a(2)}},e,this,[[0,8]])})),function(e){return l.apply(this,arguments)})},{key:"addProperty",value:(c=o(t().m(function e(n){var r,o,a;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.post(API_CONFIG.ENDPOINTS.PROPERTIES,n);case 1:return r=e.v,e.n=2,r.json();case 2:if(!(o=e.v).success){e.n=4;break}return e.n=3,this.loadProperties();case 3:e.n=5;break;case 4:alert("Failed to add property: "+o.error);case 5:e.n=7;break;case 6:e.p=6,a=e.v,console.error("Error adding property:",a),alert("Error adding property. Please try again.");case 7:return e.a(2)}},e,this,[[0,6]])})),function(e){return c.apply(this,arguments)})},{key:"editProperty",value:(s=o(t().m(function e(n){var r;return t().w(function(e){for(;;)switch(e.n){case 0:if(r=this.properties.find(function(e){return e.propertyId===n})){e.n=1;break}return alert("Property not found"),e.a(2);case 1:this.showPropertyModal(r);case 2:return e.a(2)}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"updateProperty",value:(i=o(t().m(function e(n,r){var o,a,i;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.put(API_CONFIG.ENDPOINTS.PROPERTY_BY_ID(n),r);case 1:return o=e.v,e.n=2,o.json();case 2:if(!(a=e.v).success){e.n=4;break}return e.n=3,this.loadProperties();case 3:e.n=5;break;case 4:alert("Failed to update property: "+a.error);case 5:e.n=7;break;case 6:throw e.p=6,i=e.v,console.error("Error updating property:",i),alert("Error updating property: "+i.message),i;case 7:return e.a(2)}},e,this,[[0,6]])})),function(e,t){return i.apply(this,arguments)})},{key:"deleteProperty",value:(r=o(t().m(function e(n){var r,o,a;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(confirm("Are you sure you want to delete property ".concat(n,"?"))){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,API.delete(API_CONFIG.ENDPOINTS.PROPERTY_BY_ID(n));case 2:return r=e.v,e.n=3,r.json();case 3:if(!(o=e.v).success){e.n=5;break}return e.n=4,this.loadProperties();case 4:e.n=6;break;case 5:alert("Failed to delete property: "+o.error);case 6:e.n=8;break;case 7:e.p=7,a=e.v,console.error("Error deleting property:",a),alert("Error deleting property. Please try again.");case 8:return e.a(2)}},e,this,[[1,7]])})),function(e){return r.apply(this,arguments)})},{key:"escapeHtml",value:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}},{key:"refresh",value:function(){this.loadProperties()}}],n&&a(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r,i,s,c,l,d}();window.PropertyManagementComponent=s},41:()=>{function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function t(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?e(Object(o),!0).forEach(function(e){n(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function n(e,t,n){return(t=l(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,o,i){var s=r&&r.prototype instanceof l?r:l,d=Object.create(s.prototype);return a(d,"_invoke",function(n,r,o){var a,i,s,l=0,d=o||[],u=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,i=0,s=e,p.n=n,c}};function m(n,r){for(i=n,s=r,t=0;!u&&l&&!o&&t<d.length;t++){var o,a=d[t],m=p.p,v=a[2];n>3?(o=v===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=n<2&&m<a[1])?(i=0,p.v=r,p.n=a[1]):m<v&&(o=n<3||a[0]>r||r>v)&&(a[4]=n,a[5]=r,p.n=v,i=0))}if(o||n>1)return c;throw u=!0,r}return function(o,d,v){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,v),i=d,s=v;(t=i<2?e:s)||!u;){a||(i?i<3?(i>1&&(p.n=-1),m(i,s)):p.n=s:p.v=s);try{if(l=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(u=p.n<0)?s:n.call(r,p))!==c)break}catch(t){a=e,i=1,s=t}finally{l=1}}return{value:t,done:u}}}(n,o,i),!0),d}var c={};function l(){}function d(){}function u(){}t=Object.getPrototypeOf;var p=[][r]?t(t([][r]())):(a(t={},r,function(){return this}),t),m=u.prototype=l.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,a(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return d.prototype=u,a(m,"constructor",u),a(u,"constructor",d),d.displayName="GeneratorFunction",a(u,i,"GeneratorFunction"),a(m),a(m,i,"Generator"),a(m,r,function(){return this}),a(m,"toString",function(){return"[object Generator]"}),(o=function(){return{w:s,m:v}})()}function a(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}a=function(e,t,n,r){function i(t,n){a(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},a(e,t,n,r)}function i(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)})}}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function l(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}var d=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tenants=[],this.selectedProperties=[],this.propertiesCache=null,this.propertiesCacheTime=null,this.cacheTimeout=3e4,this.passportPics=[],this.visaPics=[],this.avatar="",this.init()},n=[{key:"init",value:function(){this.setupEventListeners()}},{key:"setupEventListeners",value:function(){var e=this,t=document.getElementById("addTenantBtn");t&&t.addEventListener("click",function(){e.showAddTenantModal()});var n=document.getElementById("tenantForm");n&&n.addEventListener("submit",function(t){t.preventDefault(),e.handleTenantSubmit(t)});var r=document.getElementById("tenantSearchInput");r&&r.addEventListener("input",function(t){e.filterTenants(t.target.value)}),this.setupClipboardPasteListeners()}},{key:"loadTenants",value:(I=s(o().m(function e(){var t,n,r;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.TENANTS);case 1:return t=e.v,e.n=2,t.json();case 2:if(!(n=e.v).success||!n.tenants){e.n=3;break}this.tenants=n.tenants,e.n=6;break;case 3:if(!n.tenants||!Array.isArray(n.tenants)){e.n=4;break}this.tenants=n.tenants,e.n=6;break;case 4:if(!Array.isArray(n)){e.n=5;break}this.tenants=n,e.n=6;break;case 5:return console.error("Failed to load tenants:",n.error||"Unknown format"),this.showEmptyState(),e.a(2);case 6:console.log("✅ Loaded",this.tenants.length,"tenants"),this.renderTenantsTable(),window.updateSidebarBadges&&window.updateSidebarBadges(),e.n=8;break;case 7:e.p=7,r=e.v,console.error("Error loading tenants:",r),this.showEmptyState("Error loading tenants. Please try again.");case 8:return e.a(2)}},e,this,[[0,7]])})),function(){return I.apply(this,arguments)})},{key:"renderTenantsTable",value:function(){var e=this,t=document.getElementById("tenantsTableBody");if(t)if(0!==this.tenants.length){var n="";this.tenants.forEach(function(t){n+='\n                <tr>\n                    <td>\n                        <div class="d-flex align-items-center">\n                            <div class="me-3">\n                                '.concat(t.avatar?'<img src="'.concat(e.normalizeImageUrl(t.avatar),'" alt="').concat(e.escapeHtml(t.name),'" class="rounded-circle" style="width: 36px; height: 36px; object-fit: cover;">'):'<div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center text-white fw-bold" style="width: 36px; height: 36px; font-size: 14px;">'.concat(e.escapeHtml(t.name.charAt(0).toUpperCase()),"</div>"),"\n                            </div>\n                            <div>\n                                <div>").concat(e.escapeHtml(t.name),'</div>\n                                <small class="text-muted">').concat(e.escapeHtml(t.phoneNumber||"No phone"),"</small>\n                            </div>\n                        </div>\n                    </td>\n                    <td>").concat(e.escapeHtml(t.fin),"</td>\n                    <td>").concat(e.escapeHtml(t.passportNumber),'</td>\n                    <td>\n                        <span class="badge bg-').concat(t.isRegistered?"success":"secondary",'">\n                            ').concat(t.isRegistered?"Registered":"Unregistered","\n                        </span>\n                        ").concat(e.hasMainTenantProperty(t)?'<span class="badge bg-primary ms-1">Main Tenant</span>':"","\n                    </td>\n                    <td>\n                        ").concat(e.renderPropertyDetails(t),'\n                    </td>\n                    <td>\n                        <span class="badge bg-info">\n                            ').concat(t.properties?t.properties.length:0,' properties\n                        </span>\n                    </td>\n                    <td>\n                        <button class="btn btn-sm btn-outline-primary me-1" onclick="tenantManager.editTenant(\'').concat(t.fin,'\')">\n                            <i class="bi bi-pencil"></i> Edit\n                        </button>\n                        <button class="btn btn-sm btn-outline-danger" onclick="tenantManager.deleteTenant(\'').concat(t.fin,'\')">\n                            <i class="bi bi-trash"></i> Delete\n                        </button>\n                    </td>\n                </tr>\n            ')}),t.innerHTML=n}else this.showEmptyState();else console.error("tenantsTableBody element not found!")}},{key:"showEmptyState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"No tenants found",t=document.getElementById("tenantsTableBody");t&&(t.innerHTML='\n            <tr>\n                <td colspan="7" class="text-center text-muted py-4">\n                    <i class="bi bi-people fs-1"></i>\n                    <p class="mt-2">'.concat(e,"</p>\n                </td>\n            </tr>\n        "))}},{key:"filterTenants",value:function(e){var t=this;if(e.trim()){var n=this.tenants.filter(function(t){var n=t.name.toLowerCase().includes(e.toLowerCase())||t.fin.toLowerCase().includes(e.toLowerCase())||t.passportNumber.toLowerCase().includes(e.toLowerCase())||t.phoneNumber&&t.phoneNumber.toLowerCase().includes(e.toLowerCase()),o=t.properties&&Array.isArray(t.properties)?t.properties.some(function(t){return!("object"!==r(t)||!t.room)&&t.room.toLowerCase().includes(e.toLowerCase())}):t.room&&t.room.toLowerCase().includes(e.toLowerCase());return n||o}),o=document.getElementById("tenantsTableBody");if(o)if(0!==n.length){var a="";n.forEach(function(e){a+='\n                <tr>\n                    <td>\n                        <div class="d-flex align-items-center">\n                            <div class="me-3">\n                                '.concat(e.avatar?'<img src="'.concat(t.normalizeImageUrl(e.avatar),'" alt="').concat(t.escapeHtml(e.name),'" class="rounded-circle" style="width: 36px; height: 36px; object-fit: cover;">'):'<div class="rounded-circle bg-secondary d-flex align-items-center justify-content-center text-white fw-bold" style="width: 36px; height: 36px; font-size: 14px;">'.concat(t.escapeHtml(e.name.charAt(0).toUpperCase()),"</div>"),"\n                            </div>\n                            <div>\n                                <div>").concat(t.escapeHtml(e.name),'</div>\n                                <small class="text-muted">').concat(t.escapeHtml(e.phoneNumber||"No phone"),"</small>\n                            </div>\n                        </div>\n                    </td>\n                    <td>").concat(t.escapeHtml(e.fin),"</td>\n                    <td>").concat(t.escapeHtml(e.passportNumber),'</td>\n                    <td>\n                        <span class="badge bg-').concat(e.isRegistered?"success":"secondary",'">\n                            ').concat(e.isRegistered?"Registered":"Unregistered","\n                        </span>\n                        ").concat(t.hasMainTenantProperty(e)?'<span class="badge bg-primary ms-1">Main Tenant</span>':"","\n                    </td>\n                    <td>\n                        ").concat(t.renderPropertyDetails(e),'\n                    </td>\n                    <td>\n                        <span class="badge bg-info">\n                            ').concat(e.properties?e.properties.length:0,' properties\n                        </span>\n                    </td>\n                    <td>\n                        <button class="btn btn-sm btn-outline-primary me-1" onclick="tenantManager.editTenant(\'').concat(e.fin,'\')">\n                            <i class="bi bi-pencil"></i> Edit\n                        </button>\n                        <button class="btn btn-sm btn-outline-danger" onclick="tenantManager.deleteTenant(\'').concat(e.fin,'\')">\n                            <i class="bi bi-trash"></i> Delete\n                        </button>\n                    </td>\n                </tr>\n            ')}),o.innerHTML=a}else this.showEmptyState('No tenants match "'.concat(e,'"'))}else this.renderTenantsTable()}},{key:"showAddTenantModal",value:function(){this.showTenantModal()}},{key:"showTenantModal",value:(g=s(o().m(function e(){var t,n,a,i,s,c=this,l=arguments;return o().w(function(e){for(;;)switch(e.n){case 0:return n=!!(t=l.length>0&&void 0!==l[0]?l[0]:null),document.getElementById("tenantModalTitle").textContent=n?"Edit Tenant":"Add New Tenant",document.getElementById("tenantSubmitBtn").innerHTML=n?'<i class="bi bi-person-check me-1"></i><span id="tenantSubmitText">Update Tenant</span>':'<i class="bi bi-person-plus me-1"></i><span id="tenantSubmitText">Add Tenant</span>',(a=document.getElementById("tenantForm"))&&(a.reset(),a.setAttribute("data-tenant-fin",(null==t?void 0:t.fin)||""),a.setAttribute("data-mode",n?"edit":"add"),n&&t?(document.getElementById("tenantName").value=t.name||"",document.getElementById("tenantFin").value=t.fin||"",document.getElementById("tenantPassport").value=t.passportNumber||"",document.getElementById("tenantPhoneNumber").value=t.phoneNumber||"",document.getElementById("tenantIsRegistered").checked=t.isRegistered||!1,this.passportPics=t.passportPics||(t.passportPic?[t.passportPic]:[]),this.visaPics=t.visaPics||(t.visaPic?[t.visaPic]:[]),console.log("📋 Set passportPics:",this.passportPics),console.log("📋 Set visaPics:",this.visaPics),this.avatar=t.avatar||"",this.updateAvatarPreview(),this.selectedPropertiesDetails=(t.properties||[]).map(function(e){return"object"===r(e)&&e.propertyId?{propertyId:e.propertyId,isMainTenant:e.isMainTenant||!1,room:e.room||"",moveinDate:e.moveinDate||"",moveoutDate:e.moveoutDate||""}:{propertyId:"string"==typeof e?e:e.propertyId||e._id,isMainTenant:!1,room:"",moveinDate:"",moveoutDate:""}}),this.selectedProperties=this.selectedPropertiesDetails.map(function(e){return e.propertyId}),document.getElementById("tenantFin").readOnly=!0,document.getElementById("tenantFin").classList.add("bg-light")):(this.selectedProperties=[],this.selectedPropertiesDetails=[],this.passportPics=[],this.visaPics=[],this.avatar="",this.updateImageGallery("passport"),this.updateImageGallery("visa"),this.updateAvatarPreview(),document.getElementById("tenantFin").readOnly=!1,document.getElementById("tenantFin").classList.remove("bg-light"))),e.n=1,this.loadPropertiesForSelect();case 1:this.updateSelectedPropertiesList(),this.setupImageUrlListeners(),i=document.getElementById("tenantModal"),s=new bootstrap.Modal(i),i.addEventListener("hidden.bs.modal",function(){c.cleanupModal()},{once:!0}),i.addEventListener("shown.bs.modal",function(){c.updateImageGallery("passport"),c.updateImageGallery("visa"),c.updateAvatarPreview(),c.setupModalClipboardListeners()},{once:!0}),s.show();case 2:return e.a(2)}},e,this)})),function(){return g.apply(this,arguments)})},{key:"cleanupModal",value:function(){document.querySelectorAll(".modal-backdrop").forEach(function(e){return e.remove()}),document.body.classList.remove("modal-open"),document.body.style.paddingRight="",document.body.style.overflow="",this.selectedProperties=[]}},{key:"loadPropertiesForSelect",value:(b=s(o().m(function e(){var t,n,r,a,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t=Date.now(),!(this.propertiesCache&&this.propertiesCacheTime&&t-this.propertiesCacheTime<this.cacheTimeout)){e.n=1;break}return console.log("Using cached properties data"),this.populatePropertyCheckboxes(this.propertiesCache),e.a(2);case 1:return e.n=2,API.get(API_CONFIG.ENDPOINTS.PROPERTIES);case 2:return n=e.v,e.n=3,n.json();case 3:(r=e.v).success&&(this.propertiesCache=r,this.propertiesCacheTime=t),this.populatePropertyCheckboxes(r),e.n=5;break;case 4:e.p=4,i=e.v,console.error("Error loading properties:",i),(a=document.getElementById("propertyCheckboxList"))&&(a.innerHTML='<li class="px-3 py-2 text-danger">Error loading properties</li>');case 5:return e.a(2)}},e,this,[[0,4]])})),function(){return b.apply(this,arguments)})},{key:"populatePropertyCheckboxes",value:function(e){var t=this,n=document.getElementById("propertyCheckboxList");n&&e.success&&(n.innerHTML="",0!==e.properties.length?(e.properties.forEach(function(e){var r=document.createElement("li");r.className="px-3 py-2";var o="property-".concat(e.propertyId),a=t.selectedProperties.includes(e.propertyId);r.innerHTML='\n                <div class="form-check">\n                    <input class="form-check-input" type="checkbox" id="'.concat(o,'" \n                           value="').concat(e.propertyId,'" ').concat(a?"checked":"",'>\n                    <label class="form-check-label" for="').concat(o,'" style="cursor: pointer;">\n                        <strong>').concat(e.propertyId,"</strong> - ").concat(e.address,", ").concat(e.unit,"\n                    </label>\n                </div>\n            ");var i=r.querySelector('input[type="checkbox"]');i.addEventListener("change",function(e){t.handleCheckboxChange(e.target.value,e.target.checked)}),r.addEventListener("click",function(e){e.stopPropagation(),"INPUT"!==e.target.tagName&&(i.checked=!i.checked,t.handleCheckboxChange(i.value,i.checked))}),n.appendChild(r)}),this.updateDropdownText()):n.innerHTML='<li class="px-3 py-2 text-muted">No properties available</li>')}},{key:"handleCheckboxChange",value:function(e,t){t?this.selectedProperties.includes(e)||(this.selectedProperties.push(e),this.selectedPropertiesDetails||(this.selectedPropertiesDetails=[]),this.selectedPropertiesDetails.find(function(t){return t.propertyId===e})||this.selectedPropertiesDetails.push({propertyId:e,isMainTenant:!1,room:"",moveinDate:"",moveoutDate:""})):(this.selectedProperties=this.selectedProperties.filter(function(t){return t!==e}),this.selectedPropertiesDetails&&(this.selectedPropertiesDetails=this.selectedPropertiesDetails.filter(function(t){return t.propertyId!==e}))),this.updateSelectedPropertiesList(),this.updateDropdownText()}},{key:"updateDropdownText",value:function(){var e=document.getElementById("propertyDropdownText");if(e){var t=this.selectedProperties.length;e.textContent=0===t?"Select properties...":1===t?"1 property selected":"".concat(t," properties selected")}}},{key:"addPropertyToTenant",value:function(){console.log("addPropertyToTenant called - now handled by handlePropertySelectionChange")}},{key:"removePropertyFromTenant",value:function(e){this.selectedProperties=this.selectedProperties.filter(function(t){return t!==e}),this.updateSelectedPropertiesList(),this.updateDropdownText();var t=document.getElementById("property-".concat(e));t&&(t.checked=!1)}},{key:"updateSelectedPropertiesList",value:function(){var e=this,t=document.getElementById("selectedPropertiesList"),n=document.getElementById("tenantProperties");if(this.selectedPropertiesDetails||(this.selectedPropertiesDetails=[]),0===this.selectedProperties.length)t.innerHTML='<div class="text-muted">No properties assigned</div>',n.value="";else{var r="";this.selectedProperties.forEach(function(t){var n=e.selectedPropertiesDetails.find(function(e){return e.propertyId===t})||{propertyId:t,isMainTenant:!1,room:"",moveinDate:"",moveoutDate:""},o=e.getPropertyInfo(t),a=o?"".concat(t," - ").concat(o.address,", ").concat(o.unit):t;r+='\n                    <div class="card mb-2">\n                        <div class="card-body p-3">\n                            <div class="d-flex justify-content-between align-items-center mb-2">\n                                <h6 class="card-title mb-0">\n                                    <i class="bi bi-building me-2"></i>'.concat(a,'\n                                </h6>\n                                <button type="button" class="btn btn-sm btn-outline-danger" \n                                        onclick="tenantManager.removePropertyFromTenant(\'').concat(t,'\')" \n                                        title="Remove property">\n                                    <i class="bi bi-x"></i>\n                                </button>\n                            </div>\n                            \n                            <div class="row g-2">\n                                <div class="col-12">\n                                    <div class="form-check">\n                                        <input class="form-check-input" type="checkbox" \n                                               id="mainTenant_').concat(t,'" \n                                               ').concat(n.isMainTenant?"checked":"","\n                                               onchange=\"tenantManager.updatePropertyDetail('").concat(t,'\', \'isMainTenant\', this.checked)">\n                                        <label class="form-check-label" for="mainTenant_').concat(t,'">\n                                            Main Tenant for this property\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="col-md-4">\n                                    <label class="form-label small">Room</label>\n                                    <select class="form-select form-select-sm" \n                                            onchange="tenantManager.updatePropertyDetail(\'').concat(t,"', 'room', this.value)\"\n                                            value=\"").concat(n.room,'">\n                                        <option value="">Select room</option>\n                                        <option value="COMMON1" ').concat("COMMON1"===n.room?"selected":"",'>Common 1</option>\n                                        <option value="COMMON2" ').concat("COMMON2"===n.room?"selected":"",'>Common 2</option>\n                                        <option value="MASTER" ').concat("MASTER"===n.room?"selected":"",'>Master</option>\n                                        <option value="COMPARTMENT1" ').concat("COMPARTMENT1"===n.room?"selected":"",'>Compartment 1</option>\n                                        <option value="COMPARTMENT2" ').concat("COMPARTMENT2"===n.room?"selected":"",'>Compartment 2</option>\n                                        <option value="STORE" ').concat("STORE"===n.room?"selected":"",'>Store</option>\n                                    </select>\n                                </div>\n                                <div class="col-md-4">\n                                    <label class="form-label small">Move-in Date</label>\n                                    <input type="date" class="form-control form-control-sm" \n                                           value="').concat(n.moveinDate?n.moveinDate.split("T")[0]:"",'"\n                                           onchange="tenantManager.updatePropertyDetail(\'').concat(t,'\', \'moveinDate\', this.value)">\n                                </div>\n                                <div class="col-md-4">\n                                    <label class="form-label small">Move-out Date</label>\n                                    <input type="date" class="form-control form-control-sm" \n                                           value="').concat(n.moveoutDate?n.moveoutDate.split("T")[0]:"",'"\n                                           onchange="tenantManager.updatePropertyDetail(\'').concat(t,"', 'moveoutDate', this.value)\">\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                ")}),t.innerHTML=r,n.value=JSON.stringify(this.selectedPropertiesDetails)}this.updateDropdownText()}},{key:"getPropertyInfo",value:function(e){return this.propertiesCache&&this.propertiesCache.properties?this.propertiesCache.properties.find(function(t){return t.propertyId===e}):null}},{key:"updatePropertyDetail",value:function(e,t,n){this.selectedPropertiesDetails||(this.selectedPropertiesDetails=[]);var r=this.selectedPropertiesDetails.find(function(t){return t.propertyId===e});r||(r={propertyId:e,isMainTenant:!1,room:"",moveinDate:"",moveoutDate:""},this.selectedPropertiesDetails.push(r)),r[t]=n,console.log("Updated property ".concat(e," ").concat(t," to:"),n)}},{key:"handleTenantSubmit",value:(y=s(o().m(function e(n){var a,i,s,c,l,d,u,p,m,v,f,h;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,a=n.target,i=new FormData(a),s="edit"===a.getAttribute("data-mode"),c=a.getAttribute("data-tenant-fin"),l={name:i.get("name").trim(),fin:i.get("fin").trim().toUpperCase(),passportNumber:i.get("passportNumber").trim().toUpperCase(),phoneNumber:i.get("phoneNumber").trim(),isRegistered:"on"===i.get("isRegistered"),properties:this.selectedPropertiesDetails||this.selectedProperties.map(function(e){return{propertyId:e,isMainTenant:!1,room:"",moveinDate:"",moveoutDate:""}}),passportPics:this.passportPics,visaPics:this.visaPics,avatar:this.avatar},console.log("🔄 Tenant update data:",t(t({},l),{},{propertiesType:r(this.selectedProperties[0]),propertiesContent:this.selectedProperties})),l.name&&l.fin&&l.passportNumber){e.n=1;break}return alert("Please fill in all required fields (Name, FIN, Passport Number)"),e.a(2);case 1:if(!(l.fin.length>20)){e.n=2;break}return alert("FIN cannot exceed 20 characters"),e.a(2);case 2:if(!(l.passportNumber.length<6||l.passportNumber.length>15)){e.n=3;break}return alert("Passport number must be between 6 and 15 characters"),e.a(2);case 3:if(!l.phoneNumber||!(l.phoneNumber.length<8||l.phoneNumber.length>20)){e.n=4;break}return alert("Phone number must be between 8 and 20 characters"),e.a(2);case 4:if(!(l.moveoutDate&&l.moveinDate&&new Date(l.moveoutDate)<=new Date(l.moveinDate))){e.n=5;break}return alert("Move-out date must be after move-in date"),e.a(2);case 5:if(d=n.target.querySelector('button[type="submit"]'),u=d.innerHTML,d.disabled=!0,d.innerHTML=s?'<i class="bi bi-hourglass-split me-1"></i>Updating Tenant...':'<i class="bi bi-hourglass-split me-1"></i>Adding Tenant...',!s){e.n=7;break}return e.n=6,this.updateTenant(c,l);case 6:e.n=8;break;case 7:return e.n=8,this.addTenant(l);case 8:(p=bootstrap.Modal.getInstance(document.getElementById("tenantModal")))&&p.hide(),setTimeout(function(){var e=document.querySelector(".modal-backdrop");e&&e.remove(),document.body.classList.remove("modal-open"),document.body.style.paddingRight=""},300),d.disabled=!1,d.innerHTML=u,e.n=10;break;case 9:e.p=9,h=e.v,console.error("Error in handleTenantSubmit:",h),m="edit"===n.target.getAttribute("data-mode"),alert("An error occurred while ".concat(m?"updating":"adding"," the tenant. Please try again.")),(v=n.target.querySelector('button[type="submit"]'))&&(v.disabled=!1,f="edit"===n.target.getAttribute("data-mode"),v.innerHTML=f?'<i class="bi bi-person-check me-1"></i>Update Tenant':'<i class="bi bi-person-plus me-1"></i>Add Tenant');case 10:return e.a(2)}},e,this,[[0,9]])})),function(e){return y.apply(this,arguments)})},{key:"getTenantDataFromUser",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=prompt("Full Name:",(null==e?void 0:e.name)||"");if(!t)return null;var n=prompt("FIN (Singaporean ID):",(null==e?void 0:e.fin)||"");if(!n)return null;var r=prompt("Passport Number:",(null==e?void 0:e.passportNumber)||"");if(!r)return null;var o=confirm("Is this tenant active/registered?"),a=confirm("Is this the main tenant?");return{name:t,fin:n.toUpperCase(),passportNumber:r.toUpperCase(),isRegistered:o,isMainTenant:a,properties:(null==e?void 0:e.properties)||[]}}},{key:"addTenant",value:(h=s(o().m(function e(t){var n,r,a;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.post(API_CONFIG.ENDPOINTS.TENANTS,t);case 1:return n=e.v,e.n=2,n.json();case 2:if(!(r=e.v).success){e.n=4;break}return e.n=3,this.loadTenants();case 3:e.n=5;break;case 4:alert("Failed to add tenant: "+r.error);case 5:e.n=7;break;case 6:e.p=6,a=e.v,console.error("Error adding tenant:",a),alert("Error adding tenant. Please try again.");case 7:return e.a(2)}},e,this,[[0,6]])})),function(e){return h.apply(this,arguments)})},{key:"editTenant",value:(f=s(o().m(function e(t){var n;return o().w(function(e){for(;;)switch(e.n){case 0:if(n=this.tenants.find(function(e){return e.fin===t})){e.n=1;break}return alert("Tenant not found"),e.a(2);case 1:this.showTenantModal(n);case 2:return e.a(2)}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"updateTenant",value:(v=s(o().m(function e(t,n){var r,a,i,s;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,(r=this.tenants.find(function(e){return e.fin===t}))&&r._id){e.n=1;break}throw new Error("Tenant ID not found");case 1:return e.n=2,API.put(API_CONFIG.ENDPOINTS.TENANT_BY_ID(r._id),n);case 2:return a=e.v,e.n=3,a.json();case 3:if(!(i=e.v).success){e.n=5;break}return e.n=4,this.loadTenants();case 4:e.n=6;break;case 5:alert("Failed to update tenant: "+i.error);case 6:e.n=8;break;case 7:throw e.p=7,s=e.v,console.error("Error updating tenant:",s),alert("Error updating tenant: "+s.message),s;case 8:return e.a(2)}},e,this,[[0,7]])})),function(e,t){return v.apply(this,arguments)})},{key:"deleteTenant",value:(m=s(o().m(function e(t){var n,r,a,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(confirm("Are you sure you want to delete tenant ".concat(t,"?"))){e.n=1;break}return e.a(2);case 1:if(e.p=1,(n=this.tenants.find(function(e){return e.fin===t}))&&n._id){e.n=2;break}throw new Error("Tenant ID not found");case 2:return e.n=3,API.delete(API_CONFIG.ENDPOINTS.TENANT_BY_ID(n._id));case 3:return r=e.v,e.n=4,r.json();case 4:if(!(a=e.v).success){e.n=6;break}return e.n=5,this.loadTenants();case 5:e.n=7;break;case 6:alert("Failed to delete tenant: "+a.error);case 7:e.n=9;break;case 8:e.p=8,i=e.v,console.error("Error deleting tenant:",i),alert("Error deleting tenant. Please try again.");case 9:return e.a(2)}},e,this,[[1,8]])})),function(e){return m.apply(this,arguments)})},{key:"assignToProperty",value:(p=s(o().m(function e(t,n){var r,a,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.post(API_CONFIG.ENDPOINTS.TENANT_ADD_PROPERTY(t),{propertyId:n});case 1:return r=e.v,e.n=2,r.json();case 2:if(!(a=e.v).success){e.n=4;break}return e.n=3,this.loadTenants();case 3:e.n=5;break;case 4:alert("Failed to assign tenant to property: "+a.error);case 5:e.n=7;break;case 6:e.p=6,i=e.v,console.error("Error assigning tenant to property:",i),alert("Error assigning tenant to property. Please try again.");case 7:return e.a(2)}},e,this,[[0,6]])})),function(e,t){return p.apply(this,arguments)})},{key:"escapeHtml",value:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}},{key:"normalizeImageUrl",value:function(e){return e?e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("/api/upload/image-proxy/")?API_CONFIG.BASE_URL?"".concat(API_CONFIG.BASE_URL).concat(e):e:(t=e.match(/^[a-zA-Z0-9\-_\/]+\.(jpg|jpeg|png)$/i)?e.includes("/")?"/api/upload/image-proxy/".concat(e):"/api/upload/image-proxy/tenant-documents/".concat(e):e.startsWith("/")?e:"/api/upload/image-proxy/".concat(e),API_CONFIG.BASE_URL?"".concat(API_CONFIG.BASE_URL).concat(t):t):e;var t}},{key:"refresh",value:function(){this.loadTenants()}},{key:"openImageUpload",value:function(e){var t=this;this.currentUploadType=e;var n=document.getElementById("imageUploadInput");n.click(),n.onchange=function(n){n.target.files.length>0&&t.uploadMultipleImages(Array.from(n.target.files),e)}}},{key:"uploadMultipleImages",value:(u=s(o().m(function e(t,n){var r,a,i,s,c,l,d,u=this;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=document.querySelector("button[onclick=\"tenantManager.openImageUpload('".concat(n,"')\"]")),a=r.innerHTML,e.p=1,r.disabled=!0,r.innerHTML='<i class="bi bi-hourglass-split"></i> Uploading '.concat(t.length," image(s)..."),i=t.map(function(e){return u.uploadSingleImage(e)}),e.n=2,Promise.all(i);case 2:s=e.v,c="passport"===n?this.passportPics:this.visaPics,s.forEach(function(e){if(e.success){console.log("🔗 Received image URL from upload:",e.url),console.log("🔧 Original URL from backend:",e.originalUrl),console.log("🔧 Public ID from backend:",e.publicId);var t=e.url;t&&!t.startsWith("http")&&(t=t.startsWith("/")?API_CONFIG.BASE_URL+t:"https://"+t),console.log("🔗 Final image URL to store:",t),c.push(t)}}),this.updateImageGallery(n),l=s.filter(function(e){return e.success}).length,console.log("✅ ".concat(l,"/").concat(t.length," ").concat(n," images uploaded successfully")),l<t.length&&alert("".concat(l,"/").concat(t.length," images uploaded successfully. Some uploads failed.")),e.n=4;break;case 3:e.p=3,d=e.v,console.error("Error uploading ".concat(n," images:"),d),alert("Error uploading ".concat(n," images. Please try again."));case 4:return e.p=4,r.disabled=!1,r.innerHTML=a,e.f(4);case 5:return e.a(2)}},e,this,[[1,3,4,5]])})),function(e,t){return u.apply(this,arguments)})},{key:"uploadSingleImage",value:(d=s(o().m(function e(t){var n,r,a,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,(n=new FormData).append("image",t),r=buildApiUrl(API_CONFIG.ENDPOINTS.UPLOAD_TENANT_DOCUMENT),console.log("🔧 Upload URL:",r),console.log("🔧 Base URL:",API_CONFIG.BASE_URL),e.n=1,fetch(r,{method:"POST",headers:{Authorization:"Bearer ".concat(getAuthToken())},body:n});case 1:return a=e.v,e.n=2,a.json();case 2:return e.a(2,e.v);case 3:return e.p=3,i=e.v,e.a(2,{success:!1,error:i.message})}},e,null,[[0,3]])})),function(e){return d.apply(this,arguments)})},{key:"addImageFromUrl",value:function(e){var t=document.getElementById("tenant".concat(e.charAt(0).toUpperCase()+e.slice(1),"PicUrl")),n=t.value.trim();if(n){var r="passport"===e?this.passportPics:this.visaPics;r.includes(n)?alert("This image URL is already added"):(r.push(n),this.updateImageGallery(e),t.value="")}else alert("Please enter a valid image URL")}},{key:"removeImage",value:function(e,t){("passport"===e?this.passportPics:this.visaPics).splice(t,1),this.updateImageGallery(e)}},{key:"handleImageError",value:function(e,t){console.error("❌ Image failed to load via proxy:",t),console.error("Image element:",e),console.error("Current src attribute:",e.src),console.error("Has fallback been attempted?",e.hasAttribute("data-fallback-attempted"));try{var n=t.match(/image-proxy\/(.+)$/);if(n){var r=n[1],o="https://res.cloudinary.com/djye0w3gi/image/upload/".concat(r);if(console.log("🔄 Trying direct Cloudinary URL as fallback:",o),!e.hasAttribute("data-fallback-attempted"))return e.setAttribute("data-fallback-attempted","true"),e.src=o,void fetch(o,{method:"HEAD"}).then(function(e){console.log("🧪 Direct URL test result:",e.status,e.statusText),e.ok||console.error("🚨 Direct URL also failed:",e.status)}).catch(function(e){console.error("🚨 Direct URL fetch test failed:",e)})}}catch(e){console.error("Error creating fallback URL:",e)}console.log("🚨 All fallback attempts failed, showing error placeholder"),e.style.objectFit="cover",e.style.backgroundColor="#e9ecef",e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='150' height='150' viewBox='0 0 150 150'><rect width='150' height='150' fill='%23e9ecef'/><text x='75' y='75' text-anchor='middle' dy='.3em' fill='%236c757d'>Image Failed</text></svg>"}},{key:"updateImageGallery",value:function(e){var t=this,n=document.getElementById("".concat(e,"Gallery")),r="passport"===e?this.passportPics:this.visaPics,o=document.getElementById("tenant".concat(e.charAt(0).toUpperCase()+e.slice(1),"Pics"));if(n&&o)if(o.value=JSON.stringify(r),0!==r.length){var a='<div class="row g-2">';r.forEach(function(n,r){var o="passport"===e?"bi-passport":"bi-credit-card",i='\n                <div class="col-6 col-md-4 mb-3">\n                    <div class="position-relative border rounded overflow-hidden">\n                        <img src="'.concat(t.normalizeImageUrl(n),'" alt="').concat(e," ").concat(r+1,'" \n                             class="img-fluid w-100" \n                             style="height: 150px; object-fit: contain; cursor: pointer; background-color: #f8f9fa;"\n                             onclick="window.open(\'').concat(n,'\', \'_blank\')" />\n                        <button type="button" \n                                class="btn btn-danger position-absolute top-0 end-0 m-1"\n                                onclick="tenantManager.removeImage(\'').concat(e,"', ").concat(r,')"\n                                style="padding: 2px; font-size: 0.8rem; opacity: 0.9; border-radius: 50%; width: 28px; height: 28px; display: flex !important; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2); z-index: 1000; background-color: #dc3545 !important; border: 2px solid white; line-height: 1;"\n                                onmouseover="this.style.opacity=\'1\'; this.style.transform=\'scale(1.1)\'"\n                                onmouseout="this.style.opacity=\'0.9\'; this.style.transform=\'scale(1)\'"\n                                title="Delete image">\n                            ✕\n                        </button>\n                        <div class="position-absolute bottom-0 start-0 end-0 bg-primary bg-opacity-90 text-white text-center py-2">\n                            <small><i class="bi ').concat(o,' me-1"></i>').concat(e.charAt(0).toUpperCase()+e.slice(1)," ").concat(r+1,"</small>\n                        </div>\n                    </div>\n                </div>\n            ");a+=i}),a+="</div>",n.innerHTML=a}else n.innerHTML='<div class="text-muted small">No images uploaded yet</div>'}},{key:"setupImageUrlListeners",value:function(){}},{key:"openAvatarUpload",value:function(){var e=this,t=document.getElementById("avatarUploadInput");t.click(),t.onchange=function(t){t.target.files.length>0&&e.uploadAvatar(t.target.files[0])}}},{key:"uploadAvatar",value:(l=s(o().m(function e(t){var n,r,a,i,s;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=document.querySelector('button[onclick="tenantManager.openAvatarUpload()"]'),r=n.innerHTML,e.p=1,n.disabled=!0,n.innerHTML='<i class="bi bi-hourglass-split"></i> Uploading avatar...',e.n=2,this.uploadSingleImage(t);case 2:(a=e.v).success?(console.log("🔗 Avatar uploaded successfully:",a.url),(i=a.url)&&!i.startsWith("http")&&(i=i.startsWith("/")?API_CONFIG.BASE_URL+i:"https://"+i),this.avatar=i,this.updateAvatarPreview(),console.log("✅ Avatar set to:",this.avatar)):alert("Failed to upload avatar: "+a.error),e.n=4;break;case 3:e.p=3,s=e.v,console.error("Error uploading avatar:",s),alert("Error uploading avatar. Please try again.");case 4:return e.p=4,n.disabled=!1,n.innerHTML=r,e.f(4);case 5:return e.a(2)}},e,this,[[1,3,4,5]])})),function(e){return l.apply(this,arguments)})},{key:"addAvatarFromUrl",value:function(){var e=document.getElementById("tenantAvatarUrl"),t=e.value.trim();t?(this.avatar=t,this.updateAvatarPreview(),e.value="",console.log("✅ Avatar set from URL:",this.avatar)):alert("Please enter a valid image URL")}},{key:"removeAvatar",value:function(){this.avatar="",this.updateAvatarPreview(),console.log("🗑️ Avatar removed")}},{key:"updateAvatarPreview",value:function(){var e=document.getElementById("avatarPreview"),t=document.getElementById("tenantAvatar");e&&t&&(t.value=this.avatar,this.avatar?e.innerHTML='\n            <div class="position-relative d-inline-block">\n                <img src="'.concat(this.normalizeImageUrl(this.avatar),'" alt="Avatar preview" \n                     class="rounded-circle border" \n                     style="width: 80px; height: 80px; object-fit: cover; cursor: pointer;" \n                     onclick="window.open(\'').concat(this.avatar,'\', \'_blank\')" />\n                <button type="button" \n                        class="btn btn-danger position-absolute top-0 end-0"\n                        onclick="tenantManager.removeAvatar()"\n                        style="padding: 2px; font-size: 0.7rem; border-radius: 50%; width: 24px; height: 24px; display: flex !important; align-items: center; justify-content: center; transform: translate(25%, -25%);"\n                        title="Remove avatar">\n                    ✕\n                </button>\n                <div class="text-center mt-2">\n                    <small class="text-muted">Avatar Preview</small>\n                </div>\n            </div>\n        '):e.innerHTML='<div class="text-muted small">No avatar selected</div>')}},{key:"hasMainTenantProperty",value:function(e){return!(!e.properties||!Array.isArray(e.properties))&&e.properties.some(function(e){return"object"===r(e)&&e.isMainTenant})}},{key:"renderPropertyDetails",value:function(e){var t=this;if(!e.properties||0===e.properties.length)return'<div class="text-muted small">No properties assigned</div>';var n="";return e.properties.forEach(function(e,o){if("object"===r(e)&&e.propertyId){var a=t.escapeHtml(e.propertyId),i=t.escapeHtml(e.room||"N/A"),s=e.moveinDate?new Date(e.moveinDate).toLocaleDateString():"N/A",c=e.moveoutDate?new Date(e.moveoutDate).toLocaleDateString():"Current",l=e.isMainTenant?'<span class="badge bg-primary ms-1" style="font-size: 0.6em;">Main</span>':"";n+='\n                    <div class="mb-1 '.concat(o>0?"border-top pt-1":"",'">\n                        <div><strong>').concat(a,"</strong> ").concat(l,'</div>\n                        <small class="text-muted">Room: ').concat(i," | In: ").concat(s," | Out: ").concat(c,"</small>\n                    </div>\n                ")}else{var d="string"==typeof e?e:e.propertyId||e._id||"Unknown";n+='\n                    <div class="mb-1 '.concat(o>0?"border-top pt-1":"",'">\n                        <div><strong>').concat(t.escapeHtml(d),'</strong></div>\n                        <small class="text-muted">Legacy format - no details</small>\n                    </div>\n                ')}}),n||'<div class="text-muted small">No properties assigned</div>'}},{key:"setupClipboardPasteListeners",value:function(){console.log("📋 Clipboard paste listeners initialized")}},{key:"setupModalClipboardListeners",value:function(){var e=this;["tenantAvatarUrl","tenantPassportPicUrl","tenantVisaPicUrl"].forEach(function(t){e.setupPasteListenerForField(t)}),console.log("📋 Modal clipboard listeners set up for tenant dialog")}},{key:"setupPasteListenerForField",value:function(e){var t=this,n=document.getElementById(e);if(n&&!n.hasAttribute("data-paste-listener-added")){n.setAttribute("data-paste-listener-added","true"),n.addEventListener("paste",function(){var n=s(o().m(function n(r){return o().w(function(n){for(;;)switch(n.n){case 0:return r.preventDefault(),n.n=1,t.handleImagePaste(r,e);case 1:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}());var r=n.placeholder||"Paste Cloudinary URL here";r.includes("Ctrl+V")||(n.placeholder=r+" (Ctrl+V to paste from clipboard)"),n.title="You can paste images from clipboard here (Ctrl+V)",n.style.borderLeft="3px solid #0d6efd",n.setAttribute("data-clipboard-enabled","true"),console.log("✅ Clipboard paste listener added to ".concat(e))}}},{key:"handleImagePaste",value:(i=s(o().m(function e(t,n){var r,a,i,s,c,l,d,u,p,m,v;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,i=null===(r=t.clipboardData||(null===(a=t.originalEvent)||void 0===a?void 0:a.clipboardData))||void 0===r?void 0:r.items){e.n=1;break}return console.log("No clipboard items found"),e.a(2);case 1:s=!1,c=0;case 2:if(!(c<i.length)){e.n=5;break}if(-1===(l=i[c]).type.indexOf("image")){e.n=4;break}if(s=!0,!(d=l.getAsFile())){e.n=4;break}return console.log("📋 Image pasted from clipboard to ".concat(n,":"),d.name,d.type),e.n=3,this.uploadClipboardImage(d,n);case 3:return e.a(3,5);case 4:c++,e.n=2;break;case 5:s||((m=(null===(u=t.clipboardData)||void 0===u?void 0:u.getData("text"))||(null===(p=t.originalEvent)||void 0===p||null===(p=p.clipboardData)||void 0===p?void 0:p.getData("text")))&&this.isImageUrl(m)?(console.log("📋 Image URL pasted from clipboard to ".concat(n,":"),m),document.getElementById(n).value=m):(console.log("No image found in clipboard"),this.showPasteMessage(n,"No image found in clipboard","warning"))),e.n=7;break;case 6:e.p=6,v=e.v,console.error("Error handling clipboard paste:",v),this.showPasteMessage(n,"Error pasting from clipboard","error");case 7:return e.a(2)}},e,this,[[0,6]])})),function(e,t){return i.apply(this,arguments)})},{key:"uploadClipboardImage",value:(a=s(o().m(function e(t,n){var r,a,i,s,c;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=document.getElementById(n),a=r.placeholder,e.p=1,r.placeholder="Uploading image from clipboard...",r.disabled=!0,e.n=2,this.uploadSingleImage(t);case 2:(i=e.v).success?((s=i.url)&&!s.startsWith("http")&&(s=s.startsWith("/")?API_CONFIG.BASE_URL+s:"https://"+s),r.value=s,"tenantAvatarUrl"===n?this.addAvatarFromUrl():"tenantPassportPicUrl"===n?this.addImageFromUrl("passport"):"tenantVisaPicUrl"===n&&this.addImageFromUrl("visa"),this.showPasteMessage(n,"Image uploaded successfully!","success"),console.log("✅ Clipboard image uploaded successfully to ".concat(n,":"),s)):this.showPasteMessage(n,"Failed to upload image: "+i.error,"error"),e.n=4;break;case 3:e.p=3,c=e.v,console.error("Error uploading clipboard image:",c),this.showPasteMessage(n,"Error uploading image","error");case 4:return e.p=4,r.placeholder=a,r.disabled=!1,e.f(4);case 5:return e.a(2)}},e,this,[[1,3,4,5]])})),function(e,t){return a.apply(this,arguments)})},{key:"isImageUrl",value:function(e){return/\.(jpg|jpeg|png|gif|webp|bmp)(\?.*)?$/i.test(e)||e.includes("cloudinary.com")||e.includes("imgur.com")||e.includes("drive.google.com")}},{key:"showPasteMessage",value:function(e,t,n){var r=document.getElementById(e),o="paste-message-".concat(e),a=document.getElementById(o);a&&a.remove();var i=document.createElement("div");i.id=o,i.className="alert alert-".concat("success"===n?"success":"warning"===n?"warning":"danger"," alert-dismissible fade show mt-2"),i.style.fontSize="0.875rem",i.innerHTML='\n            <i class="bi bi-'.concat("success"===n?"check-circle":"warning"===n?"exclamation-triangle":"x-circle",' me-1"></i>\n            ').concat(t,"\n        "),r.parentNode.insertBefore(i,r.nextSibling),setTimeout(function(){i.parentNode&&i.remove()},3e3)}}],n&&c(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,a,i,l,d,u,p,m,v,f,h,y,b,g,I}();window.TenantManagementComponent=d},169:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach(function(t){r(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function r(e,t,n){return(t=l(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,o,i){var s=r&&r.prototype instanceof l?r:l,d=Object.create(s.prototype);return a(d,"_invoke",function(n,r,o){var a,i,s,l=0,d=o||[],u=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,i=0,s=e,p.n=n,c}};function m(n,r){for(i=n,s=r,t=0;!u&&l&&!o&&t<d.length;t++){var o,a=d[t],m=p.p,v=a[2];n>3?(o=v===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=n<2&&m<a[1])?(i=0,p.v=r,p.n=a[1]):m<v&&(o=n<3||a[0]>r||r>v)&&(a[4]=n,a[5]=r,p.n=v,i=0))}if(o||n>1)return c;throw u=!0,r}return function(o,d,v){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,v),i=d,s=v;(t=i<2?e:s)||!u;){a||(i?i<3?(i>1&&(p.n=-1),m(i,s)):p.n=s:p.v=s);try{if(l=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(u=p.n<0)?s:n.call(r,p))!==c)break}catch(t){a=e,i=1,s=t}finally{l=1}}return{value:t,done:u}}}(n,o,i),!0),d}var c={};function l(){}function d(){}function u(){}t=Object.getPrototypeOf;var p=[][r]?t(t([][r]())):(a(t={},r,function(){return this}),t),m=u.prototype=l.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,a(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return d.prototype=u,a(m,"constructor",u),a(u,"constructor",d),d.displayName="GeneratorFunction",a(u,i,"GeneratorFunction"),a(m),a(m,i,"Generator"),a(m,r,function(){return this}),a(m,"toString",function(){return"[object Generator]"}),(o=function(){return{w:s,m:v}})()}function a(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}a=function(e,t,n,r){function i(t,n){a(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},a(e,t,n,r)}function i(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)})}}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function l(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var d=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.investors=[],this.properties=[],this.isModalOpen=!1,this.editingInvestorId=null,this.init()},t=[{key:"init",value:function(){var e=this,t=["investorsList","addInvestorMainBtn","investorCount"].filter(function(e){return!document.getElementById(e)});if(t.length>0)return console.warn("InvestorManagementComponent: Required DOM elements missing:",t),void setTimeout(function(){return e.init()},200);this.bindEvents(),this.loadData()}},{key:"bindEvents",value:function(){var e=this,t=document.getElementById("addInvestorMainBtn");t&&t.addEventListener("click",function(){e.showInvestorModal()})}},{key:"loadData",value:(u=s(o().m(function e(){var t;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Promise.all([this.loadInvestors(),this.loadProperties()]);case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("Error loading data:",t);case 3:return e.p=3,this.renderInvestors(),e.f(3);case 4:return e.a(2)}},e,this,[[0,2,3,4]])})),function(){return u.apply(this,arguments)})},{key:"loadInvestors",value:(d=s(o().m(function e(){var t,n,r;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.INVESTORS);case 1:return t=e.v,e.n=2,t.json();case 2:(n=e.v).success?(this.investors=n.data||[],this.updateInvestorCount()):(this.investors=[],this.showError(n.message||"Failed to load investors")),e.n=4;break;case 3:e.p=3,r=e.v,console.error("Error loading investors:",r),this.investors=[],this.showError("Failed to load investors");case 4:return e.a(2)}},e,this,[[0,3]])})),function(){return d.apply(this,arguments)})},{key:"loadProperties",value:(l=s(o().m(function e(){var t,n,r;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("Loading properties from:",API_CONFIG.BASE_URL+API_CONFIG.ENDPOINTS.PROPERTIES),e.n=1,API.get(API_CONFIG.ENDPOINTS.PROPERTIES);case 1:if((t=e.v).ok){e.n=2;break}return console.warn("Properties API returned ".concat(t.status,": ").concat(t.statusText)),401!==t.status&&403!==t.status||console.warn("Authentication required for properties API"),this.properties=[],e.a(2);case 2:return e.n=3,t.json();case 3:n=e.v,console.log("Properties API response:",n),n.success&&Array.isArray(n.properties)?(this.properties=n.properties,console.log("Loaded ".concat(this.properties.length," properties:"),this.properties)):(console.warn("Properties API response format issue:",n),this.properties=[]),e.n=5;break;case 4:e.p=4,r=e.v,console.error("Error loading properties:",r),this.properties=[];case 5:return e.a(2)}},e,this,[[0,4]])})),function(){return l.apply(this,arguments)})},{key:"updateInvestorCount",value:function(){var e=document.getElementById("investorCount");e&&(e.textContent=this.investors.length)}},{key:"renderInvestors",value:function(){var e=document.getElementById("investorsList");if(e)if(0!==this.investors.length){var t='<div class="row">';this.investors.forEach(function(e){var n=e.properties?e.properties.length:0,r=e.properties?e.properties.reduce(function(e,t){return e+t.percentage},0):0;t+='\n        <div class="col-md-6 col-lg-4 mb-4">\n          <div class="card investor-card h-100">\n            <div class="card-header d-flex justify-content-between align-items-center">\n              <div>\n                <h6 class="mb-0">'.concat(escapeHtml(e.name),'</h6>\n                <small class="text-muted">ID: ').concat(e.investorId,'</small>\n              </div>\n              <div class="dropdown">\n                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">\n                  <i class="bi bi-three-dots"></i>\n                </button>\n                <ul class="dropdown-menu">\n                  <li><a class="dropdown-item" href="#" onclick="window.investorManager.editInvestor(\'').concat(e.investorId,'\')">\n                    <i class="bi bi-pencil me-2"></i>Edit\n                  </a></li>\n                  <li><a class="dropdown-item text-danger" href="#" onclick="window.investorManager.deleteInvestor(\'').concat(e.investorId,'\')">\n                    <i class="bi bi-trash me-2"></i>Delete\n                  </a></li>\n                </ul>\n              </div>\n            </div>\n            <div class="card-body">\n              ').concat(e.username?'<p class="mb-2"><strong>Username:</strong> '.concat(escapeHtml(e.username),"</p>"):"","\n              ").concat(e.email?'<p class="mb-2"><strong>Email:</strong> '.concat(escapeHtml(e.email),"</p>"):"","\n              ").concat(e.phone?'<p class="mb-2"><strong>Phone:</strong> '.concat(escapeHtml(e.phone),"</p>"):"",'\n              \n              <hr>\n              <div class="d-flex justify-content-between align-items-center mb-2">\n                <span><strong>Properties:</strong></span>\n                <span class="badge bg-primary">').concat(n,"</span>\n              </div>\n              \n              ").concat(n>0?'\n                <div class="properties-list">\n                  '.concat(e.properties.map(function(e){return'\n                    <div class="d-flex justify-content-between align-items-center mb-1">\n                      <span class="property-badge badge bg-light text-dark">'.concat(e.propertyId,'</span>\n                      <span class="percentage-display">').concat(e.percentage,"%</span>\n                    </div>\n                  ")}).join(""),'\n                </div>\n                <div class="mt-2 pt-2 border-top">\n                  <small class="text-muted">Total Investment: <strong class="percentage-display">').concat(r,"%</strong></small>\n                </div>\n              "):'\n                <div class="text-center text-muted">\n                  <small>No property investments</small>\n                </div>\n              ','\n            </div>\n            <div class="card-footer bg-transparent">\n              <div class="btn-group w-100" role="group">\n                <button class="btn btn-sm btn-outline-primary" onclick="window.investorManager.addPropertyToInvestor(\'').concat(e.investorId,'\')">\n                  <i class="bi bi-plus me-1"></i>Add Property\n                </button>\n                <button class="btn btn-sm btn-outline-info" onclick="window.investorManager.viewInvestorDetails(\'').concat(e.investorId,'\')">\n                  <i class="bi bi-eye me-1"></i>Details\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      ')}),t+="</div>",e.innerHTML=t}else e.innerHTML='\n        <div class="text-center py-5">\n          <i class="bi bi-person-badge fs-1 text-muted"></i>\n          <p class="mt-3 text-muted">No investors found</p>\n          <button class="btn btn-primary" onclick="window.investorManager.showInvestorModal()">\n            <i class="bi bi-plus-circle me-1"></i>Add First Investor\n          </button>\n        </div>\n      ';else console.warn("investorsList element not found")}},{key:"showInvestorModal",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this.isModalOpen){this.isModalOpen=!0,this.editingInvestorId=t;var n=!!t,r=n?"Edit Investor":"Add Investor",o='\n      <div class="modal fade" id="investorModal" tabindex="-1">\n        <div class="modal-dialog modal-lg">\n          <div class="modal-content">\n            <div class="modal-header">\n              <h5 class="modal-title">\n                <i class="bi bi-person-'.concat(n?"gear":"plus",' me-2"></i>').concat(r,'\n              </h5>\n              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>\n            </div>\n            <form id="investorForm">\n              <div class="modal-body">\n                <div class="row">\n                  <div class="col-md-6">\n                    <div class="mb-3">\n                      <label class="form-label">Username <span class="text-danger">*</span></label>\n                      <input type="text" class="form-control" name="username" required>\n                    </div>\n                  </div>\n                  <div class="col-md-6">\n                    <div class="mb-3">\n                      <label class="form-label">Full Name <span class="text-danger">*</span></label>\n                      <input type="text" class="form-control" name="name" required>\n                    </div>\n                  </div>\n                </div>\n                \n                <div class="row">\n                  <div class="col-md-6">\n                    <div class="mb-3">\n                      <label class="form-label">Email</label>\n                      <input type="email" class="form-control" name="email">\n                    </div>\n                  </div>\n                  <div class="col-md-6">\n                    <div class="mb-3">\n                      <label class="form-label">Phone</label>\n                      <input type="tel" class="form-control" name="phone">\n                    </div>\n                  </div>\n                </div>\n                \n                <hr>\n                <h6><i class="bi bi-building me-2"></i>Property Investments</h6>\n                <div id="propertiesList">\n                  <div class="text-muted">Loading properties...</div>\n                </div>\n                <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="addPropertyBtn">\n                  <i class="bi bi-plus me-1"></i>Add Property\n                </button>\n              </div>\n              <div class="modal-footer">\n                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>\n                <button type="submit" class="btn btn-primary">\n                  <i class="bi bi-check-circle me-1"></i>').concat(n?"Update":"Create"," Investor\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      </div>\n    ");document.body.insertAdjacentHTML("beforeend",o);var a=new bootstrap.Modal(document.getElementById("investorModal"));n?this.populateInvestorForm(t):this.renderPropertiesInModal([]),this.bindModalEvents(),document.getElementById("investorModal").addEventListener("hidden.bs.modal",function(){e.isModalOpen=!1,e.editingInvestorId=null,document.getElementById("investorModal").remove()}),a.show()}}},{key:"populateInvestorForm",value:function(e){var t=this.investors.find(function(t){return t.investorId===e});if(t){var n=document.getElementById("investorForm");n.querySelector('[name="username"]').value=t.username||"",n.querySelector('[name="name"]').value=t.name||"",n.querySelector('[name="email"]').value=t.email||"",n.querySelector('[name="phone"]').value=t.phone||"",this.renderPropertiesInModal(t.properties||[])}}},{key:"renderPropertiesInModal",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=document.getElementById("propertiesList");if(n){console.log("Rendering properties modal with:",{investorProperties:t,systemProperties:this.properties});var r='<div class="property-investments">';t.forEach(function(t,n){var o=e.properties.find(function(e){return e.propertyId===t.propertyId||e.propertyId===String(t.propertyId)||String(e.propertyId)===String(t.propertyId)});console.log("Investment ".concat(n,":"),{investment:t,foundProperty:o}),r+='\n        <div class="property-row mb-3 p-3 border rounded" data-index="'.concat(n,'">\n          <div class="row align-items-start">\n            <div class="col-md-8">\n              <div class="mb-2">\n                <strong class="text-primary">Property ID: ').concat(t.propertyId,"</strong>\n                ").concat(o?'\n                  <div class="p-2 bg-light rounded">\n                    <div><strong>Property ID:</strong> '.concat(escapeHtml(o.propertyId),'</div>\n                    <div><strong>Address:</strong> <i class="bi bi-geo-alt me-1"></i>').concat(escapeHtml(o.address||"Address not available"),"</div>\n                    <div><strong>Unit:</strong> ").concat(escapeHtml(o.unit||"No unit specified"),"</div>\n                    <div><strong>Rent:</strong> $").concat(o.rent||"N/A","</div>\n                    <div><strong>Max Pax:</strong> ").concat(o.maxPax||"N/A","</div>\n                    ").concat(o.agentName?"<div><strong>Agent:</strong> ".concat(escapeHtml(o.agentName),"</div>"):"","\n                  </div>\n                "):'\n                  <div class="p-2 bg-warning bg-opacity-10 rounded">\n                    <div><i class="bi bi-exclamation-triangle me-2 text-warning"></i><strong>Property Details Unavailable</strong></div>\n                    <small class="text-muted">Property data could not be loaded from the system. The investment record shows Property ID: '.concat(t.propertyId,"</small>\n                  </div>\n                "),'\n              </div>\n              <input type="hidden" name="properties[').concat(n,'][propertyId]" value="').concat(t.propertyId,'">\n            </div>\n            <div class="col-md-3">\n              <div class="mb-2">\n                <label class="form-label fw-bold text-success">Investment %</label>\n                <div class="input-group">\n                  <input type="number" class="form-control" name="properties[').concat(n,'][percentage]" \n                         placeholder="Percentage" min="0" max="100" step="0.1" \n                         value="').concat(t.percentage,'" required>\n                  <span class="input-group-text">%</span>\n                </div>\n              </div>\n            </div>\n            <div class="col-md-1">\n              <button type="button" class="btn btn-sm btn-outline-danger" onclick="this.closest(\'.property-row\').remove()" title="Remove Property">\n                <i class="bi bi-trash"></i>\n              </button>\n            </div>\n          </div>\n        </div>\n      ')}),r+="</div>",0===this.properties.length&&0===t.length?r+='<div class="alert alert-info mt-2"><small><i class="bi bi-info-circle me-1"></i>No properties or investments to display. Add properties to the system first, then assign them to investors.</small></div>':0===this.properties.length&&t.length>0&&(r+='<div class="alert alert-warning mt-2"><small><i class="bi bi-exclamation-triangle me-1"></i>Unable to load property details from the system (check authentication or API connection). Investment records are preserved and shown above.</small></div>'),n.innerHTML=r}}},{key:"bindModalEvents",value:function(){var e=this,t=document.getElementById("addPropertyBtn");t&&t.addEventListener("click",function(){e.addPropertyRowToModal()});var n=document.getElementById("investorForm");n&&n.addEventListener("submit",function(t){t.preventDefault(),e.saveInvestor()})}},{key:"addPropertyRowToModal",value:function(){var e=document.getElementById("propertiesList");if(e)if(0!==this.properties.length){var t=e.querySelector(".property-investments");if(t){var n=t.querySelectorAll(".property-row").length,r='\n      <div class="property-row mb-3 p-3 border rounded bg-light" data-index="'.concat(n,'">\n        <div class="row align-items-start">\n          <div class="col-md-8">\n            <div class="mb-2">\n              <label class="form-label fw-bold text-primary">Select Property</label>\n              <select class="form-select" name="properties[').concat(n,"][propertyId]\" required onchange=\"this.closest('.property-row').querySelector('.property-preview').style.display = this.value ? 'block' : 'none'\">\n                <option value=\"\">Choose a property...</option>\n                ").concat(this.properties.map(function(e){return'\n                  <option value="'.concat(e.propertyId,'" \n                          data-address="').concat(e.address||"",'" \n                          data-unit="').concat(e.unit||"",'" \n                          data-rent="').concat(e.rent||"",'">\n                    ID: ').concat(e.propertyId," - ").concat(e.address||"No address").concat(e.unit?", "+e.unit:""," ($").concat(e.rent||"N/A",")\n                  </option>\n                ")}).join(""),'\n              </select>\n            </div>\n            <div class="property-preview mt-2" style="display: none;">\n              <div class="text-muted small">\n                <div><strong>Address:</strong> <span class="preview-address">-</span></div>\n                <div><strong>Unit:</strong> <span class="preview-unit">-</span></div>\n              </div>\n            </div>\n          </div>\n          <div class="col-md-3">\n            <div class="mb-2">\n              <label class="form-label fw-bold text-success">Investment %</label>\n              <div class="input-group">\n                <input type="number" class="form-control" name="properties[').concat(n,'][percentage]" \n                       placeholder="0.0" min="0" max="100" step="0.1" required>\n                <span class="input-group-text">%</span>\n              </div>\n            </div>\n          </div>\n          <div class="col-md-1">\n            <button type="button" class="btn btn-sm btn-outline-danger" onclick="this.closest(\'.property-row\').remove()" title="Remove Property">\n              <i class="bi bi-trash"></i>\n            </button>\n          </div>\n        </div>\n      </div>\n    ');t.insertAdjacentHTML("beforeend",r)}else this.renderPropertiesInModal([])}else this.showError("No properties available to add. Please add properties to the system first.")}},{key:"saveInvestor",value:(i=s(o().m(function e(){var t,r,a,i,s,c,l,d,u,p,m;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.getElementById("investorForm"),r=new FormData(t),e.p=1,a={username:r.get("username"),name:r.get("name"),email:r.get("email"),phone:r.get("phone"),properties:[]},console.log("Saving investor data:",a),i=t.querySelectorAll(".property-row"),console.log("Found property rows:",i.length),i.forEach(function(e,t){var n=e.querySelector('select[name*="propertyId"]'),r=e.querySelector('input[name*="propertyId"][type="hidden"]'),o=n?n.value:r?r.value:null,i=parseFloat(e.querySelector('input[type="number"]').value);console.log("Row ".concat(t,":"),{propertyId:o,percentage:i,hasSelect:!!n,hasHidden:!!r}),o&&!isNaN(i)&&a.properties.push({propertyId:o,percentage:i})}),console.log("Final investor data to save:",a),!this.editingInvestorId){e.n=5;break}return console.log("Updating investor with ID:",this.editingInvestorId),e.n=2,API.put(API_CONFIG.ENDPOINTS.INVESTOR_BY_ID(this.editingInvestorId),a);case 2:return s=e.v,console.log("Update response status:",s.status),e.n=3,s.json();case 3:if(c=e.v,console.log("Update result:",c),s.ok&&c.success){e.n=4;break}throw new Error(c.message||"API returned ".concat(s.status,": ").concat(s.statusText));case 4:this.showSuccess("Investor updated successfully"),e.n=10;break;case 5:return e.n=6,this.generateInvestorId();case 6:return l=e.v,d=n({investorId:l},a),console.log("Creating new investor:",d),e.n=7,API.post(API_CONFIG.ENDPOINTS.INVESTORS,d);case 7:return u=e.v,console.log("Create response status:",u.status),e.n=8,u.json();case 8:if(p=e.v,console.log("Create result:",p),u.ok&&p.success){e.n=9;break}throw new Error(p.message||"API returned ".concat(u.status,": ").concat(u.statusText));case 9:this.showSuccess("Investor created successfully");case 10:return bootstrap.Modal.getInstance(document.getElementById("investorModal")).hide(),e.n=11,this.loadData();case 11:e.n=13;break;case 12:e.p=12,m=e.v,console.error("Error saving investor:",m),this.showError(m.message||"Failed to save investor");case 13:return e.a(2)}},e,this,[[1,12]])})),function(){return i.apply(this,arguments)})},{key:"generateInvestorId",value:(a=s(o().m(function e(){var t,n,r,a;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.INVESTORS);case 1:return t=e.v,e.n=2,t.json();case 2:if(!(n=e.v).success||!n.data){e.n=3;break}return r=0,n.data.forEach(function(e){var t=parseInt(e.investorId);!isNaN(t)&&t>r&&(r=t)}),e.a(2,(r+1).toString());case 3:return e.a(2,"1");case 4:e.n=6;break;case 5:return e.p=5,a=e.v,console.error("Error generating investor ID:",a),e.a(2,Date.now().toString());case 6:return e.a(2)}},e,null,[[0,5]])})),function(){return a.apply(this,arguments)})},{key:"editInvestor",value:function(e){this.showInvestorModal(e)}},{key:"deleteInvestor",value:(r=s(o().m(function e(t){var n,r,a,i,s;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=this.investors.find(function(e){return e.investorId===t})){e.n=1;break}return e.a(2);case 1:if(r='Are you sure you want to delete investor "'.concat(n.name,'"?\n\nThis will remove them from all properties and cannot be undone.'),confirm(r)){e.n=2;break}return e.a(2);case 2:return e.p=2,e.n=3,API.delete(API_CONFIG.ENDPOINTS.INVESTOR_BY_ID(t));case 3:return a=e.v,e.n=4,a.json();case 4:if(!(i=e.v).success){e.n=6;break}return this.showSuccess("Investor deleted successfully"),e.n=5,this.loadData();case 5:e.n=7;break;case 6:throw new Error(i.message||"Failed to delete investor");case 7:e.n=9;break;case 8:e.p=8,s=e.v,console.error("Error deleting investor:",s),this.showError(s.message||"Failed to delete investor");case 9:return e.a(2)}},e,this,[[2,8]])})),function(e){return r.apply(this,arguments)})},{key:"addPropertyToInvestor",value:function(e){this.showInvestorModal(e)}},{key:"viewInvestorDetails",value:function(e){this.investors.find(function(t){return t.investorId===e})&&this.editInvestor(e)}},{key:"showToast",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){"function"==typeof showToast?showToast(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info"):alert(e)})},{key:"showSuccess",value:function(e){this.showToast(e,"success")}},{key:"showError",value:function(e){this.showToast(e,"error")}},{key:"showInfo",value:function(e){this.showToast(e,"info")}}],t&&c(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r,a,i,l,d,u}();window.InvestorManagementComponent=d},280:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function s(t,o,a,i){var s=o&&o.prototype instanceof l?o:l,d=Object.create(s.prototype);return n(d,"_invoke",function(t,n,o){var a,i,s,l=0,d=o||[],u=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,i=0,s=e,p.n=n,c}};function m(t,n){for(i=t,s=n,r=0;!u&&l&&!o&&r<d.length;r++){var o,a=d[r],m=p.p,v=a[2];t>3?(o=v===n)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=t<2&&m<a[1])?(i=0,p.v=n,p.n=a[1]):m<v&&(o=t<3||a[0]>n||n>v)&&(a[4]=t,a[5]=n,p.n=v,i=0))}if(o||t>1)return c;throw u=!0,n}return function(o,d,v){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,v),i=d,s=v;(r=i<2?e:s)||!u;){a||(i?i<3?(i>1&&(p.n=-1),m(i,s)):p.n=s:p.v=s);try{if(l=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(u=p.n<0)?s:t.call(n,p))!==c)break}catch(t){a=e,i=1,s=t}finally{l=1}}return{value:r,done:u}}}(t,a,i),!0),d}var c={};function l(){}function d(){}function u(){}r=Object.getPrototypeOf;var p=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),m=u.prototype=l.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,n(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return d.prototype=u,n(m,"constructor",u),n(u,"constructor",d),d.displayName="GeneratorFunction",n(u,i,"GeneratorFunction"),n(m),n(m,i,"Generator"),n(m,a,function(){return this}),n(m,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m:v}})()}function n(e,t,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}n=function(e,t,r,o){function i(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},n(e,t,r,o)}function r(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var i=e.apply(t,n);function s(e){r(i,o,a,s,c,"next",e)}function c(e){r(i,o,a,s,c,"throw",e)}s(void 0)})}}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var s=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.selectedProperty=null,this.currentDate=new Date,this.currentReport=null,this.investors=[],this.isModalOpen=!1,this.isIncomeExpenseModalOpen=!1,this.editingItem=null,this.editingItemIndex=null,this.pendingDeletes=new Set,this.init()},n=[{key:"init",value:function(){this.bindEvents(),this.loadProperties(),this.forceCleanupModalBackdrops()}},{key:"bindEvents",value:function(){var e=this,n=document.getElementById("propertySelector");n&&n.addEventListener("change",function(t){e.selectProperty(t.target.value)});var r=document.getElementById("prevMonth"),a=document.getElementById("nextMonth");r&&r.addEventListener("click",function(){e.changeMonth(-1)}),a&&a.addEventListener("click",function(){e.changeMonth(1)});var i=document.getElementById("addIncomeBtn"),s=document.getElementById("addExpenseBtn"),c=document.getElementById("addInvestorBtn");i&&i.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.isIncomeExpenseModalOpen||e.showIncomeExpenseModal("income").catch(console.error)}),s&&s.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.isIncomeExpenseModalOpen||e.showIncomeExpenseModal("expense").catch(console.error)}),c&&c.addEventListener("click",function(){var n=o(t().m(function n(r){var o;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:if(r.preventDefault(),r.stopPropagation(),!e.isModalOpen){t.n=1;break}return t.a(2);case 1:return t.p=1,t.n=2,e.showInvestorModal();case 2:t.n=4;break;case 3:t.p=3,o=t.v,console.error("Error showing investor modal:",o),e.isModalOpen=!1;case 4:return t.a(2)}},n,null,[[1,3]])}));return function(e){return n.apply(this,arguments)}}())}},{key:"loadProperties",value:(b=o(t().m(function e(){var n,r,o;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.PROPERTIES);case 1:return n=e.v,e.n=2,n.json();case 2:(r=e.v).success?this.populatePropertySelector(r.properties):401===n.status||403===n.status?(this.showError("Please log in to load properties"),this.populatePropertySelector([])):(this.showError(r.error||"Failed to load properties"),this.populatePropertySelector([])),e.n=4;break;case 3:e.p=3,o=e.v,console.error("Error loading properties:",o),this.showError("Failed to load properties. Please check your connection and try again."),this.populatePropertySelector([]);case 4:return e.a(2)}},e,this,[[0,3]])})),function(){return b.apply(this,arguments)})},{key:"populatePropertySelector",value:function(e){var t=document.getElementById("propertySelector");if(t)if(t.innerHTML="",e&&0!==e.length){var n=document.createElement("option");n.value="",n.textContent="Select a property...",t.appendChild(n),e.forEach(function(e){var n=document.createElement("option");n.value=e.propertyId,n.textContent="".concat(e.propertyId," - ").concat(e.address,", ").concat(e.unit),t.appendChild(n)})}else t.innerHTML='<option value="" disabled>No properties available - please log in or add properties</option>'}},{key:"selectProperty",value:(y=o(t().m(function e(n){return t().w(function(e){for(;;)switch(e.n){case 0:if(this.forceCleanupModalBackdrops(),this.isModalOpen=!1,this.isIncomeExpenseModalOpen=!1,this.editingItem=null,this.editingItemIndex=null,this.pendingDeletes.clear(),n){e.n=1;break}return this.selectedProperty=null,document.getElementById("financialReportContent").style.display="none",e.a(2);case 1:return this.selectedProperty=n,document.getElementById("financialReportContent").style.display="block",e.n=2,this.loadInvestors(n);case 2:return e.n=3,this.loadFinancialReport();case 3:this.updateMonthDisplay();case 4:return e.a(2)}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"loadInvestors",value:(h=o(t().m(function e(n){var r,o,a;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.INVESTORS_BY_PROPERTY(n));case 1:return r=e.v,e.n=2,r.json();case 2:(o=e.v).success&&(this.investors=o.data,this.updateInvestorDisplay()),e.n=4;break;case 3:e.p=3,a=e.v,console.error("Error loading investors:",a),this.investors=[],this.updateInvestorDisplay();case 4:return e.a(2)}},e,this,[[0,3]])})),function(e){return h.apply(this,arguments)})},{key:"loadFinancialReport",value:(f=o(t().m(function e(){var n,r,o,a,i;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.selectedProperty){e.n=1;break}return e.a(2);case 1:return e.p=1,n=this.currentDate.getFullYear(),r=this.currentDate.getMonth()+1,e.n=2,API.get(API_CONFIG.ENDPOINTS.FINANCIAL_REPORT(this.selectedProperty,n,r));case 2:if(!(o=e.v).ok){e.n=4;break}return e.n=3,o.json();case 3:(a=e.v).success?this.currentReport=a.data:this.currentReport=null,e.n=5;break;case 4:404===o.status&&(this.currentReport={propertyId:this.selectedProperty,year:n,month:r,income:[],expenses:[],investorTransactions:[],totalIncome:0,totalExpenses:0,netProfit:0});case 5:this.updateDisplays(),e.n=7;break;case 6:e.p=6,i=e.v,console.error("Error loading financial report:",i),this.currentReport={propertyId:this.selectedProperty,year:this.currentDate.getFullYear(),month:this.currentDate.getMonth()+1,income:[],expenses:[],investorTransactions:[],totalIncome:0,totalExpenses:0,netProfit:0},this.updateDisplays();case 7:return e.a(2)}},e,this,[[1,6]])})),function(){return f.apply(this,arguments)})},{key:"updateDisplays",value:function(){this.updateIncomeDisplay(),this.updateExpenseDisplay(),this.updateSummaryDisplay(),this.updateInvestorDisplay()}},{key:"updateIncomeDisplay",value:function(){var e=this,t=document.getElementById("incomeList"),n=document.getElementById("totalIncome");if(!this.currentReport||!this.currentReport.income||0===this.currentReport.income.length)return t.innerHTML='\n                <div class="text-center text-muted py-4" id="noIncomeMessage">\n                    <i class="bi bi-plus-circle fs-1"></i>\n                    <p class="mt-2">No income items added</p>\n                </div>\n            ',void(n&&(n.textContent="$0.00"));var r="",o=0;this.currentReport.income.forEach(function(t,n){o+=t.amount;var a=e.investors.find(function(e){return e.investorId===t.personInCharge}),i=a?a.name:t.personInCharge,s="income-".concat(n),c=e.pendingDeletes.has(s);r+='\n                <div class="border-bottom py-2 mb-2">\n                    <div class="d-flex justify-content-between align-items-start">\n                        <div class="flex-grow-1">\n                            <h6 class="mb-1">'.concat(escapeHtml(t.item),'</h6>\n                            <small class="text-muted">\n                                Person: ').concat(escapeHtml(i)).concat(t.recipientAccountDetail?" | Account: "+escapeHtml(t.recipientAccountDetail):"",'\n                            </small>\n                        </div>\n                        <div class="text-end">\n                            <div class="fw-bold text-success">$').concat(t.amount.toFixed(2),'</div>\n                        </div>\n                    </div>\n                    <div class="mt-2">\n                        <button class="btn btn-sm btn-outline-primary me-2" id="editIncomeBtn-').concat(n,"\" onclick=\"window.financialReports.editItem('income', ").concat(n,')">\n                            <span class="edit-icon"><i class="bi bi-pencil"></i></span>\n                            <span class="loading-spinner d-none">\n                                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n                            </span>\n                        </button>\n                        ').concat(c?'<button class="btn btn-sm btn-success" onclick="window.financialReports.confirmDeleteItem(\'income\', '.concat(n,')" title="Click to confirm deletion">\n                               <i class="bi bi-check-circle"></i>\n                             </button>\n                             <button class="btn btn-sm btn-outline-secondary ms-1" onclick="window.financialReports.cancelDeleteItem(\'income\', ').concat(n,')" title="Cancel deletion">\n                               <i class="bi bi-x-circle"></i>\n                             </button>'):'<button class="btn btn-sm btn-outline-danger" onclick="window.financialReports.toggleDeleteConfirm(\'income\', '.concat(n,')">\n                               <i class="bi bi-trash"></i>\n                             </button>'),"\n                    </div>\n                </div>\n            ")}),t.innerHTML=r,n&&(n.textContent="$".concat(o.toFixed(2)))}},{key:"updateExpenseDisplay",value:function(){var e=this,t=document.getElementById("expenseList"),n=document.getElementById("totalExpenses");if(!this.currentReport||!this.currentReport.expenses||0===this.currentReport.expenses.length)return t.innerHTML='\n                <div class="text-center text-muted py-4">\n                    <i class="bi bi-dash-circle fs-1"></i>\n                    <p class="mt-2">No expense items added</p>\n                </div>\n            ',void(n&&(n.textContent="$0.00"));var r="",o=0;this.currentReport.expenses.forEach(function(t,n){o+=t.amount;var a=e.investors.find(function(e){return e.investorId===t.personInCharge}),i=a?a.name:t.personInCharge,s="expense-".concat(n),c=e.pendingDeletes.has(s);r+='\n                <div class="border-bottom py-2 mb-2">\n                    <div class="d-flex justify-content-between align-items-start">\n                        <div class="flex-grow-1">\n                            <h6 class="mb-1">'.concat(escapeHtml(t.item),'</h6>\n                            <small class="text-muted">\n                                Person: ').concat(escapeHtml(i)).concat(t.recipientAccountDetail?" | Account: "+escapeHtml(t.recipientAccountDetail):"",'\n                            </small>\n                        </div>\n                        <div class="text-end">\n                            <div class="fw-bold text-danger">$').concat(t.amount.toFixed(2),'</div>\n                        </div>\n                    </div>\n                    <div class="mt-2">\n                        <button class="btn btn-sm btn-outline-primary me-2" id="editExpenseBtn-').concat(n,"\" onclick=\"window.financialReports.editItem('expense', ").concat(n,')">\n                            <span class="edit-icon"><i class="bi bi-pencil"></i></span>\n                            <span class="loading-spinner d-none">\n                                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n                            </span>\n                        </button>\n                        ').concat(c?'<button class="btn btn-sm btn-success" onclick="window.financialReports.confirmDeleteItem(\'expense\', '.concat(n,')" title="Click to confirm deletion">\n                               <i class="bi bi-check-circle"></i>\n                             </button>\n                             <button class="btn btn-sm btn-outline-secondary ms-1" onclick="window.financialReports.cancelDeleteItem(\'expense\', ').concat(n,')" title="Cancel deletion">\n                               <i class="bi bi-x-circle"></i>\n                             </button>'):'<button class="btn btn-sm btn-outline-danger" onclick="window.financialReports.toggleDeleteConfirm(\'expense\', '.concat(n,')">\n                               <i class="bi bi-trash"></i>\n                             </button>'),"\n                    </div>\n                </div>\n            ")}),t.innerHTML=r,n&&(n.textContent="$".concat(o.toFixed(2)))}},{key:"updateSummaryDisplay",value:function(){if(this.currentReport){var e=(this.currentReport.totalIncome||0)-(this.currentReport.totalExpenses||0),t=document.getElementById("netProfit");t&&(t.textContent="$".concat(e.toFixed(2)),t.className=e>=0?"text-success mb-0":"text-danger mb-0")}}},{key:"updateInvestorDisplay",value:function(){var e=this,t=document.getElementById("investorDistribution");if(this.investors&&0!==this.investors.length){var n=this.currentReport?(this.currentReport.totalIncome||0)-(this.currentReport.totalExpenses||0):0,r="";this.investors.forEach(function(t){var o=t.properties.find(function(t){return t.propertyId===e.selectedProperty}),a=o?o.percentage:0,i=n*a/100,s=e.currentReport&&e.currentReport.investorTransactions?e.currentReport.investorTransactions.find(function(e){return e.investorId===t.investorId}):null,c=s?s.alreadyPaid:0,l=s?s.alreadyReceived:0,d=e.currentReport&&e.currentReport.expenses?e.currentReport.expenses.filter(function(e){return e.personInCharge===t.investorId}).reduce(function(e,t){return e+t.amount},0):0,u=e.currentReport&&e.currentReport.income?e.currentReport.income.filter(function(e){return e.personInCharge===t.investorId}).reduce(function(e,t){return e+t.amount},0):0,p=i-c+l+d-u;r+='\n                <div class="card mb-2">\n                    <div class="card-body py-2">\n                        \x3c!-- Mobile layout --\x3e\n                        <div class="d-md-none">\n                            <div class="d-flex justify-content-between align-items-start mb-2">\n                                <div>\n                                    <h6 class="mb-1">'.concat(escapeHtml(t.name),'</h6>\n                                    <small class="text-muted">').concat(t.investorId,"</small>\n                                    ").concat(t.phone?'<br><small class="text-muted">'.concat(escapeHtml(t.phone),"</small>"):"",'\n                                </div>\n                                <div class="text-end">\n                                    <button class="btn btn-sm btn-outline-primary me-1" onclick="window.financialReports.editInvestor(\'').concat(t.investorId,'\')" title="Edit">\n                                        <i class="bi bi-pencil"></i>\n                                    </button>\n                                    <button class="btn btn-sm btn-outline-danger" onclick="window.financialReports.removeInvestor(\'').concat(t.investorId,'\')" title="Remove">\n                                        <i class="bi bi-trash"></i>\n                                    </button>\n                                </div>\n                            </div>\n                            <div class="row text-center">\n                                <div class="col-4">\n                                    <div class="fw-bold">').concat(a,'%</div>\n                                    <small class="text-muted">Share</small>\n                                </div>\n                                <div class="col-4">\n                                    <div class="fw-bold text-primary">$').concat(i.toFixed(2),'</div>\n                                    <small class="text-muted">Profit Share</small>\n                                </div>\n                                <div class="col-4">\n                                    <div class="fw-bold text-warning">$').concat(d.toFixed(2),'</div>\n                                    <small class="text-muted">Paid</small>\n                                </div>\n                            </div>\n                            <div class="row text-center mt-2">\n                                <div class="col-6">\n                                    <div class="fw-bold text-info">$').concat(u.toFixed(2),'</div>\n                                    <small class="text-muted">Received</small>\n                                </div>\n                                <div class="col-6">\n                                    <div class="fw-bold ').concat(p>=0?"text-success":"text-danger",'">\n                                        $').concat(p.toFixed(2),'\n                                    </div>\n                                    <small class="text-muted">Final</small>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Desktop layout --\x3e\n                        <div class="row align-items-center d-none d-md-flex">\n                            <div class="col-md-3 col-lg-2">\n                                <h6 class="mb-0">').concat(escapeHtml(t.name),'</h6>\n                                <small class="text-muted">').concat(t.investorId,"</small>\n                                ").concat(t.phone?'<br><small class="text-muted">'.concat(escapeHtml(t.phone),"</small>"):"",'\n                            </div>\n                            <div class="col-md-1 col-lg-1 text-center">\n                                <div class="fw-bold">').concat(a,'%</div>\n                                <small class="text-muted">Share</small>\n                            </div>\n                            <div class="col-md-2 col-lg-2 text-center">\n                                <div class="fw-bold text-primary">$').concat(i.toFixed(2),'</div>\n                                <small class="text-muted">Profit Share</small>\n                            </div>\n                            <div class="col-md-2 col-lg-2 text-center">\n                                <div class="fw-bold text-warning">$').concat(d.toFixed(2),'</div>\n                                <small class="text-muted">Paid</small>\n                            </div>\n                            <div class="col-md-2 col-lg-2 text-center">\n                                <div class="fw-bold text-info">$').concat(u.toFixed(2),'</div>\n                                <small class="text-muted">Received</small>\n                            </div>\n                            <div class="col-md-1 col-lg-2 text-center">\n                                <div class="fw-bold ').concat(p>=0?"text-success":"text-danger",'">\n                                    $').concat(p.toFixed(2),'\n                                </div>\n                                <small class="text-muted">Final</small>\n                            </div>\n                            <div class="col-md-1 col-lg-1 text-end">\n                                <button class="btn btn-sm btn-outline-primary me-1" onclick="window.financialReports.editInvestor(\'').concat(t.investorId,'\')" title="Edit">\n                                    <i class="bi bi-pencil"></i>\n                                </button>\n                                <button class="btn btn-sm btn-outline-danger" onclick="window.financialReports.removeInvestor(\'').concat(t.investorId,'\')" title="Remove">\n                                    <i class="bi bi-trash"></i>\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            ')}),t.innerHTML=r}else t.innerHTML='\n                <div class="text-center text-muted py-3">\n                    <i class="bi bi-person-lines-fill fs-1"></i>\n                    <p class="mt-2">No investors configured for this property</p>\n                </div>\n            '}},{key:"updateMonthDisplay",value:function(){var e=document.getElementById("currentMonth"),t=document.getElementById("currentMonthBadge");if(e){var n=["January","February","March","April","May","June","July","August","September","October","November","December"][this.currentDate.getMonth()],r=this.currentDate.getFullYear();e.textContent="".concat(n," ").concat(r)}if(t){var o=new Date,a=this.currentDate.getMonth()===o.getMonth()&&this.currentDate.getFullYear()===o.getFullYear();t.textContent=a?"Current Month":"Historical";var i=window.innerWidth<768?"":"fs-6";t.className=a?"badge bg-info ".concat(i).trim():"badge bg-secondary ".concat(i).trim()}}},{key:"changeMonth",value:function(e){var t=new Date(this.currentDate);t.setMonth(t.getMonth()+e),this.currentDate=t,this.updateMonthDisplay(),this.loadFinancialReport()}},{key:"showIncomeExpenseModal",value:(v=o(t().m(function e(n){var r,o,a,i,s,c,l=this,d=arguments;return t().w(function(e){for(;;)switch(e.n){case 0:if(r=d.length>1&&void 0!==d[1]?d[1]:null,o=d.length>2&&void 0!==d[2]?d[2]:null,!this.isIncomeExpenseModalOpen){e.n=1;break}return e.a(2);case 1:if(this.investors&&0!==this.investors.length){e.n=2;break}return this.showError("Please add investors to this property before adding ".concat(n," items.")),e.a(2);case 2:return this.isIncomeExpenseModalOpen=!0,this.editingItem=r,this.editingItemIndex=o,this.cleanupExistingModals(),a=this.createIncomeExpenseModalHtml(n,r),document.body.insertAdjacentHTML("beforeend",a),e.n=3,new Promise(function(e){return setTimeout(e,10)});case 3:if(i=document.getElementById("incomeExpenseModal")){e.n=4;break}return console.error("Modal element not found in DOM"),this.isIncomeExpenseModalOpen=!1,e.a(2);case 4:s=new bootstrap.Modal(i,{backdrop:!0,keyboard:!0,focus:!1}),i.addEventListener("shown.bs.modal",function(){var e=i.querySelector('input[name="item"]');e&&(i.querySelectorAll("input, select, textarea").forEach(function(e){e.removeAttribute("disabled"),e.removeAttribute("readonly"),e.style.pointerEvents="auto",e.tabIndex=0,e.addEventListener("click",function(e){e.stopPropagation(),this.focus()}),e.addEventListener("mousedown",function(e){e.stopPropagation()})}),setTimeout(function(){e.focus()},100),setTimeout(function(){e.focus(),e.select()},300))}),i.addEventListener("hidden.bs.modal",function(){null===l.editingItemIndex||l._modalClosedBySuccess||l.setEditButtonLoading(n,l.editingItemIndex,!1),l._modalClosedBySuccess=!1,l.isIncomeExpenseModalOpen=!1,l.editingItem=null,l.editingItemIndex=null,i.remove(),setTimeout(function(){l.forceCleanupModalBackdrops()},100)}),s.show(),(c=document.getElementById("incomeExpenseForm"))&&c.addEventListener("submit",function(e){e.preventDefault(),"true"!==c.dataset.submitting&&(c.dataset.submitting="true",l.saveIncomeExpenseItem(n,s).finally(function(){c.dataset.submitting="false"}))});case 5:return e.a(2)}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"generateInvestorOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.investors&&0!==this.investors.length?this.investors.map(function(t){var n=t.investorId===e?" selected":"";return'<option value="'.concat(t.investorId,'"').concat(n,">").concat(escapeHtml(t.name)," (ID: ").concat(t.investorId,")</option>")}).join(""):'<option value="" disabled>No investors available for this property</option>'}},{key:"createIncomeExpenseModalHtml",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n="income"===e,r=null!==t,o=r?n?"Edit Income Item":"Edit Expense Item":n?"Add Income Item":"Add Expense Item",a=n?"plus-circle":"dash-circle",i="pencil",s=n?"success":"danger",c=r?"Update":"Add",l=r?i:a,d=t?escapeHtml(t.item):"",u=t?t.amount:"",p=t?t.personInCharge:"",m=t?escapeHtml(t.recipientAccountDetail||""):"",v=t&&t.date?new Date(t.date).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0];return'\n            <div class="modal fade" id="incomeExpenseModal" tabindex="-1" aria-labelledby="incomeExpenseModalLabel" aria-hidden="true">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h5 class="modal-title" id="incomeExpenseModalLabel">\n                                <i class="bi bi-'.concat(r?i:a,' me-2"></i>').concat(o,'\n                            </h5>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                        </div>\n                        <form id="incomeExpenseForm">\n                            <div class="modal-body">\n                                <div class="mb-3">\n                                    <label class="form-label">Item Description <span class="text-danger">*</span></label>\n                                    <input type="text" class="form-control" name="item" required placeholder="e.g., Rent, Utilities, Repairs" autocomplete="off" value="').concat(d,'">\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Amount (SGD) <span class="text-danger">*</span></label>\n                                    <div class="input-group">\n                                        <span class="input-group-text">$</span>\n                                        <input type="number" class="form-control" name="amount" required min="0" step="0.01" placeholder="0.00" autocomplete="off" value="').concat(u,'">\n                                    </div>\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Date <span class="text-danger">*</span></label>\n                                    <input type="date" class="form-control" name="date" required value="').concat(v,'">\n                                    <div class="form-text">Date when this ').concat(e,' occurred</div>\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Person in Charge <span class="text-danger">*</span></label>\n                                    <select class="form-select" name="personInCharge" required>\n                                        <option value="">Select investor...</option>\n                                        ').concat(this.generateInvestorOptions(p),'\n                                    </select>\n                                    <div class="form-text">Select the investor responsible for this ').concat(e,'</div>\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Account Details</label>\n                                    <input type="text" class="form-control" name="recipientAccountDetail" placeholder="Bank or payment details (optional)" autocomplete="off" value="').concat(m,'">\n                                    <div class="form-text">Optional: Add bank account or payment method details</div>\n                                </div>\n                            </div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>\n                                <button type="submit" class="btn btn-').concat(s,'">\n                                    <i class="bi bi-').concat(l,' me-1"></i>').concat(c," ").concat(n?"Income":"Expense","\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                </div>\n            </div>\n        ")}},{key:"saveIncomeExpenseItem",value:(m=o(t().m(function e(n,r){var o,a,i,s,c,l,d,u,p,m,v,f,h=this;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(o=document.getElementById("incomeExpenseForm"),a=new FormData(o),i={item:a.get("item"),amount:parseFloat(a.get("amount")),date:a.get("date"),personInCharge:a.get("personInCharge"),recipientAccountDetail:a.get("recipientAccountDetail")},e.p=1,s=this.currentDate.getFullYear(),c=this.currentDate.getMonth()+1,(l=null!==this.editingItem)?(d=("income"===n?API_CONFIG.ENDPOINTS.FINANCIAL_REPORT_INCOME(this.selectedProperty,s,c):API_CONFIG.ENDPOINTS.FINANCIAL_REPORT_EXPENSES(this.selectedProperty,s,c))+"/".concat(this.editingItemIndex),u="PUT"):(d="income"===n?API_CONFIG.ENDPOINTS.FINANCIAL_REPORT_INCOME(this.selectedProperty,s,c):API_CONFIG.ENDPOINTS.FINANCIAL_REPORT_EXPENSES(this.selectedProperty,s,c),u="POST"),"PUT"!==u){e.n=3;break}return e.n=2,API.put(d,i);case 2:v=e.v,e.n=5;break;case 3:return e.n=4,API.post(d,i);case 4:v=e.v;case 5:return p=v,e.n=6,p.json();case 6:if(!(m=e.v).success){e.n=8;break}return this._modalClosedBySuccess=!0,this.isIncomeExpenseModalOpen=!1,this.editingItem=null,this.editingItemIndex=null,r.hide(),setTimeout(function(){h.forceCleanupModalBackdrops()},150),e.n=7,this.loadFinancialReport();case 7:this.showSuccess("".concat(n.charAt(0).toUpperCase()+n.slice(1)," item ").concat(l?"updated":"added"," successfully")),e.n=9;break;case 8:throw new Error(m.message||"Failed to ".concat(l?"update":"add"," ").concat(n," item"));case 9:e.n=11;break;case 10:e.p=10,f=e.v,console.error("Error saving ".concat(n," item:"),f),this.showError(f.message||"Failed to ".concat(isEditing?"update":"add"," ").concat(n," item"));case 11:return e.p=11,null!==this.editingItemIndex&&this.setEditButtonLoading(n,this.editingItemIndex,!1),e.f(11);case 12:return e.a(2)}},e,this,[[1,10,11,12]])})),function(e,t){return m.apply(this,arguments)})},{key:"showInvestorModal",value:(p=o(t().m(function e(){var n,r,o,a,i,s=this,c=arguments;return t().w(function(e){for(;;)switch(e.n){case 0:if(n=c.length>0&&void 0!==c[0]?c[0]:null,!this.isModalOpen){e.n=1;break}return e.a(2);case 1:return this.isModalOpen=!0,this.cleanupExistingModals(),r=this.createInvestorModalHtml(n),document.body.insertAdjacentHTML("beforeend",r),e.n=2,new Promise(function(e){return setTimeout(e,10)});case 2:if(o=document.getElementById("investorModal")){e.n=3;break}return console.error("Investor modal element not found in DOM"),this.isModalOpen=!1,e.a(2);case 3:a=new bootstrap.Modal(o,{backdrop:!0,keyboard:!0,focus:!1}),o.addEventListener("shown.bs.modal",function(){n&&s.fillInvestorForm(n);var e=o.querySelector('input[name="username"]');e&&e.focus()}),o.addEventListener("hidden.bs.modal",function(){s.isModalOpen=!1,o.remove(),setTimeout(function(){s.forceCleanupModalBackdrops()},100)}),a.show(),(i=document.getElementById("investorForm")).addEventListener("submit",function(e){e.preventDefault(),"true"!==i.dataset.submitting&&(i.dataset.submitting="true",s.saveInvestor(n,a).finally(function(){i.dataset.submitting="false"}))});case 4:return e.a(2)}},e,this)})),function(){return p.apply(this,arguments)})},{key:"cleanupExistingModals",value:function(){["investorModal","incomeExpenseModal"].forEach(function(e){var t=document.getElementById(e);if(t){try{var n=bootstrap.Modal.getInstance(t);n&&(n.hide(),n.dispose())}catch(e){}t.remove()}}),this.forceCleanupModalBackdrops()}},{key:"forceCleanupModalBackdrops",value:function(){document.querySelectorAll(".modal-backdrop").forEach(function(e){e.remove()}),document.querySelectorAll(".modal").forEach(function(e){"investorModal"!==e.id&&"incomeExpenseModal"!==e.id||e.remove()}),document.body.classList.remove("modal-open"),document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right"),document.body.style.removeProperty("margin-right"),document.body.offsetHeight}},{key:"createInvestorModalHtml",value:function(e){var t=!!e;return'\n            <div class="modal fade" id="investorModal" tabindex="-1" aria-labelledby="investorModalLabel" aria-hidden="true">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h5 class="modal-title" id="investorModalLabel">\n                                <i class="bi bi-person-plus me-2"></i>'.concat(t?"Edit Investor":"Add Investor",'\n                            </h5>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                        </div>\n                        <form id="investorForm">\n                            <div class="modal-body">\n                                <div class="mb-3">\n                                    <label class="form-label">Username <span class="text-danger">*</span></label>\n                                    <input type="text" class="form-control" name="username" required placeholder="Enter unique username" autocomplete="off">\n                                    <div class="form-text">Unique username for this investor (e.g., john_smith, investor1)</div>\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Investor Name <span class="text-danger">*</span></label>\n                                    <input type="text" class="form-control" name="name" required placeholder="Enter full name" autocomplete="off">\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Percentage Share <span class="text-danger">*</span></label>\n                                    <div class="input-group">\n                                        <input type="number" class="form-control" name="percentage" required min="0" max="100" step="0.1" placeholder="0.0" autocomplete="off">\n                                        <span class="input-group-text">%</span>\n                                    </div>\n                                    <div class="form-text">Enter percentage share (0-100%)</div>\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Phone Number (Optional)</label>\n                                    <input type="tel" class="form-control" name="phone" placeholder="Enter phone number" autocomplete="off">\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Email (Optional)</label>\n                                    <input type="email" class="form-control" name="email" placeholder="Enter email address" autocomplete="off">\n                                </div>\n                            </div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>\n                                <button type="submit" class="btn btn-primary">\n                                    <i class="bi bi-check-circle me-1"></i>').concat(t?"Update":"Add"," Investor\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                </div>\n            </div>\n        ")}},{key:"fillInvestorForm",value:function(e){var t=this,n=this.investors.find(function(t){return t.investorId===e});if(n){var r=document.getElementById("investorForm"),o=r.querySelector('input[name="username"]'),a=r.querySelector('input[name="name"]'),i=r.querySelector('input[name="phone"]'),s=r.querySelector('input[name="email"]'),c=r.querySelector('input[name="percentage"]');o&&(o.value=n.username||""),a&&(a.value=n.name||""),i&&(i.value=n.phone||""),s&&(s.value=n.email||"");var l=n.properties.find(function(e){return e.propertyId===t.selectedProperty});l&&c&&(c.value=l.percentage)}}},{key:"saveInvestor",value:(u=o(t().m(function e(n,r){var o,a,i,s,c,l=this;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(o=document.getElementById("investorForm"),a=new FormData(o),i={username:a.get("username")||"",name:a.get("name")||"",phone:a.get("phone")||"",email:a.get("email")||"",percentage:parseFloat(a.get("percentage"))||0},e.p=1,!n){e.n=3;break}return e.n=2,this.updateInvestor(n,i);case 2:e.n=4;break;case 3:return e.n=4,this.createInvestor(i);case 4:return this.isModalOpen=!1,r.hide(),setTimeout(function(){l.forceCleanupModalBackdrops()},150),e.n=5,this.loadInvestors(this.selectedProperty);case 5:n?this.showSuccess("Investor updated successfully"):(s=this.lastActionWasAddPropertyToExisting,this.lastActionWasAddPropertyToExisting=!1,s?this.showSuccess("Existing investor added to this property successfully"):this.showSuccess("New investor created and added successfully")),e.n=7;break;case 6:e.p=6,c=e.v,console.error("Error saving investor:",c),this.showError(c.message||"Failed to ".concat(n?"update":"add"," investor"));case 7:return e.a(2)}},e,this,[[1,6]])})),function(e,t){return u.apply(this,arguments)})},{key:"createInvestor",value:(d=o(t().m(function e(n){var r,o,a,i,s,c,l,d,u,p,m=this;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.INVESTORS);case 1:return r=e.v,e.n=2,r.json();case 2:if(!(o=e.v).success||!o.data){e.n=7;break}if(!(a=o.data.find(function(e){return e.username&&n.username?e.username===n.username:e.name.toLowerCase()===n.name.toLowerCase()}))){e.n=7;break}if(!a.properties.some(function(e){return e.propertyId===m.selectedProperty})){e.n=3;break}throw new Error("Investor is already invested in this property");case 3:return e.n=4,API.post(API_CONFIG.ENDPOINTS.INVESTOR_ADD_PROPERTY(a.investorId),{propertyId:this.selectedProperty,percentage:n.percentage});case 4:return i=e.v,e.n=5,i.json();case 5:if((s=e.v).success){e.n=6;break}throw new Error(s.message||"Failed to add property to existing investor");case 6:return this.lastActionWasAddPropertyToExisting=!0,e.a(2);case 7:return e.n=8,this.generateInvestorId();case 8:return c=e.v,l={investorId:c,username:n.username,name:n.name,phone:n.phone,email:n.email,properties:[{propertyId:this.selectedProperty,percentage:n.percentage}]},e.n=9,API.post(API_CONFIG.ENDPOINTS.INVESTORS,l);case 9:return d=e.v,e.n=10,d.json();case 10:if((u=e.v).success){e.n=11;break}throw new Error(u.message||"Failed to create investor");case 11:e.n=13;break;case 12:throw e.p=12,p=e.v,console.error("Error in createInvestor:",p),p;case 13:return e.a(2)}},e,this,[[0,12]])})),function(e){return d.apply(this,arguments)})},{key:"generateInvestorId",value:(l=o(t().m(function e(){var n,r,o,a;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.INVESTORS);case 1:return n=e.v,e.n=2,n.json();case 2:if(!(r=e.v).success||!r.data){e.n=3;break}return o=0,r.data.forEach(function(e){var t=parseInt(e.investorId);!isNaN(t)&&t>o&&(o=t)}),e.a(2,(o+1).toString());case 3:return e.a(2,"1");case 4:e.n=6;break;case 5:return e.p=5,a=e.v,console.error("Error generating investor ID:",a),e.a(2,Date.now().toString());case 6:return e.a(2)}},e,null,[[0,5]])})),function(){return l.apply(this,arguments)})},{key:"updateInvestor",value:(c=o(t().m(function e(n,r){var o,a;return t().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,API.put(API_CONFIG.ENDPOINTS.INVESTOR_BY_ID(n),r);case 1:return o=e.v,e.n=2,o.json();case 2:if((a=e.v).success){e.n=3;break}throw new Error(a.message||"Failed to update investor");case 3:return e.a(2)}},e)})),function(e,t){return c.apply(this,arguments)})},{key:"editInvestor",value:(s=o(t().m(function e(n){return t().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.showInvestorModal(n);case 1:return e.a(2)}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"removeInvestor",value:(i=o(t().m(function e(n){var r,o,a;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(confirm("Are you sure you want to remove this investor from this property?")){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,API.delete(API_CONFIG.ENDPOINTS.INVESTOR_REMOVE_PROPERTY(n,this.selectedProperty));case 2:return r=e.v,e.n=3,r.json();case 3:if(!(o=e.v).success){e.n=5;break}return e.n=4,this.loadInvestors(this.selectedProperty);case 4:"deleted_completely"===o.action?this.showSuccess("Investor removed completely from database (no more property investments)"):this.showSuccess("Investor removed from this property successfully"),e.n=6;break;case 5:throw new Error(o.message||"Failed to remove investor");case 6:e.n=8;break;case 7:e.p=7,a=e.v,console.error("Error removing investor:",a),this.showError(a.message||"Failed to remove investor");case 8:return e.a(2)}},e,this,[[1,7]])})),function(e){return i.apply(this,arguments)})},{key:"editItem",value:function(e,t){var n="expense"===e?"expenses":"income"===e?"income":e;if(this.currentReport&&this.currentReport[n]&&this.currentReport[n][t]){this.setEditButtonLoading(e,t,!0);var r=this.currentReport[n][t];this.showIncomeExpenseModal(e,r,t)}else this.showError("Item not found")}},{key:"toggleDeleteConfirm",value:function(e,t){var n="".concat(e,"-").concat(t);this.pendingDeletes.add(n),"income"===e?this.updateIncomeDisplay():this.updateExpenseDisplay()}},{key:"cancelDeleteItem",value:function(e,t){var n="".concat(e,"-").concat(t);this.pendingDeletes.delete(n),"income"===e?this.updateIncomeDisplay():this.updateExpenseDisplay()}},{key:"confirmDeleteItem",value:(r=o(t().m(function e(n,r){var o,a,i,s,c,l,d;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return o="".concat(n,"-").concat(r),this.pendingDeletes.delete(o),e.p=1,a=this.currentDate.getFullYear(),i=this.currentDate.getMonth()+1,s="income"===n?API_CONFIG.ENDPOINTS.FINANCIAL_REPORT_INCOME(this.selectedProperty,a,i)+"/".concat(r):API_CONFIG.ENDPOINTS.FINANCIAL_REPORT_EXPENSES(this.selectedProperty,a,i)+"/".concat(r),e.n=2,API.delete(s);case 2:return c=e.v,e.n=3,c.json();case 3:if(!(l=e.v).success){e.n=5;break}return e.n=4,this.loadFinancialReport();case 4:this.showSuccess("".concat(n.charAt(0).toUpperCase()+n.slice(1)," item deleted successfully")),e.n=6;break;case 5:throw new Error(l.message||"Failed to delete ".concat(n," item"));case 6:e.n=8;break;case 7:e.p=7,d=e.v,console.error("Error deleting ".concat(n," item:"),d),this.showError(d.message||"Failed to delete ".concat(n," item"));case 8:return e.a(2)}},e,this,[[1,7]])})),function(e,t){return r.apply(this,arguments)})},{key:"showToast",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){showToast(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info")})},{key:"showSuccess",value:function(e){this.showToast(e,"success")}},{key:"showError",value:function(e){this.showToast(e,"error")}},{key:"showInfo",value:function(e){this.showToast(e,"info")}},{key:"setEditButtonLoading",value:function(e,t,n){var r="income"===e?"editIncomeBtn-".concat(t):"editExpenseBtn-".concat(t),o=document.getElementById(r);if(o){var a=o.querySelector(".edit-icon"),i=o.querySelector(".loading-spinner");n?(o.disabled=!0,a&&a.classList.add("d-none"),i&&i.classList.remove("d-none")):(o.disabled=!1,a&&a.classList.remove("d-none"),i&&i.classList.add("d-none"))}}},{key:"refresh",value:function(){this.selectedProperty&&this.loadFinancialReport()}}],n&&a(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r,i,s,c,l,d,u,p,m,v,f,h,y,b}();window.FinancialReportsComponent=s},500:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach(function(t){r(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function r(t,n,r){return(n=function(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function o(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,o,i){var s=r&&r.prototype instanceof l?r:l,d=Object.create(s.prototype);return a(d,"_invoke",function(n,r,o){var a,i,s,l=0,d=o||[],u=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,i=0,s=e,p.n=n,c}};function m(n,r){for(i=n,s=r,t=0;!u&&l&&!o&&t<d.length;t++){var o,a=d[t],m=p.p,v=a[2];n>3?(o=v===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=n<2&&m<a[1])?(i=0,p.v=r,p.n=a[1]):m<v&&(o=n<3||a[0]>r||r>v)&&(a[4]=n,a[5]=r,p.n=v,i=0))}if(o||n>1)return c;throw u=!0,r}return function(o,d,v){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,v),i=d,s=v;(t=i<2?e:s)||!u;){a||(i?i<3?(i>1&&(p.n=-1),m(i,s)):p.n=s:p.v=s);try{if(l=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(u=p.n<0)?s:n.call(r,p))!==c)break}catch(t){a=e,i=1,s=t}finally{l=1}}return{value:t,done:u}}}(n,o,i),!0),d}var c={};function l(){}function d(){}function u(){}t=Object.getPrototypeOf;var p=[][r]?t(t([][r]())):(a(t={},r,function(){return this}),t),m=u.prototype=l.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,a(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return d.prototype=u,a(m,"constructor",u),a(u,"constructor",d),d.displayName="GeneratorFunction",a(u,i,"GeneratorFunction"),a(m),a(m,i,"Generator"),a(m,r,function(){return this}),a(m,"toString",function(){return"[object Generator]"}),(o=function(){return{w:s,m:v}})()}function a(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}a=function(e,t,n,r){function i(t,n){a(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},a(e,t,n,r)}function i(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)})}}var c,l,d,u,p={BASE_URL:"localhost"===window.location.hostname?"":"https://rental-management-backend-mocha.vercel.app",ENDPOINTS:{LOGIN:"/api/auth/login",LOGOUT:"/api/auth/logout",STATUS:"/api/auth/status",ME:"/api/auth/me",PROPERTIES:"/api/properties",PROPERTY_BY_ID:function(e){return"/api/properties/".concat(e)},PROPERTY_TENANTS:function(e){return"/api/properties/".concat(e,"/tenants")},PROPERTY_STATS:"/api/properties/stats/summary",TENANTS:"/api/tenants",TENANT_BY_ID:function(e){return"/api/tenants/".concat(e)},TENANT_BY_FIN:function(e){return"/api/tenants/fin/".concat(e)},TENANT_STATS:"/api/tenants/stats/summary",TENANT_ADD_PROPERTY:function(e){return"/api/tenants/".concat(e,"/properties")},TENANT_REMOVE_PROPERTY:function(e,t){return"/api/tenants/".concat(e,"/properties/").concat(t)},UPLOAD:"/api/upload",UPLOAD_MULTIPLE:"/api/upload/multiple",UPLOAD_TENANT_DOCUMENT:"/api/upload/tenant-document",DASHBOARD_ANALYTICS:"/api/analysis/dashboard",PROPERTY_PERFORMANCE:"/api/analysis/property-performance",TENANT_INSIGHTS:"/api/analysis/tenant-insights",INVESTORS:"/api/investors",INVESTOR_BY_ID:function(e){return"/api/investors/".concat(e)},INVESTORS_BY_PROPERTY:function(e){return"/api/investors/property/".concat(e)},INVESTOR_ADD_PROPERTY:function(e){return"/api/investors/".concat(e,"/properties")},INVESTOR_REMOVE_PROPERTY:function(e,t){return"/api/investors/".concat(e,"/properties/").concat(t)},FINANCIAL_REPORTS_BY_PROPERTY:function(e){return"/api/financial-reports/property/".concat(e)},FINANCIAL_REPORT:function(e,t,n){return"/api/financial-reports/property/".concat(e,"/").concat(t,"/").concat(n)},FINANCIAL_REPORT_INCOME:function(e,t,n){return"/api/financial-reports/property/".concat(e,"/").concat(t,"/").concat(n,"/income")},FINANCIAL_REPORT_EXPENSES:function(e,t,n){return"/api/financial-reports/property/".concat(e,"/").concat(t,"/").concat(n,"/expenses")},HEALTH:"/health"}},m=function(e){return"".concat(p.BASE_URL).concat(e)},v=function(){var e=localStorage.getItem("authToken");if(e){var t=localStorage.getItem("authExpiration");t&&Date.now()>parseInt(t)&&(b(),e=null)}return e||(e=sessionStorage.getItem("authToken")),e},f=function(){var e={"Content-Type":"application/json"},t=v();return t&&(e.Authorization="Bearer ".concat(t)),e},h=function(){var e=s(o().m(function e(t){var n;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(401!==t.status){e.n=5;break}return e.p=1,e.n=2,t.clone().json();case 2:if(!1!==(n=e.v).authenticated&&"Invalid token"!==n.error){e.n=3;break}if(b(),window.location.pathname.includes("login")){e.n=3;break}return window.location.href="/login.html",e.a(2,t);case 3:e.n=5;break;case 4:if(e.p=4,e.v,b(),window.location.pathname.includes("login")){e.n=5;break}return window.location.href="/login.html",e.a(2,t);case 5:return e.a(2,t)}},e,null,[[1,4]])}));return function(t){return e.apply(this,arguments)}}(),y={get:(u=s(o().m(function e(t){var r,a,i=arguments;return o().w(function(e){for(;;)switch(e.n){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},e.n=1,fetch(m(t),n({method:"GET",credentials:"include",headers:n(n({},f()),r.headers||{})},r));case 1:return a=e.v,e.a(2,h(a))}},e)})),function(e){return u.apply(this,arguments)}),post:(d=s(o().m(function e(t){var r,a,i,s=arguments;return o().w(function(e){for(;;)switch(e.n){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:null,a=s.length>2&&void 0!==s[2]?s[2]:{},e.n=1,fetch(m(t),n({method:"POST",credentials:"include",headers:n(n({},f()),a.headers||{}),body:r?JSON.stringify(r):null},a));case 1:return i=e.v,e.a(2,h(i))}},e)})),function(e){return d.apply(this,arguments)}),put:(l=s(o().m(function e(t){var r,a,i,s=arguments;return o().w(function(e){for(;;)switch(e.n){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:null,a=s.length>2&&void 0!==s[2]?s[2]:{},e.n=1,fetch(m(t),n({method:"PUT",credentials:"include",headers:n(n({},f()),a.headers||{}),body:r?JSON.stringify(r):null},a));case 1:return i=e.v,e.a(2,h(i))}},e)})),function(e){return l.apply(this,arguments)}),delete:(c=s(o().m(function e(t){var r,a,i=arguments;return o().w(function(e){for(;;)switch(e.n){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},e.n=1,fetch(m(t),n({method:"DELETE",credentials:"include",headers:n(n({},f()),r.headers||{})},r));case 1:return a=e.v,e.a(2,h(a))}},e)})),function(e){return c.apply(this,arguments)})},b=function(){localStorage.removeItem("authToken"),localStorage.removeItem("user"),localStorage.removeItem("rememberMe"),localStorage.removeItem("loginTime"),localStorage.removeItem("authExpiration"),sessionStorage.removeItem("authToken"),sessionStorage.removeItem("user"),sessionStorage.removeItem("rememberMe")};window.API_CONFIG=p,window.buildApiUrl=m,window.API=y,window.getAuthToken=v,window.getAuthHeaders=f,window.clearAuth=b},586:()=>{function e(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}window.showToast=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",r=document.getElementById("toast-container");r||((r=document.createElement("div")).id="toast-container",r.className="position-fixed top-0 end-0 p-3",r.style.zIndex="9999",document.body.appendChild(r));var o="toast-".concat(Date.now()),a='\n            <div id="'.concat(o,'" class="toast align-items-center text-white ').concat({success:"bg-success",error:"bg-danger",info:"bg-info"}[n],' border-0" role="alert" aria-live="assertive" aria-atomic="true">\n                <div class="d-flex">\n                    <div class="toast-body d-flex align-items-center">\n                        <i class="bi bi-').concat({success:"check-circle-fill",error:"exclamation-triangle-fill",info:"info-circle-fill"}[n],' me-2"></i>\n                        ').concat(e(t),'\n                    </div>\n                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n                </div>\n            </div>\n        ');r.insertAdjacentHTML("beforeend",a);var i=document.getElementById(o),s=new bootstrap.Toast(i,{delay:3e3});i.addEventListener("hidden.bs.toast",function(){i.remove()}),s.show()},window.escapeHtml=e},893:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function s(t,o,a,i){var s=o&&o.prototype instanceof l?o:l,d=Object.create(s.prototype);return n(d,"_invoke",function(t,n,o){var a,i,s,l=0,d=o||[],u=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,i=0,s=e,p.n=n,c}};function m(t,n){for(i=t,s=n,r=0;!u&&l&&!o&&r<d.length;r++){var o,a=d[r],m=p.p,v=a[2];t>3?(o=v===n)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=t<2&&m<a[1])?(i=0,p.v=n,p.n=a[1]):m<v&&(o=t<3||a[0]>n||n>v)&&(a[4]=t,a[5]=n,p.n=v,i=0))}if(o||t>1)return c;throw u=!0,n}return function(o,d,v){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,v),i=d,s=v;(r=i<2?e:s)||!u;){a||(i?i<3?(i>1&&(p.n=-1),m(i,s)):p.n=s:p.v=s);try{if(l=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(u=p.n<0)?s:t.call(n,p))!==c)break}catch(t){a=e,i=1,s=t}finally{l=1}}return{value:r,done:u}}}(t,a,i),!0),d}var c={};function l(){}function d(){}function u(){}r=Object.getPrototypeOf;var p=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),m=u.prototype=l.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,n(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return d.prototype=u,n(m,"constructor",u),n(u,"constructor",d),d.displayName="GeneratorFunction",n(u,i,"GeneratorFunction"),n(m),n(m,i,"Generator"),n(m,a,function(){return this}),n(m,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m:v}})()}function n(e,t,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}n=function(e,t,r,o){function i(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},n(e,t,r,o)}function r(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var i=e.apply(t,n);function s(e){r(i,o,a,s,c,"next",e)}function c(e){r(i,o,a,s,c,"throw",e)}s(void 0)})}}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var s=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.components={},this.currentSection="dashboard",this.init()},n=[{key:"init",value:function(){this.updateCurrentDate(),this.setupNavigation(),this.setupFeatureCards(),this.loadUserInfo(),this.loadDashboardStats(),this.initializeComponentsLazily(),this.preloadTenantData()}},{key:"updateCurrentDate",value:function(){var e=new Date,t=document.getElementById("currentDate");t&&(t.textContent=e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}))}},{key:"setupNavigation",value:function(){var e=this;document.querySelectorAll(".nav-link").forEach(function(t){t.addEventListener("click",function(n){n.preventDefault();var r=t.getAttribute("data-section");r&&(e.showSection(r),document.querySelectorAll(".nav-link").forEach(function(e){return e.classList.remove("active")}),t.classList.add("active"))})})}},{key:"setupFeatureCards",value:function(){var e=this;document.addEventListener("click",function(t){var n=t.target.closest("[data-section]");if(n&&n.classList.contains("feature-card")){var r=n.getAttribute("data-section");e.showSection(r)}})}},{key:"showSection",value:function(e){document.querySelectorAll(".content-section").forEach(function(e){e.style.display="none"});var t=e+"-section",n=document.getElementById(t);n&&(n.style.display="block",this.currentSection=e,this.initializeComponentForSection(e)),document.querySelectorAll(".nav-link").forEach(function(e){return e.classList.remove("active")});var r=document.querySelector('.nav-link[data-section="'.concat(e,'"]'));r&&r.classList.add("active")}},{key:"initializeComponentsLazily",value:function(){}},{key:"initializeComponentForSection",value:function(e){var t=this;switch(e){case"analysis":this.components.contractAnalysis||(this.components.contractAnalysis=new ContractAnalysisComponent);break;case"properties":this.components.propertyManagement||(this.components.propertyManagement=new PropertyManagementComponent,window.propertyManager=this.components.propertyManagement);break;case"tenants":this.components.tenantManagement?console.log("♻️ Using preloaded TenantManagementComponent - data already available"):(console.log("🏗️ Creating TenantManagementComponent..."),this.components.tenantManagement=new TenantManagementComponent,window.tenantManager=this.components.tenantManagement,console.log("✅ TenantManagementComponent created"),setTimeout(function(){console.log("⏰ Loading tenants after section display..."),t.components.tenantManagement.loadTenants()},100));break;case"financial":this.components.financialReports||(this.components.financialReports=new FinancialReportsComponent,window.financialReports=this.components.financialReports);break;case"investors":this.components.investorManagement||(this.components.investorManagement=new InvestorManagementComponent,window.investorManager=this.components.investorManagement)}}},{key:"loadUserInfo",value:(i=o(t().m(function e(){var n;return t().w(function(e){for(;;)switch(e.n){case 0:(n=document.getElementById("userInfo"))&&(n.textContent="Admin User");case 1:return e.a(2)}},e)})),function(){return i.apply(this,arguments)})},{key:"loadDashboardStats",value:(r=o(t().m(function e(){var n,r,o,a,i,s,c,l,d,u,p,m,v,f,h,y;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.PROPERTY_STATS);case 1:return n=e.v,e.n=2,n.json();case 2:return(r=e.v).success&&(o=document.getElementById("propertiesCount"))&&(o.textContent=r.stats.totalProperties||0),e.n=3,API.get(API_CONFIG.ENDPOINTS.TENANT_STATS);case 3:return a=e.v,e.n=4,a.json();case 4:(i=e.v).success&&(s=i.stats,c=s.totalTenants||0,l=s.registeredTenants||0,d=s.tenantsWithProperties||0,u=document.getElementById("tenantsCount"),p=document.getElementById("registeredTenants"),m=document.getElementById("occupiedProperties"),u&&(u.textContent=c),p&&(p.textContent=l),m&&(m.textContent=d)),(v=document.getElementById("contractsCount"))&&(v.textContent="0"),(f=document.getElementById("issuesCount"))&&(f.textContent="0"),(h=document.getElementById("cleanCount"))&&(h.textContent="0"),e.n=6;break;case 5:e.p=5,y=e.v,console.error("Error loading dashboard stats:",y);case 6:return e.a(2)}},e,null,[[0,5]])})),function(){return r.apply(this,arguments)})},{key:"getComponent",value:function(e){return this.components[e]}},{key:"refreshCurrentSection",value:function(){this.initializeComponentForSection(this.currentSection);var e=this.getComponent(this.currentSection);e&&e.refresh&&e.refresh()}},{key:"refreshDashboardStats",value:function(){this.loadDashboardStats()}},{key:"goToSection",value:function(e){this.showSection(e)}},{key:"goToDashboard",value:function(){this.showSection("dashboard")}},{key:"goToAnalysis",value:function(){this.showSection("analysis")}},{key:"goToProperties",value:function(){this.showSection("properties")}},{key:"goToTenants",value:function(){this.showSection("tenants")}},{key:"goToInvestors",value:function(){this.showSection("investors")}},{key:"preloadTenantData",value:function(){console.log("🚀 Preloading tenant data on dashboard entry..."),this.components.tenantManagement||(this.components.tenantManagement=new TenantManagementComponent,window.tenantManager=this.components.tenantManagement,console.log("✅ Tenant management component preloaded"),this.components.tenantManagement.loadTenants())}}],n&&a(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r,i}();document.addEventListener("DOMContentLoaded",function(){window.dashboardController=new s}),window.DashboardController=s},962:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function s(t,o,a,i){var s=o&&o.prototype instanceof l?o:l,d=Object.create(s.prototype);return n(d,"_invoke",function(t,n,o){var a,i,s,l=0,d=o||[],u=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,i=0,s=e,p.n=n,c}};function m(t,n){for(i=t,s=n,r=0;!u&&l&&!o&&r<d.length;r++){var o,a=d[r],m=p.p,v=a[2];t>3?(o=v===n)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=t<2&&m<a[1])?(i=0,p.v=n,p.n=a[1]):m<v&&(o=t<3||a[0]>n||n>v)&&(a[4]=t,a[5]=n,p.n=v,i=0))}if(o||t>1)return c;throw u=!0,n}return function(o,d,v){if(l>1)throw TypeError("Generator is already running");for(u&&1===d&&m(d,v),i=d,s=v;(r=i<2?e:s)||!u;){a||(i?i<3?(i>1&&(p.n=-1),m(i,s)):p.n=s:p.v=s);try{if(l=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(u=p.n<0)?s:t.call(n,p))!==c)break}catch(t){a=e,i=1,s=t}finally{l=1}}return{value:r,done:u}}}(t,a,i),!0),d}var c={};function l(){}function d(){}function u(){}r=Object.getPrototypeOf;var p=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),m=u.prototype=l.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,n(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return d.prototype=u,n(m,"constructor",u),n(u,"constructor",d),d.displayName="GeneratorFunction",n(u,i,"GeneratorFunction"),n(m),n(m,i,"Generator"),n(m,a,function(){return this}),n(m,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m:v}})()}function n(e,t,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}n=function(e,t,r,o){function i(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},n(e,t,r,o)}function r(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var i=e.apply(t,n);function s(e){r(i,o,a,s,c,"next",e)}function c(e){r(i,o,a,s,c,"throw",e)}s(void 0)})}}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var s=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentPage=1,this.pdfDoc=null,this.scale=1,this.analysisData=null,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.init()},n=[{key:"init",value:function(){this.setupFileUpload(),this.setupPDFControls(),this.setupEventListeners()}},{key:"setupFileUpload",value:function(){var e=this,t=document.getElementById("uploadArea"),n=document.getElementById("fileInput");t&&n&&(t.addEventListener("click",function(){n.click()}),t.addEventListener("dragover",function(e){e.preventDefault(),t.classList.add("dragover")}),t.addEventListener("dragleave",function(){t.classList.remove("dragover")}),t.addEventListener("drop",function(n){n.preventDefault(),t.classList.remove("dragover");var r=n.dataTransfer.files;r.length>0&&e.handleFileUpload(r[0])}),n.addEventListener("change",function(t){t.target.files.length>0&&e.handleFileUpload(t.target.files[0])}))}},{key:"handleFileUpload",value:(s=o(t().m(function e(n){var r,o,a,i,s,c,l,d,u;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if("application/pdf"===n.type){e.n=1;break}return alert("Please upload a PDF file only."),e.a(2);case 1:if(!(n.size>10485760)){e.n=2;break}return alert("File size must be less than 10MB."),e.a(2);case 2:return(r=new FormData).append("agreement",n),(o=document.getElementById("uploadProgress")).querySelector(".progress-bar"),a=document.getElementById("analysisProgress"),o.style.display="block",a.style.display="block",e.p=3,e.n=4,fetch(buildApiUrl("/upload/agreement"),{method:"POST",credentials:"include",body:r});case 4:if((i=e.v).ok){e.n=5;break}throw new Error("Upload failed");case 5:return e.n=6,i.json();case 6:return s=e.v,console.log("File uploaded:",s.filename),e.n=7,API.post("/analysis/analyze",{filename:s.filename});case 7:if((c=e.v).ok){e.n=8;break}throw new Error("Analysis failed");case 8:return e.n=9,c.json();case 9:return l=e.v,console.log("Analysis completed:",l),this.analysisData=l,this.displayAnalysisResults(l),e.n=10,this.loadPDF(s.filename);case 10:(d=document.getElementById("downloadReportBtn"))&&(d.style.display="inline-block"),e.n=12;break;case 11:e.p=11,u=e.v,console.error("Error:",u),alert("Error processing file: "+u.message);case 12:return e.p=12,o.style.display="none",a.style.display="none",e.f(12);case 13:return e.a(2)}},e,this,[[3,11,12,13]])})),function(e){return s.apply(this,arguments)})},{key:"displayAnalysisResults",value:function(e){var t=document.getElementById("resultsContainer");if(t)if(e.success){var n=e.analysis.keywordAnalysis||[],r='<div class="analysis-results">';r+='<div class="row mb-3">',r+='<div class="col-4 text-center"><div class="border rounded p-2"><strong>'+n.length+'</strong><br><small class="text-muted">Total Issues</small></div></div>',r+='<div class="col-4 text-center"><div class="border rounded p-2"><strong>'+n.filter(function(e){return"HIGH"===e.severity}).length+'</strong><br><small class="text-danger">High Risk</small></div></div>',r+='<div class="col-4 text-center"><div class="border rounded p-2"><strong>'+n.filter(function(e){return"MEDIUM"===e.severity}).length+'</strong><br><small class="text-warning">Medium Risk</small></div></div>',r+="</div>",0===n.length?r+='<div class="alert alert-success"><i class="bi bi-check-circle me-2"></i>No issues found in this contract!</div>':[{title:"High Risk Issues",issues:n.filter(function(e){return"HIGH"===e.severity}),class:"danger",icon:"exclamation-triangle"},{title:"Medium Risk Issues",issues:n.filter(function(e){return"MEDIUM"===e.severity}),class:"warning",icon:"exclamation-circle"},{title:"Low Risk Issues",issues:n.filter(function(e){return"LOW"===e.severity}),class:"info",icon:"info-circle"}].forEach(function(e){e.issues.length>0&&(r+='<div class="alert alert-'+e.class+' mb-3">',r+='<h6><i class="bi bi-'+e.icon+' me-2"></i>'+e.title+" ("+e.issues.length+")</h6>",r+='<ul class="mb-0">',e.issues.forEach(function(e){r+="<li><strong>"+e.name+"</strong><br><small>"+e.description+"</small></li>"}),r+="</ul>",r+="</div>")}),r+="</div>",t.innerHTML=r}else t.innerHTML='<div class="alert alert-danger">Analysis failed: '+e.error+"</div>"}},{key:"setupPDFControls",value:function(){var e=this;document.addEventListener("click",function(t){t.target.closest("#nextPageBtn")&&e.nextPage(),t.target.closest("#prevPageBtn")&&e.previousPage()})}},{key:"loadPDF",value:(i=o(t().m(function e(n){var r,o,a,i,s;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("Loading PDF:",n),r="/pdf/".concat(n),console.log("PDF URL:",r),e.n=1,fetch(r,{credentials:"include"});case 1:if(o=e.v,console.log("PDF response status:",o.status),o.ok){e.n=2;break}throw new Error("Failed to load PDF: ".concat(o.status));case 2:return e.n=3,pdfjsLib.getDocument(r).promise;case 3:return this.pdfDoc=e.v,(a=document.getElementById("totalPages"))&&(a.textContent=this.pdfDoc.numPages),e.n=4,this.renderAllPages();case 4:console.log("PDF loaded successfully"),e.n=6;break;case 5:e.p=5,s=e.v,console.error("Error loading PDF:",s),(i=document.getElementById("pdfContainer"))&&(i.innerHTML='\n                    <div class="alert alert-warning">\n                        <i class="bi bi-exclamation-triangle me-2"></i>\n                        Unable to load PDF: '.concat(s.message,"\n                    </div>\n                "));case 6:return e.a(2)}},e,this,[[0,5]])})),function(e){return i.apply(this,arguments)})},{key:"renderAllPages",value:(r=o(t().m(function e(){var n,r,o,a,i,s,c,l,d,u,p,m;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,this.pdfDoc){e.n=1;break}throw new Error("PDF document not loaded");case 1:if(n=document.getElementById("pdfContainer")){e.n=2;break}return e.a(2);case 2:n.innerHTML="",console.log("Rendering all ".concat(this.pdfDoc.numPages," pages")),r=1;case 3:if(!(r<=this.pdfDoc.numPages)){e.n=7;break}return console.log("Rendering page ".concat(r," of ").concat(this.pdfDoc.numPages)),e.n=4,this.pdfDoc.getPage(r);case 4:return o=e.v,a=o.getViewport({scale:this.scale}),i=document.createElement("canvas"),s=i.getContext("2d"),i.className="pdf-canvas",i.height=a.height,i.width=a.width,i.style.marginBottom="20px",i.style.border="1px solid #ddd",(c=document.createElement("div")).style.position="relative",c.style.marginBottom="20px",(l=document.createElement("div")).className="highlight-layer",l.style.position="absolute",l.style.top="0",l.style.left="0",l.style.width=a.width+"px",l.style.height=a.height+"px",l.style.pointerEvents="none",d={canvasContext:s,viewport:a},e.n=5,o.render(d).promise;case 5:c.appendChild(i),c.appendChild(l),n.appendChild(c),console.log("Page ".concat(r," rendered successfully"));case 6:r++,e.n=3;break;case 7:(u=document.getElementById("zoomLevel"))&&(u.textContent=Math.round(100*this.scale)+"%"),console.log("All pages rendered successfully"),e.n=9;break;case 8:e.p=8,m=e.v,console.error("Error rendering pages:",m),(p=document.getElementById("pdfContainer"))&&(p.innerHTML='\n                    <div class="alert alert-danger">\n                        <i class="bi bi-exclamation-triangle me-2"></i>\n                        Error rendering pages: '.concat(m.message,"\n                    </div>\n                "));case 9:return e.a(2)}},e,this,[[0,8]])})),function(){return r.apply(this,arguments)})},{key:"previousPage",value:function(){this.pdfDoc?this.currentPage<=1?console.log("Already on first page"):(this.currentPage--,this.renderPage(this.currentPage)):console.error("PDF not loaded")}},{key:"nextPage",value:function(){return this.pdfDoc?this.currentPage>=this.pdfDoc.numPages?(console.log("Already on last page"),void alert("Already on the last page")):(this.currentPage++,void this.renderPage(this.currentPage)):(console.error("PDF not loaded"),void alert("PDF not loaded yet. Please wait for the PDF to load completely."))}},{key:"zoomIn",value:function(){this.scale+=.2,this.renderAllPages()}},{key:"zoomOut",value:function(){this.scale<=.4||(this.scale-=.2,this.renderAllPages())}},{key:"setupEventListeners",value:function(){var e=this,n=document.getElementById("downloadReportBtn");n&&n.addEventListener("click",o(t().m(function n(){var r,o,a,i,s;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e.analysisData){t.n=1;break}return alert("No analysis data available"),t.a(2);case 1:return t.p=1,t.n=2,API.post("/analysis/report",e.analysisData);case 2:if(!(r=t.v).ok){t.n=4;break}return t.n=3,r.blob();case 3:o=t.v,a=window.URL.createObjectURL(o),(i=document.createElement("a")).style.display="none",i.href=a,i.download="contract-analysis-report.pdf",document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(a),document.body.removeChild(i),t.n=5;break;case 4:throw new Error("Failed to generate report");case 5:t.n=7;break;case 6:t.p=6,s=t.v,console.error("Error downloading report:",s),alert("Error generating report: "+s.message);case 7:return t.a(2)}},n,null,[[1,6]])})))}}],n&&a(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r,i,s}();window.ContractAnalysisComponent=s}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";n(500),n(586),n(962),n(38),n(41),n(280),n(169),n(893),window.addEventListener("unhandledrejection",function(e){e.reason&&e.reason.message&&(e.reason.message.includes("MetaMask")||e.reason.message.includes("ethereum")||e.reason.message.includes("Failed to connect to MetaMask"))&&(console.warn("Suppressed MetaMask error (unrelated to rental management):",e.reason.message),e.preventDefault())}),window.addEventListener("error",function(e){var t,n;if(e.message&&(e.message.includes("MetaMask")||e.message.includes("ethereum")||e.message.includes("Failed to connect to MetaMask")||null!==(t=e.filename)&&void 0!==t&&t.includes("chrome-extension")||null!==(n=e.filename)&&void 0!==n&&n.includes("inpage.js")))return console.warn("Suppressed extension error (unrelated to rental management):",e.message),e.preventDefault(),!0})})()})();