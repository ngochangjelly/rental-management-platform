/*! For license information please see dashboard.fb78f1cecb6cb1164aa4.js.LICENSE.txt */
(()=>{var e={38:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function s(t,o,a,i){var s=o&&o.prototype instanceof l?o:l,u=Object.create(s.prototype);return n(u,"_invoke",function(t,n,o){var a,i,s,l=0,u=o||[],d=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,i=0,s=e,p.n=n,c}};function m(t,n){for(i=t,s=n,r=0;!d&&l&&!o&&r<u.length;r++){var o,a=u[r],m=p.p,f=a[2];t>3?(o=f===n)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=t<2&&m<a[1])?(i=0,p.v=n,p.n=a[1]):m<f&&(o=t<3||a[0]>n||n>f)&&(a[4]=t,a[5]=n,p.n=f,i=0))}if(o||t>1)return c;throw d=!0,n}return function(o,u,f){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,f),i=u,s=f;(r=i<2?e:s)||!d;){a||(i?i<3?(i>1&&(p.n=-1),m(i,s)):p.n=s:p.v=s);try{if(l=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(d=p.n<0)?s:t.call(n,p))!==c)break}catch(t){a=e,i=1,s=t}finally{l=1}}return{value:r,done:d}}}(t,a,i),!0),u}var c={};function l(){}function u(){}function d(){}r=Object.getPrototypeOf;var p=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),m=d.prototype=l.prototype=Object.create(p);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,n(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=d,n(m,"constructor",d),n(d,"constructor",u),u.displayName="GeneratorFunction",n(d,i,"GeneratorFunction"),n(m),n(m,i,"Generator"),n(m,a,function(){return this}),n(m,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m:f}})()}function n(e,t,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}n=function(e,t,r,o){function i(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},n(e,t,r,o)}function r(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var i=e.apply(t,n);function s(e){r(i,o,a,s,c,"next",e)}function c(e){r(i,o,a,s,c,"throw",e)}s(void 0)})}}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var s=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.properties=[],this.init()},n=[{key:"init",value:function(){this.setupEventListeners(),this.loadProperties()}},{key:"setupEventListeners",value:function(){var e=this,t=document.getElementById("addPropertyBtn");t&&t.addEventListener("click",function(){e.showAddPropertyModal()});var n=document.getElementById("propertyForm");n&&n.addEventListener("submit",function(t){t.preventDefault(),e.handlePropertySubmit(t)});var r=document.getElementById("moveInDate");r&&!r.value&&(r.value=(new Date).toISOString().split("T")[0]);var o=document.getElementById("propertySearchInput");o&&o.addEventListener("input",function(t){e.filterProperties(t.target.value)})}},{key:"loadProperties",value:(u=o(t().m(function e(){var n,r,o;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.PROPERTIES);case 1:return n=e.v,e.n=2,n.json();case 2:(r=e.v).success?(this.properties=r.properties,this.renderPropertiesTable(),window.updateSidebarBadges&&window.updateSidebarBadges()):(console.error("Failed to load properties:",r.error),this.showEmptyState()),e.n=4;break;case 3:e.p=3,o=e.v,console.error("Error loading properties:",o),this.showEmptyState("Error loading properties. Please try again.");case 4:return e.a(2)}},e,this,[[0,3]])})),function(){return u.apply(this,arguments)})},{key:"renderPropertiesTable",value:function(){var e=this,t=document.getElementById("propertiesTableBody"),n=document.getElementById("mobilePropertyList");if(t){if(0===this.properties.length)return this.showEmptyState(),void this.showMobileEmptyState();var r="";if(this.properties.forEach(function(t){r+="\n                <tr>\n                    <td>".concat(e.escapeHtml(t.propertyId),"</td>\n                    <td>").concat(e.escapeHtml(t.address),"</td>\n                    <td>").concat(e.escapeHtml(t.unit),"</td>\n                    <td>").concat(t.maxPax,"</td>\n                    <td>$").concat((t.rent||0).toLocaleString(),'</td>\n                    <td>\n                        <button class="btn btn-sm btn-outline-primary me-1" onclick="propertyManager.editProperty(\'').concat(t.propertyId,'\')">\n                            <i class="bi bi-pencil"></i> Edit\n                        </button>\n                        <button class="btn btn-sm btn-outline-danger" onclick="propertyManager.deleteProperty(\'').concat(t.propertyId,'\')">\n                            <i class="bi bi-trash"></i> Delete\n                        </button>\n                    </td>\n                </tr>\n            ')}),t.innerHTML=r,n){var o="";this.properties.forEach(function(t){o+='\n                  <div class="mobile-property-card">\n                      <div class="mobile-property-header">\n                          <div class="mobile-property-info">\n                              <div class="mobile-property-id">'.concat(e.escapeHtml(t.propertyId),'</div>\n                              <div class="mobile-property-address">').concat(e.escapeHtml(t.address),'</div>\n                          </div>\n                      </div>\n                      <div class="mobile-property-details">\n                          <div><strong>Unit:</strong> ').concat(e.escapeHtml(t.unit),"</div>\n                          <div><strong>Rent:</strong> $").concat((t.rent||0).toLocaleString(),'</div>\n                      </div>\n                      <div class="mobile-property-actions">\n                          <button class="btn btn-outline-primary btn-sm" onclick="propertyManager.editProperty(\'').concat(t.propertyId,'\')">\n                              <i class="bi bi-pencil"></i> Edit\n                          </button>\n                          <button class="btn btn-outline-danger btn-sm" onclick="propertyManager.deleteProperty(\'').concat(t.propertyId,'\')">\n                              <i class="bi bi-trash"></i> Delete\n                          </button>\n                      </div>\n                  </div>\n              ')}),n.innerHTML=o}}}},{key:"showEmptyState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"No properties found",t=document.getElementById("propertiesTableBody");t&&(t.innerHTML='\n            <tr>\n                <td colspan="6" class="text-center text-muted py-4">\n                    <i class="bi bi-building fs-1"></i>\n                    <p class="mt-2">'.concat(e,"</p>\n                </td>\n            </tr>\n        "))}},{key:"showMobileEmptyState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"No properties found",t=document.getElementById("mobilePropertyList");t&&(t.innerHTML='\n            <div class="text-center text-muted py-4">\n                <i class="bi bi-building fs-1"></i>\n                <p class="mt-2">'.concat(e,"</p>\n            </div>\n        "))}},{key:"filterProperties",value:function(e){var t=this;if(e.trim()){var n=this.properties.filter(function(t){return t.propertyId.toLowerCase().includes(e.toLowerCase())||t.address.toLowerCase().includes(e.toLowerCase())||t.unit.toLowerCase().includes(e.toLowerCase())}),r=document.getElementById("propertiesTableBody"),o=document.getElementById("mobilePropertyList");if(r){if(0===n.length)return this.showEmptyState('No properties match "'.concat(e,'"')),void this.showMobileEmptyState('No properties match "'.concat(e,'"'));var a="";if(n.forEach(function(e){a+="\n                <tr>\n                    <td>".concat(t.escapeHtml(e.propertyId),"</td>\n                    <td>").concat(t.escapeHtml(e.address),"</td>\n                    <td>").concat(t.escapeHtml(e.unit),"</td>\n                    <td>").concat(e.maxPax,"</td>\n                    <td>$").concat((e.rent||0).toLocaleString(),'</td>\n                    <td>\n                        <button class="btn btn-sm btn-outline-primary me-1" onclick="propertyManager.editProperty(\'').concat(e.propertyId,'\')">\n                            <i class="bi bi-pencil"></i> Edit\n                        </button>\n                        <button class="btn btn-sm btn-outline-danger" onclick="propertyManager.deleteProperty(\'').concat(e.propertyId,'\')">\n                            <i class="bi bi-trash"></i> Delete\n                        </button>\n                    </td>\n                </tr>\n            ')}),r.innerHTML=a,o){var i="";n.forEach(function(e){i+='\n                  <div class="mobile-property-card">\n                      <div class="mobile-property-header">\n                          <div class="mobile-property-info">\n                              <div class="mobile-property-id">'.concat(t.escapeHtml(e.propertyId),'</div>\n                              <div class="mobile-property-address">').concat(t.escapeHtml(e.address),'</div>\n                          </div>\n                      </div>\n                      <div class="mobile-property-details">\n                          <div><strong>Unit:</strong> ').concat(t.escapeHtml(e.unit),"</div>\n                          <div><strong>Rent:</strong> $").concat((e.rent||0).toLocaleString(),'</div>\n                      </div>\n                      <div class="mobile-property-actions">\n                          <button class="btn btn-outline-primary btn-sm" onclick="propertyManager.editProperty(\'').concat(e.propertyId,'\')">\n                              <i class="bi bi-pencil"></i> Edit\n                          </button>\n                          <button class="btn btn-outline-danger btn-sm" onclick="propertyManager.deleteProperty(\'').concat(e.propertyId,'\')">\n                              <i class="bi bi-trash"></i> Delete\n                          </button>\n                      </div>\n                  </div>\n              ')}),o.innerHTML=i}}}else this.renderPropertiesTable()}},{key:"showAddPropertyModal",value:function(){this.showPropertyModal()}},{key:"showPropertyModal",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=!!t;document.getElementById("propertyModalTitle").textContent=n?"Edit Property":"Add New Property",document.getElementById("propertySubmitBtn").innerHTML=n?'<i class="bi bi-pencil-square me-1"></i><span id="propertySubmitText">Update Property</span>':'<i class="bi bi-plus-circle me-1"></i><span id="propertySubmitText">Add Property</span>';var r=document.getElementById("propertyForm");if(r)if(r.reset(),r.setAttribute("data-property-id",(null==t?void 0:t.propertyId)||""),r.setAttribute("data-mode",n?"edit":"add"),n&&t){if(document.getElementById("propertyId").value=t.propertyId||"",document.getElementById("address").value=t.address||"",document.getElementById("unit").value=t.unit||"",document.getElementById("maxPax").value=t.maxPax||1,t.moveInDate){var o=new Date(t.moveInDate);document.getElementById("moveInDate").value=o.toISOString().split("T")[0]}else document.getElementById("moveInDate").value=(new Date).toISOString().split("T")[0];document.getElementById("rentPaymentDate").value=t.rentPaymentDate||1,document.getElementById("rent").value=t.rent||0,document.getElementById("agentName").value=t.agentName||"",document.getElementById("agentPhone").value=t.agentPhone||"",document.getElementById("landlordBankAccount").value=t.landlordBankAccount||"",document.getElementById("landlordBankName").value=t.landlordBankName||"",document.getElementById("landlordAccountName").value=t.landlordAccountName||"",document.getElementById("telegramBotToken").value=t.telegramBotToken||"",document.getElementById("telegramChannelId").value=t.telegramChannelId||"",document.getElementById("propertyId").readOnly=!0,document.getElementById("propertyId").classList.add("bg-light")}else{var a=document.getElementById("moveInDate");a&&(a.value=(new Date).toISOString().split("T")[0]),document.getElementById("maxPax").value="1",document.getElementById("rentPaymentDate").value="1",document.getElementById("rent").value="0",document.getElementById("propertyId").readOnly=!1,document.getElementById("propertyId").classList.remove("bg-light")}var i=document.getElementById("propertyModal"),s=new bootstrap.Modal(i);i.addEventListener("hidden.bs.modal",function(){e.cleanupModal()},{once:!0}),s.show()}},{key:"cleanupModal",value:function(){document.querySelectorAll(".modal-backdrop").forEach(function(e){return e.remove()}),document.body.classList.remove("modal-open"),document.body.style.paddingRight="",document.body.style.overflow=""}},{key:"getPropertyDataFromUser",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=prompt("Property ID:",(null==e?void 0:e.propertyId)||"");if(!t)return null;var n=prompt("Address:",(null==e?void 0:e.address)||"");if(!n)return null;var r=prompt("Unit:",(null==e?void 0:e.unit)||"");if(!r)return null;var o=parseInt(prompt("Max Occupants:",(null==e?void 0:e.maxPax)||"1"));if(isNaN(o)||o<1)return null;var a=parseFloat(prompt("Monthly Rent:",(null==e?void 0:e.rent)||"0"));return isNaN(a)||a<0?null:{propertyId:t,address:n,unit:r,maxPax:o,rent:a,agentName:(null==e?void 0:e.agentName)||"",agentPhone:(null==e?void 0:e.agentPhone)||"",landlordBankAccount:(null==e?void 0:e.landlordBankAccount)||"",landlordBankName:(null==e?void 0:e.landlordBankName)||"",landlordAccountName:(null==e?void 0:e.landlordAccountName)||""}}},{key:"handlePropertySubmit",value:(l=o(t().m(function e(n){var r,o,a,i,s,c,l,u,d,p,m,f,v,y,h,b,g,I,E;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,u=n.target,d=new FormData(u),p="edit"===u.getAttribute("data-mode"),m=u.getAttribute("data-property-id"),(f={propertyId:d.get("propertyId").trim().toUpperCase(),address:d.get("address").trim(),unit:d.get("unit").trim(),maxPax:parseInt(d.get("maxPax"))||1,moveInDate:d.get("moveInDate")||(new Date).toISOString().split("T")[0],rentPaymentDate:parseInt(d.get("rentPaymentDate"))||1,rent:parseFloat(d.get("rent"))||0,agentName:(null===(r=d.get("agentName"))||void 0===r?void 0:r.trim())||"",agentPhone:(null===(o=d.get("agentPhone"))||void 0===o?void 0:o.trim())||"",landlordBankAccount:(null===(a=d.get("landlordBankAccount"))||void 0===a?void 0:a.trim())||"",landlordBankName:(null===(i=d.get("landlordBankName"))||void 0===i?void 0:i.trim())||"",landlordAccountName:(null===(s=d.get("landlordAccountName"))||void 0===s?void 0:s.trim())||"",telegramBotToken:(null===(c=d.get("telegramBotToken"))||void 0===c?void 0:c.trim())||"",telegramChannelId:(null===(l=d.get("telegramChannelId"))||void 0===l?void 0:l.trim())||""}).propertyId&&f.address&&f.unit){e.n=1;break}return alert("Please fill in all required fields (Property ID, Address, Unit)"),e.a(2);case 1:if(!(f.maxPax<1||f.maxPax>20)){e.n=2;break}return alert("Maximum occupancy must be between 1 and 20"),e.a(2);case 2:if(!(f.rentPaymentDate<1||f.rentPaymentDate>31)){e.n=3;break}return alert("Rent payment date must be between 1 and 31"),e.a(2);case 3:if(!(f.rent<0)){e.n=4;break}return alert("Rent cannot be negative"),e.a(2);case 4:if(v=n.target.querySelector('button[type="submit"]'),y=v.innerHTML,v.disabled=!0,v.innerHTML=p?'<i class="bi bi-hourglass-split me-1"></i>Updating Property...':'<i class="bi bi-hourglass-split me-1"></i>Adding Property...',!p){e.n=6;break}return e.n=5,this.updateProperty(m,f);case 5:e.n=7;break;case 6:return e.n=7,this.addProperty(f);case 7:(h=bootstrap.Modal.getInstance(document.getElementById("propertyModal")))&&h.hide(),setTimeout(function(){var e=document.querySelector(".modal-backdrop");e&&e.remove(),document.body.classList.remove("modal-open"),document.body.style.paddingRight=""},300),v.disabled=!1,v.innerHTML=y,e.n=9;break;case 8:e.p=8,E=e.v,console.error("Error in handlePropertySubmit:",E),b="edit"===n.target.getAttribute("data-mode"),alert("An error occurred while ".concat(b?"updating":"adding"," the property. Please try again.")),(g=n.target.querySelector('button[type="submit"]'))&&(g.disabled=!1,I="edit"===n.target.getAttribute("data-mode"),g.innerHTML=I?'<i class="bi bi-pencil-square me-1"></i>Update Property':'<i class="bi bi-plus-circle me-1"></i>Add Property');case 9:return e.a(2)}},e,this,[[0,8]])})),function(e){return l.apply(this,arguments)})},{key:"addProperty",value:(c=o(t().m(function e(n){var r,o,a;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.post(API_CONFIG.ENDPOINTS.PROPERTIES,n);case 1:return r=e.v,e.n=2,r.json();case 2:if(!(o=e.v).success){e.n=4;break}return e.n=3,this.loadProperties();case 3:e.n=5;break;case 4:alert("Failed to add property: "+o.error);case 5:e.n=7;break;case 6:e.p=6,a=e.v,console.error("Error adding property:",a),alert("Error adding property. Please try again.");case 7:return e.a(2)}},e,this,[[0,6]])})),function(e){return c.apply(this,arguments)})},{key:"editProperty",value:(s=o(t().m(function e(n){var r;return t().w(function(e){for(;;)switch(e.n){case 0:if(r=this.properties.find(function(e){return e.propertyId===n})){e.n=1;break}return alert("Property not found"),e.a(2);case 1:this.showPropertyModal(r);case 2:return e.a(2)}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"updateProperty",value:(i=o(t().m(function e(n,r){var o,a,i;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.put(API_CONFIG.ENDPOINTS.PROPERTY_BY_ID(n),r);case 1:return o=e.v,e.n=2,o.json();case 2:if(!(a=e.v).success){e.n=4;break}return e.n=3,this.loadProperties();case 3:e.n=5;break;case 4:alert("Failed to update property: "+a.error);case 5:e.n=7;break;case 6:throw e.p=6,i=e.v,console.error("Error updating property:",i),alert("Error updating property: "+i.message),i;case 7:return e.a(2)}},e,this,[[0,6]])})),function(e,t){return i.apply(this,arguments)})},{key:"deleteProperty",value:(r=o(t().m(function e(n){var r,o,a;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(confirm("Are you sure you want to delete property ".concat(n,"?"))){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,API.delete(API_CONFIG.ENDPOINTS.PROPERTY_BY_ID(n));case 2:return r=e.v,e.n=3,r.json();case 3:if(!(o=e.v).success){e.n=5;break}return e.n=4,this.loadProperties();case 4:e.n=6;break;case 5:alert("Failed to delete property: "+o.error);case 6:e.n=8;break;case 7:e.p=7,a=e.v,console.error("Error deleting property:",a),alert("Error deleting property. Please try again.");case 8:return e.a(2)}},e,this,[[1,7]])})),function(e){return r.apply(this,arguments)})},{key:"escapeHtml",value:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}},{key:"refresh",value:function(){this.loadProperties()}}],n&&a(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r,i,s,c,l,u}();window.PropertyManagementComponent=s},41:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach(function(t){r(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function r(e,t,n){return(t=l(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,o,i){var s=r&&r.prototype instanceof l?r:l,u=Object.create(s.prototype);return a(u,"_invoke",function(n,r,o){var a,i,s,l=0,u=o||[],d=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,i=0,s=e,p.n=n,c}};function m(n,r){for(i=n,s=r,t=0;!d&&l&&!o&&t<u.length;t++){var o,a=u[t],m=p.p,f=a[2];n>3?(o=f===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=n<2&&m<a[1])?(i=0,p.v=r,p.n=a[1]):m<f&&(o=n<3||a[0]>r||r>f)&&(a[4]=n,a[5]=r,p.n=f,i=0))}if(o||n>1)return c;throw d=!0,r}return function(o,u,f){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,f),i=u,s=f;(t=i<2?e:s)||!d;){a||(i?i<3?(i>1&&(p.n=-1),m(i,s)):p.n=s:p.v=s);try{if(l=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=p.n<0)?s:n.call(r,p))!==c)break}catch(t){a=e,i=1,s=t}finally{l=1}}return{value:t,done:d}}}(n,o,i),!0),u}var c={};function l(){}function u(){}function d(){}t=Object.getPrototypeOf;var p=[][r]?t(t([][r]())):(a(t={},r,function(){return this}),t),m=d.prototype=l.prototype=Object.create(p);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,a(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=d,a(m,"constructor",d),a(d,"constructor",u),u.displayName="GeneratorFunction",a(d,i,"GeneratorFunction"),a(m),a(m,i,"Generator"),a(m,r,function(){return this}),a(m,"toString",function(){return"[object Generator]"}),(o=function(){return{w:s,m:f}})()}function a(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}a=function(e,t,n,r){function i(t,n){a(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},a(e,t,n,r)}function i(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)})}}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function l(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var u=function(){return t=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tenants=[],this.selectedProperties=[],this.propertiesCache=null,this.propertiesCacheTime=null,this.cacheTimeout=3e4,this.init()},r=[{key:"init",value:function(){this.setupEventListeners(),this.loadTenants()}},{key:"setupEventListeners",value:function(){var e=this,t=document.getElementById("addTenantBtn");t&&t.addEventListener("click",function(){e.showAddTenantModal()});var n=document.getElementById("tenantForm");n&&n.addEventListener("submit",function(t){t.preventDefault(),e.handleTenantSubmit(t)});var r=document.getElementById("tenantSearchInput");r&&r.addEventListener("input",function(t){e.filterTenants(t.target.value)})}},{key:"loadTenants",value:(v=s(o().m(function e(){var t,n,r;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.TENANTS);case 1:return t=e.v,e.n=2,t.json();case 2:(n=e.v).success?(this.tenants=n.tenants,this.renderTenantsTable(),window.updateSidebarBadges&&window.updateSidebarBadges()):(console.error("Failed to load tenants:",n.error),this.showEmptyState()),e.n=4;break;case 3:e.p=3,r=e.v,console.error("Error loading tenants:",r),this.showEmptyState("Error loading tenants. Please try again.");case 4:return e.a(2)}},e,this,[[0,3]])})),function(){return v.apply(this,arguments)})},{key:"renderTenantsTable",value:function(){var e=this,t=document.getElementById("tenantsTableBody");if(t)if(0!==this.tenants.length){var n="";this.tenants.forEach(function(t){n+="\n                <tr>\n                    <td>".concat(e.escapeHtml(t.name),"</td>\n                    <td>").concat(e.escapeHtml(t.fin),"</td>\n                    <td>").concat(e.escapeHtml(t.passportNumber),'</td>\n                    <td>\n                        <span class="badge bg-').concat(t.isRegistered?"success":"secondary",'">\n                            ').concat(t.isRegistered?"Registered":"Unregistered","\n                        </span>\n                        ").concat(t.isMainTenant?'<span class="badge bg-primary ms-1">Main</span>':"",'\n                    </td>\n                    <td>\n                        <span class="badge bg-info">\n                            ').concat(t.properties?t.properties.length:0,' properties\n                        </span>\n                    </td>\n                    <td>\n                        <button class="btn btn-sm btn-outline-primary me-1" onclick="tenantManager.editTenant(\'').concat(t.fin,'\')">\n                            <i class="bi bi-pencil"></i> Edit\n                        </button>\n                        <button class="btn btn-sm btn-outline-danger" onclick="tenantManager.deleteTenant(\'').concat(t.fin,'\')">\n                            <i class="bi bi-trash"></i> Delete\n                        </button>\n                    </td>\n                </tr>\n            ')}),t.innerHTML=n}else this.showEmptyState()}},{key:"showEmptyState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"No tenants found",t=document.getElementById("tenantsTableBody");t&&(t.innerHTML='\n            <tr>\n                <td colspan="6" class="text-center text-muted py-4">\n                    <i class="bi bi-people fs-1"></i>\n                    <p class="mt-2">'.concat(e,"</p>\n                </td>\n            </tr>\n        "))}},{key:"filterTenants",value:function(e){var t=this;if(e.trim()){var n=this.tenants.filter(function(t){return t.name.toLowerCase().includes(e.toLowerCase())||t.fin.toLowerCase().includes(e.toLowerCase())||t.passportNumber.toLowerCase().includes(e.toLowerCase())}),r=document.getElementById("tenantsTableBody");if(r)if(0!==n.length){var o="";n.forEach(function(e){o+="\n                <tr>\n                    <td>".concat(t.escapeHtml(e.name),"</td>\n                    <td>").concat(t.escapeHtml(e.fin),"</td>\n                    <td>").concat(t.escapeHtml(e.passportNumber),'</td>\n                    <td>\n                        <span class="badge bg-').concat(e.isRegistered?"success":"secondary",'">\n                            ').concat(e.isRegistered?"Registered":"Unregistered","\n                        </span>\n                        ").concat(e.isMainTenant?'<span class="badge bg-primary ms-1">Main</span>':"",'\n                    </td>\n                    <td>\n                        <span class="badge bg-info">\n                            ').concat(e.properties?e.properties.length:0,' properties\n                        </span>\n                    </td>\n                    <td>\n                        <button class="btn btn-sm btn-outline-primary me-1" onclick="tenantManager.editTenant(\'').concat(e.fin,'\')">\n                            <i class="bi bi-pencil"></i> Edit\n                        </button>\n                        <button class="btn btn-sm btn-outline-danger" onclick="tenantManager.deleteTenant(\'').concat(e.fin,'\')">\n                            <i class="bi bi-trash"></i> Delete\n                        </button>\n                    </td>\n                </tr>\n            ')}),r.innerHTML=o}else this.showEmptyState('No tenants match "'.concat(e,'"'))}else this.renderTenantsTable()}},{key:"showAddTenantModal",value:function(){this.showTenantModal()}},{key:"showTenantModal",value:(f=s(o().m(function e(){var t,n,r,a,i,s=this,c=arguments;return o().w(function(e){for(;;)switch(e.n){case 0:return n=!!(t=c.length>0&&void 0!==c[0]?c[0]:null),document.getElementById("tenantModalTitle").textContent=n?"Edit Tenant":"Add New Tenant",document.getElementById("tenantSubmitBtn").innerHTML=n?'<i class="bi bi-person-check me-1"></i><span id="tenantSubmitText">Update Tenant</span>':'<i class="bi bi-person-plus me-1"></i><span id="tenantSubmitText">Add Tenant</span>',(r=document.getElementById("tenantForm"))&&(r.reset(),r.setAttribute("data-tenant-fin",(null==t?void 0:t.fin)||""),r.setAttribute("data-mode",n?"edit":"add"),n&&t?(document.getElementById("tenantName").value=t.name||"",document.getElementById("tenantFin").value=t.fin||"",document.getElementById("tenantPassport").value=t.passportNumber||"",document.getElementById("tenantIsRegistered").checked=t.isRegistered||!1,document.getElementById("tenantIsMainTenant").checked=t.isMainTenant||!1,this.selectedProperties=(t.properties||[]).map(function(e){return"string"==typeof e?e:e.propertyId||e._id}),document.getElementById("tenantFin").readOnly=!0,document.getElementById("tenantFin").classList.add("bg-light")):(this.selectedProperties=[],document.getElementById("tenantFin").readOnly=!1,document.getElementById("tenantFin").classList.remove("bg-light"))),e.n=1,this.loadPropertiesForSelect();case 1:this.updateSelectedPropertiesList(),a=document.getElementById("tenantModal"),i=new bootstrap.Modal(a),a.addEventListener("hidden.bs.modal",function(){s.cleanupModal()},{once:!0}),i.show();case 2:return e.a(2)}},e,this)})),function(){return f.apply(this,arguments)})},{key:"cleanupModal",value:function(){document.querySelectorAll(".modal-backdrop").forEach(function(e){return e.remove()}),document.body.classList.remove("modal-open"),document.body.style.paddingRight="",document.body.style.overflow="",this.selectedProperties=[]}},{key:"loadPropertiesForSelect",value:(m=s(o().m(function e(){var t,n,r,a,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t=Date.now(),!(this.propertiesCache&&this.propertiesCacheTime&&t-this.propertiesCacheTime<this.cacheTimeout)){e.n=1;break}return console.log("Using cached properties data"),this.populatePropertyCheckboxes(this.propertiesCache),e.a(2);case 1:return e.n=2,API.get(API_CONFIG.ENDPOINTS.PROPERTIES);case 2:return n=e.v,e.n=3,n.json();case 3:(r=e.v).success&&(this.propertiesCache=r,this.propertiesCacheTime=t),this.populatePropertyCheckboxes(r),e.n=5;break;case 4:e.p=4,i=e.v,console.error("Error loading properties:",i),(a=document.getElementById("propertyCheckboxList"))&&(a.innerHTML='<li class="px-3 py-2 text-danger">Error loading properties</li>');case 5:return e.a(2)}},e,this,[[0,4]])})),function(){return m.apply(this,arguments)})},{key:"populatePropertyCheckboxes",value:function(e){var t=this,n=document.getElementById("propertyCheckboxList");n&&e.success&&(n.innerHTML="",0!==e.properties.length?(e.properties.forEach(function(e){var r=document.createElement("li");r.className="px-3 py-2";var o="property-".concat(e.propertyId),a=t.selectedProperties.includes(e.propertyId);r.innerHTML='\n                <div class="form-check">\n                    <input class="form-check-input" type="checkbox" id="'.concat(o,'" \n                           value="').concat(e.propertyId,'" ').concat(a?"checked":"",'>\n                    <label class="form-check-label" for="').concat(o,'" style="cursor: pointer;">\n                        <strong>').concat(e.propertyId,"</strong> - ").concat(e.address,", ").concat(e.unit,"\n                    </label>\n                </div>\n            ");var i=r.querySelector('input[type="checkbox"]');i.addEventListener("change",function(e){t.handleCheckboxChange(e.target.value,e.target.checked)}),r.addEventListener("click",function(e){e.stopPropagation(),"INPUT"!==e.target.tagName&&(i.checked=!i.checked,t.handleCheckboxChange(i.value,i.checked))}),n.appendChild(r)}),this.updateDropdownText()):n.innerHTML='<li class="px-3 py-2 text-muted">No properties available</li>')}},{key:"handleCheckboxChange",value:function(e,t){t?this.selectedProperties.includes(e)||this.selectedProperties.push(e):this.selectedProperties=this.selectedProperties.filter(function(t){return t!==e}),this.updateSelectedPropertiesList(),this.updateDropdownText()}},{key:"updateDropdownText",value:function(){var e=document.getElementById("propertyDropdownText");if(e){var t=this.selectedProperties.length;e.textContent=0===t?"Select properties...":1===t?"1 property selected":"".concat(t," properties selected")}}},{key:"addPropertyToTenant",value:function(){console.log("addPropertyToTenant called - now handled by handlePropertySelectionChange")}},{key:"removePropertyFromTenant",value:function(e){this.selectedProperties=this.selectedProperties.filter(function(t){return t!==e}),this.updateSelectedPropertiesList(),this.updateDropdownText();var t=document.getElementById("property-".concat(e));t&&(t.checked=!1)}},{key:"updateSelectedPropertiesList",value:function(){var e=document.getElementById("selectedPropertiesList"),t=(document.getElementById("noPropertiesMessage"),document.getElementById("tenantProperties"));if(0===this.selectedProperties.length)e.innerHTML='<div class="text-muted" id="noPropertiesMessage">No properties assigned</div>',t.value="";else{var n="";this.selectedProperties.forEach(function(e){n+='\n                    <div class="badge bg-secondary me-2 mb-2 p-2">\n                        <i class="bi bi-building me-1"></i>'.concat(e,'\n                        <button type="button" class="btn-close btn-close-white ms-2" aria-label="Remove" \n                                onclick="tenantManager.removePropertyFromTenant(\'').concat(e,'\')" style="font-size: 0.7em;"></button>\n                    </div>\n                ')}),e.innerHTML=n,t.value=this.selectedProperties.join(",")}this.updateDropdownText()}},{key:"handleTenantSubmit",value:(p=s(o().m(function t(r){var a,i,s,c,l,u,d,p,m,f,v,y;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,a=r.target,i=new FormData(a),s="edit"===a.getAttribute("data-mode"),c=a.getAttribute("data-tenant-fin"),l={name:i.get("name").trim(),fin:i.get("fin").trim().toUpperCase(),passportNumber:i.get("passportNumber").trim().toUpperCase(),isRegistered:"on"===i.get("isRegistered"),isMainTenant:"on"===i.get("isMainTenant"),properties:this.selectedProperties},console.log("ðŸ”„ Tenant update data:",n(n({},l),{},{propertiesType:e(this.selectedProperties[0]),propertiesContent:this.selectedProperties})),l.name&&l.fin&&l.passportNumber){t.n=1;break}return alert("Please fill in all required fields (Name, FIN, Passport Number)"),t.a(2);case 1:if(!(l.fin.length>20)){t.n=2;break}return alert("FIN cannot exceed 20 characters"),t.a(2);case 2:if(!(l.passportNumber.length<6||l.passportNumber.length>15)){t.n=3;break}return alert("Passport number must be between 6 and 15 characters"),t.a(2);case 3:if(u=r.target.querySelector('button[type="submit"]'),d=u.innerHTML,u.disabled=!0,u.innerHTML=s?'<i class="bi bi-hourglass-split me-1"></i>Updating Tenant...':'<i class="bi bi-hourglass-split me-1"></i>Adding Tenant...',!s){t.n=5;break}return t.n=4,this.updateTenant(c,l);case 4:t.n=6;break;case 5:return t.n=6,this.addTenant(l);case 6:(p=bootstrap.Modal.getInstance(document.getElementById("tenantModal")))&&p.hide(),setTimeout(function(){var e=document.querySelector(".modal-backdrop");e&&e.remove(),document.body.classList.remove("modal-open"),document.body.style.paddingRight=""},300),u.disabled=!1,u.innerHTML=d,t.n=8;break;case 7:t.p=7,y=t.v,console.error("Error in handleTenantSubmit:",y),m="edit"===r.target.getAttribute("data-mode"),alert("An error occurred while ".concat(m?"updating":"adding"," the tenant. Please try again.")),(f=r.target.querySelector('button[type="submit"]'))&&(f.disabled=!1,v="edit"===r.target.getAttribute("data-mode"),f.innerHTML=v?'<i class="bi bi-person-check me-1"></i>Update Tenant':'<i class="bi bi-person-plus me-1"></i>Add Tenant');case 8:return t.a(2)}},t,this,[[0,7]])})),function(e){return p.apply(this,arguments)})},{key:"getTenantDataFromUser",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=prompt("Full Name:",(null==e?void 0:e.name)||"");if(!t)return null;var n=prompt("FIN (Singaporean ID):",(null==e?void 0:e.fin)||"");if(!n)return null;var r=prompt("Passport Number:",(null==e?void 0:e.passportNumber)||"");if(!r)return null;var o=confirm("Is this tenant active/registered?"),a=confirm("Is this the main tenant?");return{name:t,fin:n.toUpperCase(),passportNumber:r.toUpperCase(),isRegistered:o,isMainTenant:a,properties:(null==e?void 0:e.properties)||[]}}},{key:"addTenant",value:(d=s(o().m(function e(t){var n,r,a;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.post(API_CONFIG.ENDPOINTS.TENANTS,t);case 1:return n=e.v,e.n=2,n.json();case 2:if(!(r=e.v).success){e.n=4;break}return e.n=3,this.loadTenants();case 3:e.n=5;break;case 4:alert("Failed to add tenant: "+r.error);case 5:e.n=7;break;case 6:e.p=6,a=e.v,console.error("Error adding tenant:",a),alert("Error adding tenant. Please try again.");case 7:return e.a(2)}},e,this,[[0,6]])})),function(e){return d.apply(this,arguments)})},{key:"editTenant",value:(u=s(o().m(function e(t){var n;return o().w(function(e){for(;;)switch(e.n){case 0:if(n=this.tenants.find(function(e){return e.fin===t})){e.n=1;break}return alert("Tenant not found"),e.a(2);case 1:this.showTenantModal(n);case 2:return e.a(2)}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"updateTenant",value:(l=s(o().m(function e(t,n){var r,a,i,s;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,(r=this.tenants.find(function(e){return e.fin===t}))&&r._id){e.n=1;break}throw new Error("Tenant ID not found");case 1:return e.n=2,API.put(API_CONFIG.ENDPOINTS.TENANT_BY_ID(r._id),n);case 2:return a=e.v,e.n=3,a.json();case 3:if(!(i=e.v).success){e.n=5;break}return e.n=4,this.loadTenants();case 4:e.n=6;break;case 5:alert("Failed to update tenant: "+i.error);case 6:e.n=8;break;case 7:throw e.p=7,s=e.v,console.error("Error updating tenant:",s),alert("Error updating tenant: "+s.message),s;case 8:return e.a(2)}},e,this,[[0,7]])})),function(e,t){return l.apply(this,arguments)})},{key:"deleteTenant",value:(i=s(o().m(function e(t){var n,r,a,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(confirm("Are you sure you want to delete tenant ".concat(t,"?"))){e.n=1;break}return e.a(2);case 1:if(e.p=1,(n=this.tenants.find(function(e){return e.fin===t}))&&n._id){e.n=2;break}throw new Error("Tenant ID not found");case 2:return e.n=3,API.delete(API_CONFIG.ENDPOINTS.TENANT_BY_ID(n._id));case 3:return r=e.v,e.n=4,r.json();case 4:if(!(a=e.v).success){e.n=6;break}return e.n=5,this.loadTenants();case 5:e.n=7;break;case 6:alert("Failed to delete tenant: "+a.error);case 7:e.n=9;break;case 8:e.p=8,i=e.v,console.error("Error deleting tenant:",i),alert("Error deleting tenant. Please try again.");case 9:return e.a(2)}},e,this,[[1,8]])})),function(e){return i.apply(this,arguments)})},{key:"assignToProperty",value:(a=s(o().m(function e(t,n){var r,a,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.post(API_CONFIG.ENDPOINTS.TENANT_ADD_PROPERTY(t),{propertyId:n});case 1:return r=e.v,e.n=2,r.json();case 2:if(!(a=e.v).success){e.n=4;break}return e.n=3,this.loadTenants();case 3:e.n=5;break;case 4:alert("Failed to assign tenant to property: "+a.error);case 5:e.n=7;break;case 6:e.p=6,i=e.v,console.error("Error assigning tenant to property:",i),alert("Error assigning tenant to property. Please try again.");case 7:return e.a(2)}},e,this,[[0,6]])})),function(e,t){return a.apply(this,arguments)})},{key:"escapeHtml",value:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}},{key:"refresh",value:function(){this.loadTenants()}}],r&&c(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,a,i,l,u,d,p,m,f,v}();window.TenantManagementComponent=u},280:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function s(t,o,a,i){var s=o&&o.prototype instanceof l?o:l,u=Object.create(s.prototype);return n(u,"_invoke",function(t,n,o){var a,i,s,l=0,u=o||[],d=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,i=0,s=e,p.n=n,c}};function m(t,n){for(i=t,s=n,r=0;!d&&l&&!o&&r<u.length;r++){var o,a=u[r],m=p.p,f=a[2];t>3?(o=f===n)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=t<2&&m<a[1])?(i=0,p.v=n,p.n=a[1]):m<f&&(o=t<3||a[0]>n||n>f)&&(a[4]=t,a[5]=n,p.n=f,i=0))}if(o||t>1)return c;throw d=!0,n}return function(o,u,f){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,f),i=u,s=f;(r=i<2?e:s)||!d;){a||(i?i<3?(i>1&&(p.n=-1),m(i,s)):p.n=s:p.v=s);try{if(l=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(d=p.n<0)?s:t.call(n,p))!==c)break}catch(t){a=e,i=1,s=t}finally{l=1}}return{value:r,done:d}}}(t,a,i),!0),u}var c={};function l(){}function u(){}function d(){}r=Object.getPrototypeOf;var p=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),m=d.prototype=l.prototype=Object.create(p);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,n(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=d,n(m,"constructor",d),n(d,"constructor",u),u.displayName="GeneratorFunction",n(d,i,"GeneratorFunction"),n(m),n(m,i,"Generator"),n(m,a,function(){return this}),n(m,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m:f}})()}function n(e,t,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}n=function(e,t,r,o){function i(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},n(e,t,r,o)}function r(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var i=e.apply(t,n);function s(e){r(i,o,a,s,c,"next",e)}function c(e){r(i,o,a,s,c,"throw",e)}s(void 0)})}}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var s=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.selectedProperty=null,this.currentDate=new Date,this.currentReport=null,this.investors=[],this.isModalOpen=!1,this.isIncomeExpenseModalOpen=!1,this.init()},n=[{key:"init",value:function(){this.bindEvents(),this.loadProperties(),this.forceCleanupModalBackdrops()}},{key:"bindEvents",value:function(){var e=this,t=document.getElementById("propertySelector");t&&t.addEventListener("change",function(t){e.selectProperty(t.target.value)});var n=document.getElementById("prevMonth"),r=document.getElementById("nextMonth");n&&n.addEventListener("click",function(){e.changeMonth(-1)}),r&&r.addEventListener("click",function(){e.changeMonth(1)});var o=document.getElementById("addIncomeBtn"),a=document.getElementById("addExpenseBtn"),i=document.getElementById("addInvestorBtn");o&&o.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.isIncomeExpenseModalOpen||e.showIncomeExpenseModal("income").catch(console.error)}),a&&a.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.isIncomeExpenseModalOpen||e.showIncomeExpenseModal("expense").catch(console.error)}),i&&i.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.isModalOpen||e.showInvestorModal()})}},{key:"loadProperties",value:(y=o(t().m(function e(){var n,r,o;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.PROPERTIES);case 1:return n=e.v,e.n=2,n.json();case 2:(r=e.v).success?this.populatePropertySelector(r.properties):401===n.status||403===n.status?(this.showError("Please log in to load properties"),this.populatePropertySelector([])):(this.showError(r.error||"Failed to load properties"),this.populatePropertySelector([])),e.n=4;break;case 3:e.p=3,o=e.v,console.error("Error loading properties:",o),this.showError("Failed to load properties. Please check your connection and try again."),this.populatePropertySelector([]);case 4:return e.a(2)}},e,this,[[0,3]])})),function(){return y.apply(this,arguments)})},{key:"populatePropertySelector",value:function(e){var t=document.getElementById("propertySelector");if(t)if(t.innerHTML="",e&&0!==e.length){var n=document.createElement("option");n.value="",n.textContent="Select a property...",t.appendChild(n),e.forEach(function(e){var n=document.createElement("option");n.value=e.propertyId,n.textContent="".concat(e.propertyId," - ").concat(e.address,", ").concat(e.unit),t.appendChild(n)})}else t.innerHTML='<option value="" disabled>No properties available - please log in or add properties</option>'}},{key:"selectProperty",value:(v=o(t().m(function e(n){return t().w(function(e){for(;;)switch(e.n){case 0:if(this.forceCleanupModalBackdrops(),this.isModalOpen=!1,this.isIncomeExpenseModalOpen=!1,n){e.n=1;break}return this.selectedProperty=null,document.getElementById("financialReportContent").style.display="none",e.a(2);case 1:return this.selectedProperty=n,document.getElementById("financialReportContent").style.display="block",e.n=2,this.loadInvestors(n);case 2:return e.n=3,this.loadFinancialReport();case 3:this.updateMonthDisplay();case 4:return e.a(2)}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"loadInvestors",value:(f=o(t().m(function e(n){var r,o,a;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.INVESTORS_BY_PROPERTY(n));case 1:return r=e.v,e.n=2,r.json();case 2:(o=e.v).success&&(this.investors=o.data,this.updateInvestorDisplay()),e.n=4;break;case 3:e.p=3,a=e.v,console.error("Error loading investors:",a),this.investors=[],this.updateInvestorDisplay();case 4:return e.a(2)}},e,this,[[0,3]])})),function(e){return f.apply(this,arguments)})},{key:"loadFinancialReport",value:(m=o(t().m(function e(){var n,r,o,a,i;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.selectedProperty){e.n=1;break}return e.a(2);case 1:return e.p=1,n=this.currentDate.getFullYear(),r=this.currentDate.getMonth()+1,e.n=2,API.get(API_CONFIG.ENDPOINTS.FINANCIAL_REPORT(this.selectedProperty,n,r));case 2:if(!(o=e.v).ok){e.n=4;break}return e.n=3,o.json();case 3:(a=e.v).success?this.currentReport=a.data:this.currentReport=null,e.n=5;break;case 4:404===o.status&&(this.currentReport={propertyId:this.selectedProperty,year:n,month:r,income:[],expenses:[],investorTransactions:[],totalIncome:0,totalExpenses:0,netProfit:0});case 5:this.updateDisplays(),e.n=7;break;case 6:e.p=6,i=e.v,console.error("Error loading financial report:",i),this.currentReport={propertyId:this.selectedProperty,year:this.currentDate.getFullYear(),month:this.currentDate.getMonth()+1,income:[],expenses:[],investorTransactions:[],totalIncome:0,totalExpenses:0,netProfit:0},this.updateDisplays();case 7:return e.a(2)}},e,this,[[1,6]])})),function(){return m.apply(this,arguments)})},{key:"updateDisplays",value:function(){this.updateIncomeDisplay(),this.updateExpenseDisplay(),this.updateSummaryDisplay(),this.updateInvestorDisplay()}},{key:"updateIncomeDisplay",value:function(){var e=this,t=document.getElementById("incomeList"),n=document.getElementById("totalIncome");if(!this.currentReport||!this.currentReport.income||0===this.currentReport.income.length)return t.innerHTML='\n                <div class="text-center text-muted py-4" id="noIncomeMessage">\n                    <i class="bi bi-plus-circle fs-1"></i>\n                    <p class="mt-2">No income items added</p>\n                </div>\n            ',void(n&&(n.textContent="$0.00"));var r="",o=0;this.currentReport.income.forEach(function(t,n){o+=t.amount;var a=e.investors.find(function(e){return e.investorId===t.personInCharge}),i=a?a.name:t.personInCharge;r+='\n                <div class="border-bottom py-2 mb-2">\n                    <div class="d-flex justify-content-between align-items-start">\n                        <div class="flex-grow-1">\n                            <h6 class="mb-1">'.concat(escapeHtml(t.item),'</h6>\n                            <small class="text-muted">\n                                Person: ').concat(escapeHtml(i)).concat(t.recipientAccountDetail?" | Account: "+escapeHtml(t.recipientAccountDetail):"",'\n                            </small>\n                        </div>\n                        <div class="text-end">\n                            <div class="fw-bold text-success">$').concat(t.amount.toFixed(2),'</div>\n                        </div>\n                    </div>\n                    <div class="mt-2">\n                        <button class="btn btn-sm btn-outline-primary me-2" onclick="window.financialReports.editItem(\'income\', ').concat(n,')">\n                            <i class="bi bi-pencil"></i>\n                        </button>\n                        <button class="btn btn-sm btn-outline-danger" onclick="window.financialReports.deleteItem(\'income\', ').concat(n,')">\n                            <i class="bi bi-trash"></i>\n                        </button>\n                    </div>\n                </div>\n            ')}),t.innerHTML=r,n&&(n.textContent="$".concat(o.toFixed(2)))}},{key:"updateExpenseDisplay",value:function(){var e=this,t=document.getElementById("expenseList"),n=document.getElementById("totalExpenses");if(!this.currentReport||!this.currentReport.expenses||0===this.currentReport.expenses.length)return t.innerHTML='\n                <div class="text-center text-muted py-4">\n                    <i class="bi bi-dash-circle fs-1"></i>\n                    <p class="mt-2">No expense items added</p>\n                </div>\n            ',void(n&&(n.textContent="$0.00"));var r="",o=0;this.currentReport.expenses.forEach(function(t,n){o+=t.amount;var a=e.investors.find(function(e){return e.investorId===t.personInCharge}),i=a?a.name:t.personInCharge;r+='\n                <div class="border-bottom py-2 mb-2">\n                    <div class="d-flex justify-content-between align-items-start">\n                        <div class="flex-grow-1">\n                            <h6 class="mb-1">'.concat(escapeHtml(t.item),'</h6>\n                            <small class="text-muted">\n                                Person: ').concat(escapeHtml(i)).concat(t.recipientAccountDetail?" | Account: "+escapeHtml(t.recipientAccountDetail):"",'\n                            </small>\n                        </div>\n                        <div class="text-end">\n                            <div class="fw-bold text-danger">$').concat(t.amount.toFixed(2),'</div>\n                        </div>\n                    </div>\n                    <div class="mt-2">\n                        <button class="btn btn-sm btn-outline-primary me-2" onclick="window.financialReports.editItem(\'expense\', ').concat(n,')">\n                            <i class="bi bi-pencil"></i>\n                        </button>\n                        <button class="btn btn-sm btn-outline-danger" onclick="window.financialReports.deleteItem(\'expense\', ').concat(n,')">\n                            <i class="bi bi-trash"></i>\n                        </button>\n                    </div>\n                </div>\n            ')}),t.innerHTML=r,n&&(n.textContent="$".concat(o.toFixed(2)))}},{key:"updateSummaryDisplay",value:function(){if(this.currentReport){var e=(this.currentReport.totalIncome||0)-(this.currentReport.totalExpenses||0),t=document.getElementById("netProfit");t&&(t.textContent="$".concat(e.toFixed(2)),t.className=e>=0?"text-success mb-0":"text-danger mb-0")}}},{key:"updateInvestorDisplay",value:function(){var e=this,t=document.getElementById("investorDistribution");if(this.investors&&0!==this.investors.length){var n=this.currentReport?(this.currentReport.totalIncome||0)-(this.currentReport.totalExpenses||0):0,r="";this.investors.forEach(function(t){var o=t.properties.find(function(t){return t.propertyId===e.selectedProperty}),a=o?o.percentage:0,i=n*a/100,s=e.currentReport&&e.currentReport.investorTransactions?e.currentReport.investorTransactions.find(function(e){return e.investorId===t.investorId}):null,c=s?s.alreadyPaid:0,l=s?s.alreadyReceived:0,u=e.currentReport&&e.currentReport.expenses?e.currentReport.expenses.filter(function(e){return e.personInCharge===t.investorId}).reduce(function(e,t){return e+t.amount},0):0,d=e.currentReport&&e.currentReport.income?e.currentReport.income.filter(function(e){return e.personInCharge===t.investorId}).reduce(function(e,t){return e+t.amount},0):0,p=i-c+l+u-d;r+='\n                <div class="card mb-2">\n                    <div class="card-body py-2">\n                        \x3c!-- Mobile layout --\x3e\n                        <div class="d-md-none">\n                            <div class="d-flex justify-content-between align-items-start mb-2">\n                                <div>\n                                    <h6 class="mb-1">'.concat(escapeHtml(t.name),'</h6>\n                                    <small class="text-muted">').concat(t.investorId,"</small>\n                                    ").concat(t.phone?'<br><small class="text-muted">'.concat(escapeHtml(t.phone),"</small>"):"",'\n                                </div>\n                                <div class="text-end">\n                                    <button class="btn btn-sm btn-outline-primary me-1" onclick="window.financialReports.editInvestor(\'').concat(t.investorId,'\')" title="Edit">\n                                        <i class="bi bi-pencil"></i>\n                                    </button>\n                                    <button class="btn btn-sm btn-outline-danger" onclick="window.financialReports.removeInvestor(\'').concat(t.investorId,'\')" title="Remove">\n                                        <i class="bi bi-trash"></i>\n                                    </button>\n                                </div>\n                            </div>\n                            <div class="row text-center">\n                                <div class="col-4">\n                                    <div class="fw-bold">').concat(a,'%</div>\n                                    <small class="text-muted">Share</small>\n                                </div>\n                                <div class="col-4">\n                                    <div class="fw-bold text-primary">$').concat(i.toFixed(2),'</div>\n                                    <small class="text-muted">Profit Share</small>\n                                </div>\n                                <div class="col-4">\n                                    <div class="fw-bold text-warning">$').concat(u.toFixed(2),'</div>\n                                    <small class="text-muted">Paid</small>\n                                </div>\n                            </div>\n                            <div class="row text-center mt-2">\n                                <div class="col-6">\n                                    <div class="fw-bold text-info">$').concat(d.toFixed(2),'</div>\n                                    <small class="text-muted">Received</small>\n                                </div>\n                                <div class="col-6">\n                                    <div class="fw-bold ').concat(p>=0?"text-success":"text-danger",'">\n                                        $').concat(p.toFixed(2),'\n                                    </div>\n                                    <small class="text-muted">Final</small>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Desktop layout --\x3e\n                        <div class="row align-items-center d-none d-md-flex">\n                            <div class="col-md-3 col-lg-2">\n                                <h6 class="mb-0">').concat(escapeHtml(t.name),'</h6>\n                                <small class="text-muted">').concat(t.investorId,"</small>\n                                ").concat(t.phone?'<br><small class="text-muted">'.concat(escapeHtml(t.phone),"</small>"):"",'\n                            </div>\n                            <div class="col-md-1 col-lg-1 text-center">\n                                <div class="fw-bold">').concat(a,'%</div>\n                                <small class="text-muted">Share</small>\n                            </div>\n                            <div class="col-md-2 col-lg-2 text-center">\n                                <div class="fw-bold text-primary">$').concat(i.toFixed(2),'</div>\n                                <small class="text-muted">Profit Share</small>\n                            </div>\n                            <div class="col-md-2 col-lg-2 text-center">\n                                <div class="fw-bold text-warning">$').concat(u.toFixed(2),'</div>\n                                <small class="text-muted">Paid</small>\n                            </div>\n                            <div class="col-md-2 col-lg-2 text-center">\n                                <div class="fw-bold text-info">$').concat(d.toFixed(2),'</div>\n                                <small class="text-muted">Received</small>\n                            </div>\n                            <div class="col-md-1 col-lg-2 text-center">\n                                <div class="fw-bold ').concat(p>=0?"text-success":"text-danger",'">\n                                    $').concat(p.toFixed(2),'\n                                </div>\n                                <small class="text-muted">Final</small>\n                            </div>\n                            <div class="col-md-1 col-lg-1 text-end">\n                                <button class="btn btn-sm btn-outline-primary me-1" onclick="window.financialReports.editInvestor(\'').concat(t.investorId,'\')" title="Edit">\n                                    <i class="bi bi-pencil"></i>\n                                </button>\n                                <button class="btn btn-sm btn-outline-danger" onclick="window.financialReports.removeInvestor(\'').concat(t.investorId,'\')" title="Remove">\n                                    <i class="bi bi-trash"></i>\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            ')}),t.innerHTML=r}else t.innerHTML='\n                <div class="text-center text-muted py-3">\n                    <i class="bi bi-person-lines-fill fs-1"></i>\n                    <p class="mt-2">No investors configured for this property</p>\n                </div>\n            '}},{key:"updateMonthDisplay",value:function(){var e=document.getElementById("currentMonth"),t=document.getElementById("currentMonthBadge");if(e){var n=["January","February","March","April","May","June","July","August","September","October","November","December"][this.currentDate.getMonth()],r=this.currentDate.getFullYear();e.textContent="".concat(n," ").concat(r)}if(t){var o=new Date,a=this.currentDate.getMonth()===o.getMonth()&&this.currentDate.getFullYear()===o.getFullYear();t.textContent=a?"Current Month":"Historical";var i=window.innerWidth<768?"":"fs-6";t.className=a?"badge bg-info ".concat(i).trim():"badge bg-secondary ".concat(i).trim()}}},{key:"changeMonth",value:function(e){var t=new Date(this.currentDate);t.setMonth(t.getMonth()+e),this.currentDate=t,this.updateMonthDisplay(),this.loadFinancialReport()}},{key:"showIncomeExpenseModal",value:(p=o(t().m(function e(n){var r,o,a,i,s=this;return t().w(function(e){for(;;)switch(e.n){case 0:if(!this.isIncomeExpenseModalOpen){e.n=1;break}return e.a(2);case 1:if(this.investors&&0!==this.investors.length){e.n=2;break}return this.showError("Please add investors to this property before adding ".concat(n," items.")),e.a(2);case 2:return this.isIncomeExpenseModalOpen=!0,this.cleanupExistingModals(),r=this.createIncomeExpenseModalHtml(n),document.body.insertAdjacentHTML("beforeend",r),e.n=3,new Promise(function(e){return setTimeout(e,10)});case 3:if(o=document.getElementById("incomeExpenseModal")){e.n=4;break}return console.error("Modal element not found in DOM"),this.isIncomeExpenseModalOpen=!1,e.a(2);case 4:a=new bootstrap.Modal(o,{backdrop:!0,keyboard:!0,focus:!1}),o.addEventListener("shown.bs.modal",function(){var e=o.querySelector('input[name="item"]');e&&(o.querySelectorAll("input, select, textarea").forEach(function(e){e.removeAttribute("disabled"),e.removeAttribute("readonly"),e.style.pointerEvents="auto",e.tabIndex=0,e.addEventListener("click",function(e){e.stopPropagation(),this.focus()}),e.addEventListener("mousedown",function(e){e.stopPropagation()})}),setTimeout(function(){e.focus()},100),setTimeout(function(){e.focus(),e.select()},300))}),o.addEventListener("hidden.bs.modal",function(){s.isIncomeExpenseModalOpen=!1,o.remove(),setTimeout(function(){s.forceCleanupModalBackdrops()},100)}),a.show(),(i=document.getElementById("incomeExpenseForm"))&&i.addEventListener("submit",function(e){e.preventDefault(),"true"!==i.dataset.submitting&&(i.dataset.submitting="true",s.saveIncomeExpenseItem(n,a).finally(function(){i.dataset.submitting="false"}))});case 5:return e.a(2)}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"generateInvestorOptions",value:function(){return this.investors&&0!==this.investors.length?this.investors.map(function(e){return'<option value="'.concat(e.investorId,'">').concat(escapeHtml(e.name)," (ID: ").concat(e.investorId,")</option>")}).join(""):'<option value="" disabled>No investors available for this property</option>'}},{key:"createIncomeExpenseModalHtml",value:function(e){var t="income"===e,n=t?"Add Income Item":"Add Expense Item",r=t?"plus-circle":"dash-circle",o=t?"success":"danger";return'\n            <div class="modal fade" id="incomeExpenseModal" tabindex="-1" aria-labelledby="incomeExpenseModalLabel" aria-hidden="true">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h5 class="modal-title" id="incomeExpenseModalLabel">\n                                <i class="bi bi-'.concat(r,' me-2"></i>').concat(n,'\n                            </h5>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                        </div>\n                        <form id="incomeExpenseForm">\n                            <div class="modal-body">\n                                <div class="mb-3">\n                                    <label class="form-label">Item Description <span class="text-danger">*</span></label>\n                                    <input type="text" class="form-control" name="item" required placeholder="e.g., Rent, Utilities, Repairs" autocomplete="off">\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Amount (SGD) <span class="text-danger">*</span></label>\n                                    <div class="input-group">\n                                        <span class="input-group-text">$</span>\n                                        <input type="number" class="form-control" name="amount" required min="0" step="0.01" placeholder="0.00" autocomplete="off">\n                                    </div>\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Person in Charge <span class="text-danger">*</span></label>\n                                    <select class="form-select" name="personInCharge" required>\n                                        <option value="">Select investor...</option>\n                                        ').concat(this.generateInvestorOptions(),'\n                                    </select>\n                                    <div class="form-text">Select the investor responsible for this ').concat(e,'</div>\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Account Details</label>\n                                    <input type="text" class="form-control" name="recipientAccountDetail" placeholder="Bank or payment details (optional)" autocomplete="off">\n                                    <div class="form-text">Optional: Add bank account or payment method details</div>\n                                </div>\n                            </div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>\n                                <button type="submit" class="btn btn-').concat(o,'">\n                                    <i class="bi bi-').concat(r,' me-1"></i>Add ').concat(t?"Income":"Expense","\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                </div>\n            </div>\n        ")}},{key:"saveIncomeExpenseItem",value:(d=o(t().m(function e(n,r){var o,a,i,s,c,l,u,d,p,m=this;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return o=document.getElementById("incomeExpenseForm"),a=new FormData(o),i={item:a.get("item"),amount:parseFloat(a.get("amount")),personInCharge:a.get("personInCharge"),recipientAccountDetail:a.get("recipientAccountDetail")},e.p=1,s=this.currentDate.getFullYear(),c=this.currentDate.getMonth()+1,l="income"===n?API_CONFIG.ENDPOINTS.FINANCIAL_REPORT_INCOME(this.selectedProperty,s,c):API_CONFIG.ENDPOINTS.FINANCIAL_REPORT_EXPENSES(this.selectedProperty,s,c),e.n=2,API.post(l,i);case 2:return u=e.v,e.n=3,u.json();case 3:if(!(d=e.v).success){e.n=5;break}return this.isIncomeExpenseModalOpen=!1,r.hide(),setTimeout(function(){m.forceCleanupModalBackdrops()},150),e.n=4,this.loadFinancialReport();case 4:this.showSuccess("".concat(n.charAt(0).toUpperCase()+n.slice(1)," item added successfully")),e.n=6;break;case 5:throw new Error(d.message||"Failed to add ".concat(n," item"));case 6:e.n=8;break;case 7:e.p=7,p=e.v,console.error("Error saving ".concat(n," item:"),p),this.showError(p.message||"Failed to add ".concat(n," item"));case 8:return e.a(2)}},e,this,[[1,7]])})),function(e,t){return d.apply(this,arguments)})},{key:"showInvestorModal",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this.isModalOpen){this.isModalOpen=!0,this.cleanupExistingModals();var n=this.createInvestorModalHtml(t);document.body.insertAdjacentHTML("beforeend",n);var r=document.getElementById("investorModal"),o=new bootstrap.Modal(r,{backdrop:!0,keyboard:!0,focus:!1});r.addEventListener("shown.bs.modal",function(){t&&e.fillInvestorForm(t);var n=r.querySelector('input[name="username"]');n&&n.focus()}),r.addEventListener("hidden.bs.modal",function(){e.isModalOpen=!1,r.remove(),setTimeout(function(){e.forceCleanupModalBackdrops()},100)}),o.show();var a=document.getElementById("investorForm");a.addEventListener("submit",function(n){n.preventDefault(),"true"!==a.dataset.submitting&&(a.dataset.submitting="true",e.saveInvestor(t,o).finally(function(){a.dataset.submitting="false"}))})}}},{key:"cleanupExistingModals",value:function(){["investorModal","incomeExpenseModal"].forEach(function(e){var t=document.getElementById(e);if(t){try{var n=bootstrap.Modal.getInstance(t);n&&(n.hide(),n.dispose())}catch(e){}t.remove()}}),this.forceCleanupModalBackdrops()}},{key:"forceCleanupModalBackdrops",value:function(){document.querySelectorAll(".modal-backdrop").forEach(function(e){e.remove()}),document.querySelectorAll(".modal").forEach(function(e){"investorModal"!==e.id&&"incomeExpenseModal"!==e.id||e.remove()}),document.body.classList.remove("modal-open"),document.body.style.removeProperty("overflow"),document.body.style.removeProperty("padding-right"),document.body.style.removeProperty("margin-right"),document.body.offsetHeight}},{key:"createInvestorModalHtml",value:function(e){var t=!!e;return'\n            <div class="modal fade" id="investorModal" tabindex="-1" aria-labelledby="investorModalLabel" aria-hidden="true">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h5 class="modal-title" id="investorModalLabel">\n                                <i class="bi bi-person-plus me-2"></i>'.concat(t?"Edit Investor":"Add Investor",'\n                            </h5>\n                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                        </div>\n                        <form id="investorForm">\n                            <div class="modal-body">\n                                <div class="mb-3">\n                                    <label class="form-label">Username <span class="text-danger">*</span></label>\n                                    <input type="text" class="form-control" name="username" required placeholder="Enter unique username" autocomplete="off">\n                                    <div class="form-text">Unique username for this investor (e.g., john_smith, investor1)</div>\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Investor Name <span class="text-danger">*</span></label>\n                                    <input type="text" class="form-control" name="name" required placeholder="Enter full name" autocomplete="off">\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Percentage Share <span class="text-danger">*</span></label>\n                                    <div class="input-group">\n                                        <input type="number" class="form-control" name="percentage" required min="0" max="100" step="0.1" placeholder="0.0" autocomplete="off">\n                                        <span class="input-group-text">%</span>\n                                    </div>\n                                    <div class="form-text">Enter percentage share (0-100%)</div>\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Phone Number (Optional)</label>\n                                    <input type="tel" class="form-control" name="phone" placeholder="Enter phone number" autocomplete="off">\n                                </div>\n                                <div class="mb-3">\n                                    <label class="form-label">Email (Optional)</label>\n                                    <input type="email" class="form-control" name="email" placeholder="Enter email address" autocomplete="off">\n                                </div>\n                            </div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>\n                                <button type="submit" class="btn btn-primary">\n                                    <i class="bi bi-check-circle me-1"></i>').concat(t?"Update":"Add"," Investor\n                                </button>\n                            </div>\n                        </form>\n                    </div>\n                </div>\n            </div>\n        ")}},{key:"fillInvestorForm",value:function(e){var t=this,n=this.investors.find(function(t){return t.investorId===e});if(n){var r=document.getElementById("investorForm"),o=r.querySelector('input[name="username"]'),a=r.querySelector('input[name="name"]'),i=r.querySelector('input[name="phone"]'),s=r.querySelector('input[name="email"]'),c=r.querySelector('input[name="percentage"]');o&&(o.value=n.username||""),a&&(a.value=n.name||""),i&&(i.value=n.phone||""),s&&(s.value=n.email||"");var l=n.properties.find(function(e){return e.propertyId===t.selectedProperty});l&&c&&(c.value=l.percentage)}}},{key:"saveInvestor",value:(u=o(t().m(function e(n,r){var o,a,i,s,c,l=this;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(o=document.getElementById("investorForm"),a=new FormData(o),i={username:a.get("username")||"",name:a.get("name")||"",phone:a.get("phone")||"",email:a.get("email")||"",percentage:parseFloat(a.get("percentage"))||0},e.p=1,!n){e.n=3;break}return e.n=2,this.updateInvestor(n,i);case 2:e.n=4;break;case 3:return e.n=4,this.createInvestor(i);case 4:return this.isModalOpen=!1,r.hide(),setTimeout(function(){l.forceCleanupModalBackdrops()},150),e.n=5,this.loadInvestors(this.selectedProperty);case 5:n?this.showSuccess("Investor updated successfully"):(s=this.lastActionWasAddPropertyToExisting,this.lastActionWasAddPropertyToExisting=!1,s?this.showSuccess("Existing investor added to this property successfully"):this.showSuccess("New investor created and added successfully")),e.n=7;break;case 6:e.p=6,c=e.v,console.error("Error saving investor:",c),this.showError(c.message||"Failed to ".concat(n?"update":"add"," investor"));case 7:return e.a(2)}},e,this,[[1,6]])})),function(e,t){return u.apply(this,arguments)})},{key:"createInvestor",value:(l=o(t().m(function e(n){var r,o,a,i,s,c,l,u,d,p,m=this;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.INVESTORS);case 1:return r=e.v,e.n=2,r.json();case 2:if(!(o=e.v).success||!o.data){e.n=7;break}if(!(a=o.data.find(function(e){return e.username&&n.username?e.username===n.username:e.name.toLowerCase()===n.name.toLowerCase()}))){e.n=7;break}if(!a.properties.some(function(e){return e.propertyId===m.selectedProperty})){e.n=3;break}throw new Error("Investor is already invested in this property");case 3:return e.n=4,API.post(API_CONFIG.ENDPOINTS.INVESTOR_ADD_PROPERTY(a.investorId),{propertyId:this.selectedProperty,percentage:n.percentage});case 4:return i=e.v,e.n=5,i.json();case 5:if((s=e.v).success){e.n=6;break}throw new Error(s.message||"Failed to add property to existing investor");case 6:return this.lastActionWasAddPropertyToExisting=!0,e.a(2);case 7:return e.n=8,this.generateInvestorId();case 8:return c=e.v,l={investorId:c,username:n.username,name:n.name,phone:n.phone,email:n.email,properties:[{propertyId:this.selectedProperty,percentage:n.percentage}]},e.n=9,API.post(API_CONFIG.ENDPOINTS.INVESTORS,l);case 9:return u=e.v,e.n=10,u.json();case 10:if((d=e.v).success){e.n=11;break}throw new Error(d.message||"Failed to create investor");case 11:e.n=13;break;case 12:throw e.p=12,p=e.v,console.error("Error in createInvestor:",p),p;case 13:return e.a(2)}},e,this,[[0,12]])})),function(e){return l.apply(this,arguments)})},{key:"generateInvestorId",value:(c=o(t().m(function e(){var n,r,o,a;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.INVESTORS);case 1:return n=e.v,e.n=2,n.json();case 2:if(!(r=e.v).success||!r.data){e.n=3;break}return o=0,r.data.forEach(function(e){var t=parseInt(e.investorId);!isNaN(t)&&t>o&&(o=t)}),e.a(2,(o+1).toString());case 3:return e.a(2,"1");case 4:e.n=6;break;case 5:return e.p=5,a=e.v,console.error("Error generating investor ID:",a),e.a(2,Date.now().toString());case 6:return e.a(2)}},e,null,[[0,5]])})),function(){return c.apply(this,arguments)})},{key:"updateInvestor",value:(s=o(t().m(function e(n,r){var o,a;return t().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,API.put(API_CONFIG.ENDPOINTS.INVESTOR_BY_ID(n),r);case 1:return o=e.v,e.n=2,o.json();case 2:if((a=e.v).success){e.n=3;break}throw new Error(a.message||"Failed to update investor");case 3:return e.a(2)}},e)})),function(e,t){return s.apply(this,arguments)})},{key:"editInvestor",value:function(e){this.showInvestorModal(e)}},{key:"removeInvestor",value:(i=o(t().m(function e(n){var r,o,a;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(confirm("Are you sure you want to remove this investor from this property?")){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,API.delete(API_CONFIG.ENDPOINTS.INVESTOR_REMOVE_PROPERTY(n,this.selectedProperty));case 2:return r=e.v,e.n=3,r.json();case 3:if(!(o=e.v).success){e.n=5;break}return e.n=4,this.loadInvestors(this.selectedProperty);case 4:"deleted_completely"===o.action?this.showSuccess("Investor removed completely from database (no more property investments)"):this.showSuccess("Investor removed from this property successfully"),e.n=6;break;case 5:throw new Error(o.message||"Failed to remove investor");case 6:e.n=8;break;case 7:e.p=7,a=e.v,console.error("Error removing investor:",a),this.showError(a.message||"Failed to remove investor");case 8:return e.a(2)}},e,this,[[1,7]])})),function(e){return i.apply(this,arguments)})},{key:"editItem",value:function(e,t){this.showInfo("Edit functionality for ".concat(e," item #").concat(t+1," coming soon!"))}},{key:"deleteItem",value:(r=o(t().m(function e(n,r){var o,a,i,s,c,l;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(confirm("Are you sure you want to delete this item?")){e.n=1;break}return e.a(2);case 1:return e.p=1,o=this.currentDate.getFullYear(),a=this.currentDate.getMonth()+1,i="income"===n?API_CONFIG.ENDPOINTS.FINANCIAL_REPORT_INCOME(this.selectedProperty,o,a)+"/".concat(r):API_CONFIG.ENDPOINTS.FINANCIAL_REPORT_EXPENSES(this.selectedProperty,o,a)+"/".concat(r),e.n=2,API.delete(i);case 2:return s=e.v,e.n=3,s.json();case 3:if(!(c=e.v).success){e.n=5;break}return e.n=4,this.loadFinancialReport();case 4:this.showSuccess("".concat(n.charAt(0).toUpperCase()+n.slice(1)," item deleted successfully")),e.n=6;break;case 5:throw new Error(c.message||"Failed to delete ".concat(n," item"));case 6:e.n=8;break;case 7:e.p=7,l=e.v,console.error("Error deleting ".concat(n," item:"),l),this.showError(l.message||"Failed to delete ".concat(n," item"));case 8:return e.a(2)}},e,this,[[1,7]])})),function(e,t){return r.apply(this,arguments)})},{key:"showToast",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){showToast(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info")})},{key:"showSuccess",value:function(e){this.showToast(e,"success")}},{key:"showError",value:function(e){this.showToast(e,"error")}},{key:"showInfo",value:function(e){this.showToast(e,"info")}},{key:"refresh",value:function(){this.selectedProperty&&this.loadFinancialReport()}}],n&&a(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r,i,s,c,l,u,d,p,m,f,v,y}();window.FinancialReportsComponent=s},500:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function s(t,o,a,i){var s=o&&o.prototype instanceof l?o:l,u=Object.create(s.prototype);return n(u,"_invoke",function(t,n,o){var a,i,s,l=0,u=o||[],d=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,i=0,s=e,p.n=n,c}};function m(t,n){for(i=t,s=n,r=0;!d&&l&&!o&&r<u.length;r++){var o,a=u[r],m=p.p,f=a[2];t>3?(o=f===n)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=t<2&&m<a[1])?(i=0,p.v=n,p.n=a[1]):m<f&&(o=t<3||a[0]>n||n>f)&&(a[4]=t,a[5]=n,p.n=f,i=0))}if(o||t>1)return c;throw d=!0,n}return function(o,u,f){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,f),i=u,s=f;(r=i<2?e:s)||!d;){a||(i?i<3?(i>1&&(p.n=-1),m(i,s)):p.n=s:p.v=s);try{if(l=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(d=p.n<0)?s:t.call(n,p))!==c)break}catch(t){a=e,i=1,s=t}finally{l=1}}return{value:r,done:d}}}(t,a,i),!0),u}var c={};function l(){}function u(){}function d(){}r=Object.getPrototypeOf;var p=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),m=d.prototype=l.prototype=Object.create(p);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,n(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=d,n(m,"constructor",d),n(d,"constructor",u),u.displayName="GeneratorFunction",n(d,i,"GeneratorFunction"),n(m),n(m,i,"Generator"),n(m,a,function(){return this}),n(m,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m:f}})()}function n(e,t,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}n=function(e,t,r,o){function i(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},n(e,t,r,o)}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function a(t,n,r){return(n=function(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function i(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)})}}var c,l,u,d,p={BASE_URL:"localhost"===window.location.hostname?"http://localhost:3001":"https://rental-management-backend-mocha.vercel.app",ENDPOINTS:{LOGIN:"/api/auth/login",LOGOUT:"/api/auth/logout",STATUS:"/api/auth/status",ME:"/api/auth/me",PROPERTIES:"/api/properties",PROPERTY_BY_ID:function(e){return"/api/properties/".concat(e)},PROPERTY_TENANTS:function(e){return"/api/properties/".concat(e,"/tenants")},PROPERTY_STATS:"/api/properties/stats/summary",TENANTS:"/api/tenants",TENANT_BY_ID:function(e){return"/api/tenants/".concat(e)},TENANT_BY_FIN:function(e){return"/api/tenants/fin/".concat(e)},TENANT_STATS:"/api/tenants/stats/summary",TENANT_ADD_PROPERTY:function(e){return"/api/tenants/".concat(e,"/properties")},TENANT_REMOVE_PROPERTY:function(e,t){return"/api/tenants/".concat(e,"/properties/").concat(t)},UPLOAD:"/api/upload",UPLOAD_MULTIPLE:"/api/upload/multiple",DASHBOARD_ANALYTICS:"/api/analysis/dashboard",PROPERTY_PERFORMANCE:"/api/analysis/property-performance",TENANT_INSIGHTS:"/api/analysis/tenant-insights",INVESTORS:"/api/investors",INVESTOR_BY_ID:function(e){return"/api/investors/".concat(e)},INVESTORS_BY_PROPERTY:function(e){return"/api/investors/property/".concat(e)},INVESTOR_ADD_PROPERTY:function(e){return"/api/investors/".concat(e,"/properties")},INVESTOR_REMOVE_PROPERTY:function(e,t){return"/api/investors/".concat(e,"/properties/").concat(t)},FINANCIAL_REPORTS_BY_PROPERTY:function(e){return"/api/financial-reports/property/".concat(e)},FINANCIAL_REPORT:function(e,t,n){return"/api/financial-reports/property/".concat(e,"/").concat(t,"/").concat(n)},FINANCIAL_REPORT_INCOME:function(e,t,n){return"/api/financial-reports/property/".concat(e,"/").concat(t,"/").concat(n,"/income")},FINANCIAL_REPORT_EXPENSES:function(e,t,n){return"/api/financial-reports/property/".concat(e,"/").concat(t,"/").concat(n,"/expenses")},HEALTH:"/health"}},m=function(e){return"".concat(p.BASE_URL).concat(e)},f=function(){var e=localStorage.getItem("authToken");if(e){var t=localStorage.getItem("authExpiration");t&&Date.now()>parseInt(t)&&(h(),e=null)}return e||(e=sessionStorage.getItem("authToken")),e},v=function(){var e={"Content-Type":"application/json"},t=f();return t&&(e.Authorization="Bearer ".concat(t)),e},y={get:(d=s(t().m(function e(n){var r,a,i=arguments;return t().w(function(e){for(;;)switch(e.n){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},e.n=1,fetch(m(n),o({method:"GET",credentials:"include",headers:o(o({},v()),r.headers||{})},r));case 1:return a=e.v,e.a(2,a)}},e)})),function(e){return d.apply(this,arguments)}),post:(u=s(t().m(function e(n){var r,a,i,s=arguments;return t().w(function(e){for(;;)switch(e.n){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:null,a=s.length>2&&void 0!==s[2]?s[2]:{},e.n=1,fetch(m(n),o({method:"POST",credentials:"include",headers:o(o({},v()),a.headers||{}),body:r?JSON.stringify(r):null},a));case 1:return i=e.v,e.a(2,i)}},e)})),function(e){return u.apply(this,arguments)}),put:(l=s(t().m(function e(n){var r,a,i,s=arguments;return t().w(function(e){for(;;)switch(e.n){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:null,a=s.length>2&&void 0!==s[2]?s[2]:{},e.n=1,fetch(m(n),o({method:"PUT",credentials:"include",headers:o(o({},v()),a.headers||{}),body:r?JSON.stringify(r):null},a));case 1:return i=e.v,e.a(2,i)}},e)})),function(e){return l.apply(this,arguments)}),delete:(c=s(t().m(function e(n){var r,a,i=arguments;return t().w(function(e){for(;;)switch(e.n){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},e.n=1,fetch(m(n),o({method:"DELETE",credentials:"include",headers:o(o({},v()),r.headers||{})},r));case 1:return a=e.v,e.a(2,a)}},e)})),function(e){return c.apply(this,arguments)})},h=function(){localStorage.removeItem("authToken"),localStorage.removeItem("user"),localStorage.removeItem("rememberMe"),localStorage.removeItem("loginTime"),localStorage.removeItem("authExpiration"),sessionStorage.removeItem("authToken"),sessionStorage.removeItem("user"),sessionStorage.removeItem("rememberMe")};window.API_CONFIG=p,window.buildApiUrl=m,window.API=y,window.getAuthToken=f,window.getAuthHeaders=v,window.clearAuth=h},586:()=>{function e(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}window.showToast=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",r=document.getElementById("toast-container");r||((r=document.createElement("div")).id="toast-container",r.className="position-fixed top-0 end-0 p-3",r.style.zIndex="9999",document.body.appendChild(r));var o="toast-".concat(Date.now()),a='\n            <div id="'.concat(o,'" class="toast align-items-center text-white ').concat({success:"bg-success",error:"bg-danger",info:"bg-info"}[n],' border-0" role="alert" aria-live="assertive" aria-atomic="true">\n                <div class="d-flex">\n                    <div class="toast-body d-flex align-items-center">\n                        <i class="bi bi-').concat({success:"check-circle-fill",error:"exclamation-triangle-fill",info:"info-circle-fill"}[n],' me-2"></i>\n                        ').concat(e(t),'\n                    </div>\n                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n                </div>\n            </div>\n        ');r.insertAdjacentHTML("beforeend",a);var i=document.getElementById(o),s=new bootstrap.Toast(i,{delay:3e3});i.addEventListener("hidden.bs.toast",function(){i.remove()}),s.show()},window.escapeHtml=e},893:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function s(t,o,a,i){var s=o&&o.prototype instanceof l?o:l,u=Object.create(s.prototype);return n(u,"_invoke",function(t,n,o){var a,i,s,l=0,u=o||[],d=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,i=0,s=e,p.n=n,c}};function m(t,n){for(i=t,s=n,r=0;!d&&l&&!o&&r<u.length;r++){var o,a=u[r],m=p.p,f=a[2];t>3?(o=f===n)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=t<2&&m<a[1])?(i=0,p.v=n,p.n=a[1]):m<f&&(o=t<3||a[0]>n||n>f)&&(a[4]=t,a[5]=n,p.n=f,i=0))}if(o||t>1)return c;throw d=!0,n}return function(o,u,f){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,f),i=u,s=f;(r=i<2?e:s)||!d;){a||(i?i<3?(i>1&&(p.n=-1),m(i,s)):p.n=s:p.v=s);try{if(l=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(d=p.n<0)?s:t.call(n,p))!==c)break}catch(t){a=e,i=1,s=t}finally{l=1}}return{value:r,done:d}}}(t,a,i),!0),u}var c={};function l(){}function u(){}function d(){}r=Object.getPrototypeOf;var p=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),m=d.prototype=l.prototype=Object.create(p);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,n(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=d,n(m,"constructor",d),n(d,"constructor",u),u.displayName="GeneratorFunction",n(d,i,"GeneratorFunction"),n(m),n(m,i,"Generator"),n(m,a,function(){return this}),n(m,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m:f}})()}function n(e,t,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}n=function(e,t,r,o){function i(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},n(e,t,r,o)}function r(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var i=e.apply(t,n);function s(e){r(i,o,a,s,c,"next",e)}function c(e){r(i,o,a,s,c,"throw",e)}s(void 0)})}}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var s=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.components={},this.currentSection="dashboard",this.init()},n=[{key:"init",value:function(){this.updateCurrentDate(),this.setupNavigation(),this.setupFeatureCards(),this.loadUserInfo(),this.loadDashboardStats(),this.initializeComponentsLazily()}},{key:"updateCurrentDate",value:function(){var e=new Date,t=document.getElementById("currentDate");t&&(t.textContent=e.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}))}},{key:"setupNavigation",value:function(){var e=this;document.querySelectorAll(".nav-link").forEach(function(t){t.addEventListener("click",function(n){n.preventDefault();var r=t.getAttribute("data-section");r&&(e.showSection(r),document.querySelectorAll(".nav-link").forEach(function(e){return e.classList.remove("active")}),t.classList.add("active"))})})}},{key:"setupFeatureCards",value:function(){var e=this;document.addEventListener("click",function(t){var n=t.target.closest("[data-section]");if(n&&n.classList.contains("feature-card")){var r=n.getAttribute("data-section");e.showSection(r)}})}},{key:"showSection",value:function(e){document.querySelectorAll(".content-section").forEach(function(e){e.style.display="none"});var t=e+"-section",n=document.getElementById(t);n&&(n.style.display="block",this.currentSection=e,this.initializeComponentForSection(e)),document.querySelectorAll(".nav-link").forEach(function(e){return e.classList.remove("active")});var r=document.querySelector('.nav-link[data-section="'.concat(e,'"]'));r&&r.classList.add("active")}},{key:"initializeComponentsLazily",value:function(){}},{key:"initializeComponentForSection",value:function(e){switch(e){case"analysis":this.components.contractAnalysis||(this.components.contractAnalysis=new ContractAnalysisComponent);break;case"properties":this.components.propertyManagement||(this.components.propertyManagement=new PropertyManagementComponent,window.propertyManager=this.components.propertyManagement);break;case"tenants":this.components.tenantManagement||(this.components.tenantManagement=new TenantManagementComponent,window.tenantManager=this.components.tenantManagement);break;case"financial":this.components.financialReports||(this.components.financialReports=new FinancialReportsComponent,window.financialReports=this.components.financialReports)}}},{key:"loadUserInfo",value:(i=o(t().m(function e(){var n;return t().w(function(e){for(;;)switch(e.n){case 0:(n=document.getElementById("userInfo"))&&(n.textContent="Admin User");case 1:return e.a(2)}},e)})),function(){return i.apply(this,arguments)})},{key:"loadDashboardStats",value:(r=o(t().m(function e(){var n,r,o,a,i,s,c,l,u,d,p,m,f,v,y,h;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,API.get(API_CONFIG.ENDPOINTS.PROPERTY_STATS);case 1:return n=e.v,e.n=2,n.json();case 2:return(r=e.v).success&&(o=document.getElementById("propertiesCount"))&&(o.textContent=r.stats.totalProperties||0),e.n=3,API.get(API_CONFIG.ENDPOINTS.TENANT_STATS);case 3:return a=e.v,e.n=4,a.json();case 4:(i=e.v).success&&(s=i.stats,c=s.totalTenants||0,l=s.registeredTenants||0,u=s.tenantsWithProperties||0,d=document.getElementById("tenantsCount"),p=document.getElementById("registeredTenants"),m=document.getElementById("occupiedProperties"),d&&(d.textContent=c),p&&(p.textContent=l),m&&(m.textContent=u)),(f=document.getElementById("contractsCount"))&&(f.textContent="0"),(v=document.getElementById("issuesCount"))&&(v.textContent="0"),(y=document.getElementById("cleanCount"))&&(y.textContent="0"),e.n=6;break;case 5:e.p=5,h=e.v,console.error("Error loading dashboard stats:",h);case 6:return e.a(2)}},e,null,[[0,5]])})),function(){return r.apply(this,arguments)})},{key:"getComponent",value:function(e){return this.components[e]}},{key:"refreshCurrentSection",value:function(){this.initializeComponentForSection(this.currentSection);var e=this.getComponent(this.currentSection);e&&e.refresh&&e.refresh()}},{key:"refreshDashboardStats",value:function(){this.loadDashboardStats()}},{key:"goToSection",value:function(e){this.showSection(e)}},{key:"goToDashboard",value:function(){this.showSection("dashboard")}},{key:"goToAnalysis",value:function(){this.showSection("analysis")}},{key:"goToProperties",value:function(){this.showSection("properties")}},{key:"goToTenants",value:function(){this.showSection("tenants")}}],n&&a(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r,i}();document.addEventListener("DOMContentLoaded",function(){window.dashboardController=new s}),window.DashboardController=s},962:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function s(t,o,a,i){var s=o&&o.prototype instanceof l?o:l,u=Object.create(s.prototype);return n(u,"_invoke",function(t,n,o){var a,i,s,l=0,u=o||[],d=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,n){return a=t,i=0,s=e,p.n=n,c}};function m(t,n){for(i=t,s=n,r=0;!d&&l&&!o&&r<u.length;r++){var o,a=u[r],m=p.p,f=a[2];t>3?(o=f===n)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((o=t<2&&m<a[1])?(i=0,p.v=n,p.n=a[1]):m<f&&(o=t<3||a[0]>n||n>f)&&(a[4]=t,a[5]=n,p.n=f,i=0))}if(o||t>1)return c;throw d=!0,n}return function(o,u,f){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&m(u,f),i=u,s=f;(r=i<2?e:s)||!d;){a||(i?i<3?(i>1&&(p.n=-1),m(i,s)):p.n=s:p.v=s);try{if(l=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(d=p.n<0)?s:t.call(n,p))!==c)break}catch(t){a=e,i=1,s=t}finally{l=1}}return{value:r,done:d}}}(t,a,i),!0),u}var c={};function l(){}function u(){}function d(){}r=Object.getPrototypeOf;var p=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),m=d.prototype=l.prototype=Object.create(p);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,n(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return u.prototype=d,n(m,"constructor",d),n(d,"constructor",u),u.displayName="GeneratorFunction",n(d,i,"GeneratorFunction"),n(m),n(m,i,"Generator"),n(m,a,function(){return this}),n(m,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m:f}})()}function n(e,t,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}n=function(e,t,r,o){function i(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(i("next",0),i("throw",1),i("return",2))},n(e,t,r,o)}function r(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(o,a){var i=e.apply(t,n);function s(e){r(i,o,a,s,c,"next",e)}function c(e){r(i,o,a,s,c,"throw",e)}s(void 0)})}}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var s=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentPage=1,this.pdfDoc=null,this.scale=1,this.analysisData=null,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.init()},n=[{key:"init",value:function(){this.setupFileUpload(),this.setupPDFControls(),this.setupEventListeners()}},{key:"setupFileUpload",value:function(){var e=this,t=document.getElementById("uploadArea"),n=document.getElementById("fileInput");t&&n&&(t.addEventListener("click",function(){n.click()}),t.addEventListener("dragover",function(e){e.preventDefault(),t.classList.add("dragover")}),t.addEventListener("dragleave",function(){t.classList.remove("dragover")}),t.addEventListener("drop",function(n){n.preventDefault(),t.classList.remove("dragover");var r=n.dataTransfer.files;r.length>0&&e.handleFileUpload(r[0])}),n.addEventListener("change",function(t){t.target.files.length>0&&e.handleFileUpload(t.target.files[0])}))}},{key:"handleFileUpload",value:(s=o(t().m(function e(n){var r,o,a,i,s,c,l,u,d;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if("application/pdf"===n.type){e.n=1;break}return alert("Please upload a PDF file only."),e.a(2);case 1:if(!(n.size>10485760)){e.n=2;break}return alert("File size must be less than 10MB."),e.a(2);case 2:return(r=new FormData).append("agreement",n),(o=document.getElementById("uploadProgress")).querySelector(".progress-bar"),a=document.getElementById("analysisProgress"),o.style.display="block",a.style.display="block",e.p=3,e.n=4,fetch(buildApiUrl("/upload/agreement"),{method:"POST",credentials:"include",body:r});case 4:if((i=e.v).ok){e.n=5;break}throw new Error("Upload failed");case 5:return e.n=6,i.json();case 6:return s=e.v,console.log("File uploaded:",s.filename),e.n=7,API.post("/analysis/analyze",{filename:s.filename});case 7:if((c=e.v).ok){e.n=8;break}throw new Error("Analysis failed");case 8:return e.n=9,c.json();case 9:return l=e.v,console.log("Analysis completed:",l),this.analysisData=l,this.displayAnalysisResults(l),e.n=10,this.loadPDF(s.filename);case 10:(u=document.getElementById("downloadReportBtn"))&&(u.style.display="inline-block"),e.n=12;break;case 11:e.p=11,d=e.v,console.error("Error:",d),alert("Error processing file: "+d.message);case 12:return e.p=12,o.style.display="none",a.style.display="none",e.f(12);case 13:return e.a(2)}},e,this,[[3,11,12,13]])})),function(e){return s.apply(this,arguments)})},{key:"displayAnalysisResults",value:function(e){var t=document.getElementById("resultsContainer");if(t)if(e.success){var n=e.analysis.keywordAnalysis||[],r='<div class="analysis-results">';r+='<div class="row mb-3">',r+='<div class="col-4 text-center"><div class="border rounded p-2"><strong>'+n.length+'</strong><br><small class="text-muted">Total Issues</small></div></div>',r+='<div class="col-4 text-center"><div class="border rounded p-2"><strong>'+n.filter(function(e){return"HIGH"===e.severity}).length+'</strong><br><small class="text-danger">High Risk</small></div></div>',r+='<div class="col-4 text-center"><div class="border rounded p-2"><strong>'+n.filter(function(e){return"MEDIUM"===e.severity}).length+'</strong><br><small class="text-warning">Medium Risk</small></div></div>',r+="</div>",0===n.length?r+='<div class="alert alert-success"><i class="bi bi-check-circle me-2"></i>No issues found in this contract!</div>':[{title:"High Risk Issues",issues:n.filter(function(e){return"HIGH"===e.severity}),class:"danger",icon:"exclamation-triangle"},{title:"Medium Risk Issues",issues:n.filter(function(e){return"MEDIUM"===e.severity}),class:"warning",icon:"exclamation-circle"},{title:"Low Risk Issues",issues:n.filter(function(e){return"LOW"===e.severity}),class:"info",icon:"info-circle"}].forEach(function(e){e.issues.length>0&&(r+='<div class="alert alert-'+e.class+' mb-3">',r+='<h6><i class="bi bi-'+e.icon+' me-2"></i>'+e.title+" ("+e.issues.length+")</h6>",r+='<ul class="mb-0">',e.issues.forEach(function(e){r+="<li><strong>"+e.name+"</strong><br><small>"+e.description+"</small></li>"}),r+="</ul>",r+="</div>")}),r+="</div>",t.innerHTML=r}else t.innerHTML='<div class="alert alert-danger">Analysis failed: '+e.error+"</div>"}},{key:"setupPDFControls",value:function(){var e=this;document.addEventListener("click",function(t){t.target.closest("#nextPageBtn")&&e.nextPage(),t.target.closest("#prevPageBtn")&&e.previousPage()})}},{key:"loadPDF",value:(i=o(t().m(function e(n){var r,o,a,i,s;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,console.log("Loading PDF:",n),r="/pdf/".concat(n),console.log("PDF URL:",r),e.n=1,fetch(r,{credentials:"include"});case 1:if(o=e.v,console.log("PDF response status:",o.status),o.ok){e.n=2;break}throw new Error("Failed to load PDF: ".concat(o.status));case 2:return e.n=3,pdfjsLib.getDocument(r).promise;case 3:return this.pdfDoc=e.v,(a=document.getElementById("totalPages"))&&(a.textContent=this.pdfDoc.numPages),e.n=4,this.renderAllPages();case 4:console.log("PDF loaded successfully"),e.n=6;break;case 5:e.p=5,s=e.v,console.error("Error loading PDF:",s),(i=document.getElementById("pdfContainer"))&&(i.innerHTML='\n                    <div class="alert alert-warning">\n                        <i class="bi bi-exclamation-triangle me-2"></i>\n                        Unable to load PDF: '.concat(s.message,"\n                    </div>\n                "));case 6:return e.a(2)}},e,this,[[0,5]])})),function(e){return i.apply(this,arguments)})},{key:"renderAllPages",value:(r=o(t().m(function e(){var n,r,o,a,i,s,c,l,u,d,p,m;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,this.pdfDoc){e.n=1;break}throw new Error("PDF document not loaded");case 1:if(n=document.getElementById("pdfContainer")){e.n=2;break}return e.a(2);case 2:n.innerHTML="",console.log("Rendering all ".concat(this.pdfDoc.numPages," pages")),r=1;case 3:if(!(r<=this.pdfDoc.numPages)){e.n=7;break}return console.log("Rendering page ".concat(r," of ").concat(this.pdfDoc.numPages)),e.n=4,this.pdfDoc.getPage(r);case 4:return o=e.v,a=o.getViewport({scale:this.scale}),i=document.createElement("canvas"),s=i.getContext("2d"),i.className="pdf-canvas",i.height=a.height,i.width=a.width,i.style.marginBottom="20px",i.style.border="1px solid #ddd",(c=document.createElement("div")).style.position="relative",c.style.marginBottom="20px",(l=document.createElement("div")).className="highlight-layer",l.style.position="absolute",l.style.top="0",l.style.left="0",l.style.width=a.width+"px",l.style.height=a.height+"px",l.style.pointerEvents="none",u={canvasContext:s,viewport:a},e.n=5,o.render(u).promise;case 5:c.appendChild(i),c.appendChild(l),n.appendChild(c),console.log("Page ".concat(r," rendered successfully"));case 6:r++,e.n=3;break;case 7:(d=document.getElementById("zoomLevel"))&&(d.textContent=Math.round(100*this.scale)+"%"),console.log("All pages rendered successfully"),e.n=9;break;case 8:e.p=8,m=e.v,console.error("Error rendering pages:",m),(p=document.getElementById("pdfContainer"))&&(p.innerHTML='\n                    <div class="alert alert-danger">\n                        <i class="bi bi-exclamation-triangle me-2"></i>\n                        Error rendering pages: '.concat(m.message,"\n                    </div>\n                "));case 9:return e.a(2)}},e,this,[[0,8]])})),function(){return r.apply(this,arguments)})},{key:"previousPage",value:function(){this.pdfDoc?this.currentPage<=1?console.log("Already on first page"):(this.currentPage--,this.renderPage(this.currentPage)):console.error("PDF not loaded")}},{key:"nextPage",value:function(){return this.pdfDoc?this.currentPage>=this.pdfDoc.numPages?(console.log("Already on last page"),void alert("Already on the last page")):(this.currentPage++,void this.renderPage(this.currentPage)):(console.error("PDF not loaded"),void alert("PDF not loaded yet. Please wait for the PDF to load completely."))}},{key:"zoomIn",value:function(){this.scale+=.2,this.renderAllPages()}},{key:"zoomOut",value:function(){this.scale<=.4||(this.scale-=.2,this.renderAllPages())}},{key:"setupEventListeners",value:function(){var e=this,n=document.getElementById("downloadReportBtn");n&&n.addEventListener("click",o(t().m(function n(){var r,o,a,i,s;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e.analysisData){t.n=1;break}return alert("No analysis data available"),t.a(2);case 1:return t.p=1,t.n=2,API.post("/analysis/report",e.analysisData);case 2:if(!(r=t.v).ok){t.n=4;break}return t.n=3,r.blob();case 3:o=t.v,a=window.URL.createObjectURL(o),(i=document.createElement("a")).style.display="none",i.href=a,i.download="contract-analysis-report.pdf",document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(a),document.body.removeChild(i),t.n=5;break;case 4:throw new Error("Failed to generate report");case 5:t.n=7;break;case 6:t.p=6,s=t.v,console.error("Error downloading report:",s),alert("Error generating report: "+s.message);case 7:return t.a(2)}},n,null,[[1,6]])})))}}],n&&a(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,r,i,s}();window.ContractAnalysisComponent=s}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";n(500),n(586),n(962),n(38),n(41),n(280),n(893)})()})();